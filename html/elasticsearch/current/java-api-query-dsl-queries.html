<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Java Query DSL - Queries</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="java-api.html" title="Java API" /><link rel="prev" href="java-api-percolate.html" title="Percolate Java API" /><link rel="next" href="java-api-query-dsl-filters.html" title="Java Query DSL - Filters" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="java-api.html">Java API</a></span> &gt; <span class="breadcrumb-node">Java Query DSL - Queries</span></div><div class="navheader"><span class="prev"><a href="java-api-percolate.html">
              « 
              Percolate Java API</a>
           
        </span><span class="next">
           
          <a href="java-api-query-dsl-filters.html">Java Query DSL - Filters
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="java-api-query-dsl-queries"></a>Java Query DSL - Queries</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-client.html">Java Client</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-index_.html">Index Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-get.html">Get Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-delete.html">Delete Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-bulk.html">Bulk Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-search.html">Search Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-count.html">Count Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-delete-by-query.html">Delete By Query Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-facets.html">Java Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-percolate.html">Percolate Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-query-dsl-queries.html">Java Query DSL - Queries</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-query-dsl-filters.html">Java Query DSL - Filters</a></span></dt></dl></div><p>elasticsearch provides a full Java query dsl in a similar manner to the
REST <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a>. The factory for query
builders is <code class="literal">QueryBuilders</code>. Once your query is ready, you can use the
<a class="link" href="java-api-search.html" title="Search Java API">Search API</a>.</p><p>See also how to build
<a class="link" href="java-api-query-dsl-filters.html" title="Java Query DSL - Filters">Filters</a></p><p>To use <code class="literal">QueryBuilders</code> just import them in your class:</p><pre class="programlisting prettyprint noescape lang-java">import org.elasticsearch.index.query.QueryBuilders.*;</pre><p>Note that you can easily print (aka debug) JSON generated queries using
<code class="literal">toString()</code> method on <code class="literal">QueryBuilder</code> object.</p><p>The <code class="literal">QueryBuilder</code> can then be used with any API that accepts a query,
such as <code class="literal">count</code> and <code class="literal">search</code>.</p><h3><a id="_match_query"></a>Match Query</h3><p>See <a class="link" href="query-dsl-match-query.html" title="Match Query">Match Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.matchQuery("name", "kimchy elasticsearch");</pre><h3><a id="_multimatch_query"></a>MultiMatch Query</h3><p>See <a class="link" href="query-dsl-multi-match-query.html" title="Multi Match Query">MultiMatch Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.multiMatchQuery(
    "kimchy elasticsearch",     // Text you are looking for
    "user", "message"           // Fields you query on
    );</pre><h3><a id="_boolean_query"></a>Boolean Query</h3><p>See <a class="link" href="query-dsl-bool-query.html" title="Bool Query">Boolean Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders
                    .boolQuery()
                    .must(termQuery("content", "test1"))
                    .must(termQuery("content", "test4"))
                    .mustNot(termQuery("content", "test2"))
                    .should(termQuery("content", "test3"));</pre><h3><a id="_boosting_query"></a>Boosting Query</h3><p>See <a class="link" href="query-dsl-boosting-query.html" title="Boosting Query">Boosting Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.boostingQuery()
            .positive(QueryBuilders.termQuery("name","kimchy"))
            .negative(QueryBuilders.termQuery("name","dadoonet"))
            .negativeBoost(0.2f);</pre><h3><a id="_ids_query"></a>IDs Query</h3><p>See <a class="link" href="query-dsl-ids-query.html" title="Ids Query">IDs Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.idsQuery().ids("1", "2");</pre><h3><a id="_custom_score_query"></a>Custom Score Query</h3><p>See <a class="link" href="query-dsl-custom-score-query.html" title="Custom Score Query">Custom Score Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.customScoreQuery(QueryBuilders.matchAllQuery())   // Your query here
                .script("_score * doc['price'].value");         // Your script here

// If the script have parameters, use the same script and provide parameters to it.
QueryBuilders.customScoreQuery(QueryBuilders.matchAllQuery())
                .script("_score * doc['price'].value / pow(param1, param2)")
                .param("param1", 2)
                .param("param2", 3.1);</pre><h3><a id="_custom_boost_factor_query"></a>Custom Boost Factor Query</h3><p>See
<a class="link" href="query-dsl-custom-boost-factor-query.html" title="Custom Boost Factor Query">Custom Boost Factor Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.customBoostFactorQuery(QueryBuilders.matchAllQuery()) // Your query
                .boostFactor(3.1f);</pre><h3><a id="_constant_score_query"></a>Constant Score Query</h3><p>See <a class="link" href="query-dsl-constant-score-query.html" title="Constant Score Query">Constant Score Query</a></p><pre class="programlisting prettyprint noescape lang-java">// Using with Filters
QueryBuilders.constantScoreQuery(FilterBuilders.termFilter("name","kimchy"))
                .boost(2.0f);

// With Queries
QueryBuilders.constantScoreQuery(QueryBuilders.termQuery("name","kimchy"))
                .boost(2.0f);</pre><h3><a id="_disjunction_max_query"></a>Disjunction Max Query</h3><p>See <a class="link" href="query-dsl-dis-max-query.html" title="Dis Max Query">Disjunction Max Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.disMaxQuery()
                .add(QueryBuilders.termQuery("name","kimchy"))          // Your queries
                .add(QueryBuilders.termQuery("name","elasticsearch"))   // Your queries
                .boost(1.2f)
                .tieBreaker(0.7f);</pre><h3><a id="_field_query"></a>Field Query</h3><p>See <a class="link" href="query-dsl-field-query.html" title="Field Query">Field Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.fieldQuery("name", "+kimchy -dadoonet");

// Note that you can write the same query using queryString query.
QueryBuilders.queryString("+kimchy -dadoonet").field("name");</pre><h3><a id="_fuzzy_like_this_field_query_flt_and_flt_field"></a>Fuzzy Like This (Field) Query (flt and flt_field)</h3><p>See:
 * <a class="link" href="query-dsl-flt-query.html" title="Fuzzy Like This Query">Fuzzy Like This Query</a>
 * <a class="link" href="query-dsl-flt-field-query.html" title="Fuzzy Like This Field Query">Fuzzy Like This Field Query</a></p><pre class="programlisting prettyprint noescape lang-java">// flt Query
QueryBuilders.fuzzyLikeThisQuery("name.first", "name.last")     // Fields
                .likeText("text like this one")                 // Text
                .maxQueryTerms(12);                             // Max num of Terms
                                                                // in generated queries

// flt_field Query
QueryBuilders.fuzzyLikeThisFieldQuery("name.first")             // Only on single field
                .likeText("text like this one")
                .maxQueryTerms(12);</pre><h3><a id="_fuzzyquery"></a>FuzzyQuery</h3><p>See <a class="link" href="query-dsl-fuzzy-query.html" title="Fuzzy Query">Fuzzy Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.fuzzyQuery("name", "kimzhy");</pre><h3><a id="_has_child_has_parent"></a>Has Child / Has Parent</h3><p>See:
 * <a class="link" href="query-dsl-has-child-query.html" title="Has Child Query">Has Child Query</a>
 * &lt;&lt;query-dsl-has-parent-query,Has Parent</p><pre class="programlisting prettyprint noescape lang-java">// Has Child
QueryBuilders.hasChildQuery("blog_tag",
                QueryBuilders.termQuery("tag","something"))

// Has Parent
QueryBuilders.hasParentQuery("blog",
                QueryBuilders.termQuery("tag","something"));</pre><h3><a id="_matchall_query"></a>MatchAll Query</h3><p>See <a class="link" href="query-dsl-match-all-query.html" title="Match All Query">Match All Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.matchAllQuery();</pre><h3><a id="_fuzzy_like_this_field_query_flt_and_flt_field_2"></a>Fuzzy Like This (Field) Query (flt and flt_field)</h3><p>See:
 * <a class="link" href="query-dsl-mlt-query.html" title="More Like This Query">More Like This Query</a>
 * <a class="link" href="query-dsl-mlt-field-query.html" title="More Like This Field Query">More Like This Field Query</a></p><pre class="programlisting prettyprint noescape lang-java">// mlt Query
QueryBuilders.moreLikeThisQuery("name.first", "name.last")      // Fields
                .likeText("text like this one")                 // Text
                .minTermFreq(1)                                 // Ignore Threshold
                .maxQueryTerms(12);                             // Max num of Terms
                                                                // in generated queries

// mlt_field Query
QueryBuilders.moreLikeThisFieldQuery("name.first")              // Only on single field
                .likeText("text like this one")
                .minTermFreq(1)
                .maxQueryTerms(12);</pre><h3><a id="_prefix_query"></a>Prefix Query</h3><p>See <a class="link" href="query-dsl-prefix-query.html" title="Prefix Query">Prefix Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.prefixQuery("brand", "heine");</pre><h3><a id="_querystring_query"></a>QueryString Query</h3><p>See <a class="link" href="query-dsl-query-string-query.html" title="Query String Query">QueryString Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.queryString("+kimchy -elasticsearch");</pre><h3><a id="_range_query"></a>Range Query</h3><p>See <a class="link" href="query-dsl-range-query.html" title="Range Query">Range Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders
                    .rangeQuery("price")
                    .from(5)
                    .to(10)
                    .includeLower(true)
                    .includeUpper(false);</pre><h3><a id="_span_queries_first_near_not_or_term"></a>Span Queries (first, near, not, or, term)</h3><p>See:
 * <a class="link" href="query-dsl-span-first-query.html" title="Span First Query">Span First Query</a>
 * <a class="link" href="query-dsl-span-near-query.html" title="Span Near Query">Span Near Query</a>
 * <a class="link" href="query-dsl-span-not-query.html" title="Span Not Query">Span Not Query</a>
 * <a class="link" href="query-dsl-span-or-query.html" title="Span Or Query">Span Or Query</a>
 * <a class="link" href="query-dsl-span-term-query.html" title="Span Term Query">Span Term Query</a></p><pre class="programlisting prettyprint noescape lang-java">// Span First
QueryBuilders.spanFirstQuery(
                QueryBuilders.spanTermQuery("user", "kimchy"),  // Query
                3                                               // Max End position
        );

// Span Near
QueryBuilders.spanNearQuery()
    .clause(QueryBuilders.spanTermQuery("field","value1"))  // Span Term Queries
    .clause(QueryBuilders.spanTermQuery("field","value2"))
    .clause(QueryBuilders.spanTermQuery("field","value3"))
    .slop(12)                                               // Slop factor
    .inOrder(false)
    .collectPayloads(false);

// Span Not
QueryBuilders.spanNotQuery()
    .include(QueryBuilders.spanTermQuery("field","value1"))
    .exclude(QueryBuilders.spanTermQuery("field","value2"));

// Span Or
QueryBuilders.spanOrQuery()
    .clause(QueryBuilders.spanTermQuery("field","value1"))
    .clause(QueryBuilders.spanTermQuery("field","value2"))
    .clause(QueryBuilders.spanTermQuery("field","value3"));

// Span Term
QueryBuilders.spanTermQuery("user","kimchy");</pre><h3><a id="_term_query"></a>Term Query</h3><p>See <a class="link" href="query-dsl-term-query.html" title="Term Query">Term Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilder qb = QueryBuilders.termQuery("name", "kimchy");</pre><h3><a id="_terms_query"></a>Terms Query</h3><p>See <a class="link" href="query-dsl-terms-query.html" title="Terms Query">Terms Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.termsQuery("tags",    // field
    "blue", "pill")                 // values
    .minimumMatch(1);               // How many terms must match</pre><h3><a id="_top_children_query"></a>Top Children Query</h3><p>See <a class="link" href="query-dsl-top-children-query.html" title="Top Children Query">Top Children Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.topChildrenQuery(
        "blog_tag",                                 // field
        QueryBuilders.termQuery("tag", "something") // Query
    )
    .score("max")                                   // max, sum or avg
    .factor(5)
    .incrementalFactor(2);</pre><h3><a id="_wildcard_query"></a>Wildcard Query</h3><p>See <a class="link" href="query-dsl-wildcard-query.html" title="Wildcard Query">Wildcard Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.wildcardQuery("user", "k?mc*");</pre><h3><a id="_nested_query"></a>Nested Query</h3><p>See <a class="link" href="query-dsl-nested-query.html" title="Nested Query">Nested Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.nestedQuery("obj1",               // Path
                QueryBuilders.boolQuery()       // Your query
                        .must(QueryBuilders.matchQuery("obj1.name", "blue"))
                        .must(QueryBuilders.rangeQuery("obj1.count").gt(5))
            )
            .scoreMode("avg");                  // max, total, avg or none</pre><h3><a id="_custom_filters_score_query"></a>Custom Filters Score Query</h3><p>See
<a class="link" href="query-dsl-custom-filters-score-query.html" title="Custom Filters Score Query">Custom Filters Score Query</a></p><pre class="programlisting prettyprint noescape lang-java">QueryBuilders.customFiltersScoreQuery(
                QueryBuilders.matchAllQuery())  // Query
            // Filters with their boost factors
            .add(FilterBuilders.rangeFilter("age").from(0).to(10), 3)
            .add(FilterBuilders.rangeFilter("age").from(10).to(20), 2)
            .scoreMode("first");    // first, min, max, total, avg or multiply</pre><h3><a id="_indices_query"></a>Indices Query</h3><p>See <a class="link" href="query-dsl-indices-query.html" title="Indices Query">Indices Query</a></p><pre class="programlisting prettyprint noescape lang-java">// Using another query when no match for the main one
QueryBuilders.indicesQuery(
                QueryBuilders.termQuery("tag", "wow"),
                "index1", "index2"
            )
            .noMatchQuery(QueryBuilders.termQuery("tag", "kow"));

// Using all (match all) or none (match no documents)
QueryBuilders.indicesQuery(
                QueryBuilders.termQuery("tag", "wow"),
                "index1", "index2"
            )
            .noMatchQuery("all");       // all or none</pre><h3><a id="_geoshape_query"></a>GeoShape Query</h3><p>See <a class="link" href="query-dsl-geo-shape-query.html" title="GeoShape Query">GeoShape Query</a></p><p>Note: the <code class="literal">geo_shape</code> type uses <code class="literal">Spatial4J</code> and <code class="literal">JTS</code>, both of which are
optional dependencies. Consequently you must add <code class="literal">Spatial4J</code> and <code class="literal">JTS</code>
to your classpath in order to use this type:</p><pre class="programlisting prettyprint noescape lang-java">&lt;dependency&gt;
    &lt;groupId&gt;com.spatial4j&lt;/groupId&gt;
    &lt;artifactId&gt;spatial4j&lt;/artifactId&gt;
    &lt;version&gt;0.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.vividsolutions&lt;/groupId&gt;
    &lt;artifactId&gt;jts&lt;/artifactId&gt;
    &lt;version&gt;1.12&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</pre><pre class="programlisting prettyprint noescape lang-java">// Import Spatial4J shapes
import com.spatial4j.core.context.SpatialContext;
import com.spatial4j.core.shape.Shape;
import com.spatial4j.core.shape.impl.RectangleImpl;

// Also import ShapeRelation
import org.elasticsearch.common.geo.ShapeRelation;</pre><pre class="programlisting prettyprint noescape lang-java">// Shape within another
QueryBuilders.geoShapeQuery("location",
                new RectangleImpl(0,10,0,10,SpatialContext.GEO))
            .relation(ShapeRelation.WITHIN);

// Intersect shapes
QueryBuilders.geoShapeQuery("location",
                new PointImpl(0, 0, SpatialContext.GEO))
            .relation(ShapeRelation.INTERSECTS);

// Using pre-indexed shapes
QueryBuilders.geoShapeQuery("location", "New Zealand", "countries")
            .relation(ShapeRelation.DISJOINT);</pre></div><div class="navfooter"><span class="prev"><a href="java-api-percolate.html">
              « 
              Percolate Java API</a>
           
        </span><span class="next">
           
          <a href="java-api-query-dsl-filters.html">Java Query DSL - Filters
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
