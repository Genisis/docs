<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Architecture</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop" /><link rel="up" href="reference.html" title="Reference" /><link rel="prev" href="reference.html" title="Reference" /><link rel="next" href="configuration.html" title="Configuration" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop</a></span> &gt; <span class="breadcrumb-link"><a href="reference.html">Reference</a></span> &gt; <span class="breadcrumb-node">Architecture</span></div><div class="navheader"><span class="prev"><a href="reference.html">
              « 
              Reference</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuration
               » 
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="arch"></a>Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="arch.html">Architecture</a></span></dt><dt><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt><span class="chapter"><a href="configuration-runtime.html">Hadoop runtime options</a></span></dt><dt><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt></dl></div><p>At the core, elasticsearch-hadoop integrates two <span class="emphasis"><em>distributed</em></span> systems: <span class="strong"><strong>Hadoop</strong></span>, a batch-oriented computing platform and <span class="strong"><strong>Elasticsearch</strong></span>, a real-time search and analytics engine. From a high-level view both provide a computational component: Hadoop through Map/Reduce and Elasticsearch through its search and aggregation.</p><p>elasticsearch-hadoop goal is to <span class="emphasis"><em>connect</em></span> these two entities so that they can transparently benefit from each other.</p><h3><a id="arch-shards"></a>Map/Reduce and Shards</h3><p>A critical component for scalability is parallelism or splitting a task into multiple, smaller ones that execute at the same time, on different nodes in the cluster. The concept is present in both Hadoop through its <code class="literal">splits</code> (the number of parts in which a source or input can be divided) and Elasticsearch through <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/glossary.html#glossary-shard" target="_top"><code class="literal">shards</code></a> (the number of parts in which a index is divided into).</p><p>In short, roughly speaking more input splits means more tasks that can read at the same time, different parts of the source. More shards means more <span class="emphasis"><em>buckets</em></span> from which to read an index content (at the same time).</p><p>As such, elasticsearch-hadoop uses splits and shards as the main drivers behind the number of tasks executed within the Hadoop and Elasticsearch clusters as they have a direct impact on parallelism.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Hadoop <code class="literal">splits</code> as well as Elasticsearch <code class="literal">shards</code> play an important role regarding a system behavior - we recommend familiarizing with the two concepts to get a better understanding of your system runtime semantics.</p></td></tr></table></div><h3><a id="arch-reading"></a>Reading from Elasticsearch</h3><p>Shards play a critical role when reading information from Elasticsearch. Since it acts as a source, elasticsearch-hadoop will create one Hadoop <code class="literal">InputSplit</code> per Elasticsearch shard; that is given a query that works against index <code class="literal">I</code>, elasticsearch-hadoop will dynamically discover the number of shards backing <code class="literal">I</code> and then for each shard will create an input split (which will determine the number of Hadoop tasks to be executed).
With the default settings, Elasticsearch uses <span class="strong"><strong>5</strong></span> <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/glossary.html#glossary-primary-shard" target="_top"><code class="literal">primary</code></a> shards per index which will result in the same number of tasks on the Hadoop side for each query.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>elasticsearch-hadoop does not query the same shards - it iterates through all of them (primaries and replicas) using a round-robin approach. To avoid data duplication, only one shard is used from each shard group (primary and replicas).</p></td></tr></table></div><p>A common concern (read optimization) for improving performance is to increase the number of shards and thus increase the number of tasks on the Hadoop side. Unless such gains are demonstrated through benchmarks, we recommend against such a measure since in most cases, an Elasticsearch shard can <span class="strong"><strong>easily</strong></span> handle data streaming to a Hadoop task.</p><h3><a id="arch-writing"></a>Writing to Elasticsearch</h3><p>Writing to Elasticsearch is driven by the number of input splits (or Hadoop tasks) available. In the current form, elasticsearch-hadoop uses only one node on the Elasticsearch side to handle the writing which acts as a proxy within the Elasticsearch cluster: as data flows in, based on its identity and cluster setting, Elasticsearch will route it to the appropriate shard.
The more splits are available, the more reducers can write data in parallel to Elasticsearch.</p><p>For the vast majority of cases, using only one node on the Elasticsearch side should pose no problem - if the network is not saturated, Elasticsearch can ingest the data just fine. However, for cases where this happens (again benchmark first instead of guessing), we are working on using multiple nodes based on the available index.</p><h3><a id="arch-colocation"></a>Data co-location</h3><p>Whenever possible, elasticsearch-hadoop shares the Elasticsearch cluster information with Hadoop to facilitate data co-location. In practice, this means whenever data is read from Elasticsearch, the source nodes IPs are passed on to Hadoop to optimize task execution. If co-location is desired/possible, hosting the Elasticsearch and Hadoop clusters within the same rack will provide significant network savings.</p></div><div class="navfooter"><span class="prev"><a href="reference.html">
              « 
              Reference</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuration
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
