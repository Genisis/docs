<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Apache Hive integration</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop" /><link rel="up" href="_reference.html" title="Reference" /><link rel="prev" href="cascading.html" title="Cascading support" /><link rel="next" href="pig.html" title="Apache Pig support" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop</a></span> &gt; <span class="breadcrumb-link"><a href="_reference.html">Reference</a></span> &gt; <span class="breadcrumb-node">Apache Hive integration</span></div><div class="navheader"><span class="prev"><a href="cascading.html">
              « 
              Cascading support</a>
           
        </span><span class="next">
           
          <a href="pig.html">Apache Pig support
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="hive"></a>Apache Hive integration</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="architecture.html">Architecture</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="runtime-configuration.html">Hadoop runtime options</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt></dl></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://hive.apache.org/" target="_top">Hive</a> is a data warehouse system for Hadoop that facilitates easy data summarization, ad-hoc queries, and the analysis of large datasets stored in Hadoop compatible file systems.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Hive website
</span></td></tr></table></div><p>Hive abstracts Hadoop by abstracting it through SQL-like language, called HiveQL so that users can apply data defining and manipulating operations to it, just like with SQL. In Hive data set are <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-DDLOperations" target="_top">defined</a> through <span class="emphasis"><em>tables</em></span> (that expose type information) in which data can be <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-DMLOperations" target="_top">loaded</a>, <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-SQLOperations" target="_top">selected and transformed</a> through built-in operators or custom/user defined functions (or <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/OperatorsAndFunctions" target="_top">UDF</a>s).</p><h3><a id="_installation_3"></a>Installation</h3><p>Make elasticsearch-hadoop jar available in the Hive classpath. Depending on your options, there are various <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/HivePlugins#HivePlugins-DeployingjarsforUserDefinedFunctionsandUserDefinedSerDes" target="_top">ways</a> to achieve that. Use <a class="ulink" href="https://cwiki.apache.org/Hive/languagemanual-cli.html#LanguageManualCli-HiveResources" target="_top">ADD</a> command to add files, jars (what we want) or archives to the classpath:</p><pre class="screen">ADD /path/elasticsearch-hadoop.jar;</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>the command expects a proper URI that can be found either on the local file-system or remotely. Typically it’s best to use a distributed file-system (like HDFS or Amazon S3) and use that since the script might be executed
on various machines.</p></td></tr></table></div><p>As an alternative, one can use the command-line:</p><p><strong>CLI configuration. </strong>
</p><pre class="programlisting prettyprint noescape lang-bash">$ bin/hive -hiveconf hive.aux.jars.path=/path/elasticsearch-hadoop.jar</pre><p>
</p><p>or if the <code class="literal">hive-site.xml</code> configuration can be modified, one can register additional jars through the <code class="literal">hive.aux.jars.path</code> option (that accepts an URI as well):</p><p><strong><code class="literal">hive-site.xml</code> configuration. </strong>
</p><pre class="programlisting prettyprint noescape lang-xml">&lt;property&gt;
  &lt;name&gt;hive.aux.jars.path&lt;/name&gt;
  &lt;value&gt;/path/elasticsearch-hadoop.jar&lt;/value&gt;
  &lt;description&gt;A comma separated list (with no spaces) of the jar files&lt;/description&gt;
&lt;/property&gt;</pre><p>
</p><h3><a id="hive-configuration"></a>Configuration</h3><p>When using Hive, one can use <code class="literal">TBLPROPERTIES</code> to specify the <a class="link" href="configuration.html" title="Configuration">configuration</a> properties (as an alternative to Hadoop <code class="literal">Configuration</code> object) when declaring the external table backed by Elasticsearch:</p><pre class="programlisting prettyprint noescape lang-sql">CREATE EXTERNAL TABLE artists (...)
STORED BY 'org.elasticsearch.hadoop.hive.ESStorageHandler'
TBLPROPERTIES('es.resource' = 'radio/artists/',
              'es.index.auto.create' = 'false') <a id="CO7-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop setting
</p></td></tr></table></div><h3><a id="hive-alias"></a>Mapping</h3><p>By default, elasticsearch-hadoop uses the Hive table schema to map the data in Elasticsearch, using both the field names and types in the process. There are cases however when the names in Hive cannot
be used with Elasticsearch (the field name can contain characters accepted by Elasticsearch but not by Hive). For such cases, one can use the <code class="literal">es.mapping.names</code> setting which accepts a comma-separated list of names mapping in the following format: <code class="literal">Hive field name</code>:<code class="literal">{es} field name</code></p><p>To wit:</p><pre class="programlisting prettyprint noescape lang-sql">CREATE EXTERNAL TABLE artists (...)
STORED BY 'org.elasticsearch.hadoop.hive.ESStorageHandler'
TBLPROPERTIES('es.resource' = 'radio/artists/',
            <a id="CO8-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>'es.mapping.names' = 'date:@timestamp <a id="CO8-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>, url:url_123 <a id="CO8-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span>');</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
name mapping for two fields
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Hive column <code class="literal">date</code> mapped in Elasticsearch to <code class="literal">@timestamp</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Hive column <code class="literal">url</code> mapped in Elasticsearch to <code class="literal">url_123</code>
</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Elasticsearch accepts only lower-case field name and, as such, elasticsearch-hadoop will always convert Hive column names to lower-case. This poses no issue as Hive is <span class="strong"><strong>case insensitive</strong></span>
however it is recommended to use the default Hive style and use upper-case names only for Hive commands and avoid mixed-case names.</p></td></tr></table></div><h3><a id="hive-type-conversion"></a>Type conversion</h3><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If automatic index creation is used, please review <a class="link" href="_automatic_mapping.html#auto-mapping-type-loss">this</a> section for more information.</p></td></tr></table></div><p>Hive provides various <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual`Types" target="_top">types</a> for defining data and internally uses different implementations depending on the target environment (from JDK native types to binary-optimized ones). Elasticsearch integrates with all of them, including
and Serde2 <a class="ulink" href="http://hive.apache.org/docs/r0.11.0/api/index.html?org/apache/hadoop/hive/serde2/lazy/package-summary.html" target="_top">lazy</a> and <a class="ulink" href="http://hive.apache.org/docs/r0.11.0/api/index.html?org/apache/hadoop/hive/serde2/lazybinary/package-summary.html" target="_top">lazy binary</a>:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top"> Hive type </th><th align="center" valign="top"> Elasticsearch type</th></tr></thead><tbody><tr><td align="center" valign="top"><p><code class="literal">void</code></p></td><td align="center" valign="top"><p><code class="literal">null</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">boolean</code></p></td><td align="center" valign="top"><p><code class="literal">boolean</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">tinyint</code></p></td><td align="center" valign="top"><p><code class="literal">byte</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">smallint</code></p></td><td align="center" valign="top"><p><code class="literal">short</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">int</code></p></td><td align="center" valign="top"><p><code class="literal">int</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bigint</code></p></td><td align="center" valign="top"><p><code class="literal">long</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">double</code></p></td><td align="center" valign="top"><p><code class="literal">double</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">float</code></p></td><td align="center" valign="top"><p><code class="literal">float</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">string</code></p></td><td align="center" valign="top"><p><code class="literal">string</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">binary</code></p></td><td align="center" valign="top"><p><code class="literal">binary</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">timestamp</code></p></td><td align="center" valign="top"><p><code class="literal">date</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">struct</code></p></td><td align="center" valign="top"><p><code class="literal">map</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">map</code></p></td><td align="center" valign="top"><p><code class="literal">map</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">array</code></p></td><td align="center" valign="top"><p><code class="literal">array</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">union</code></p></td><td align="center" valign="top"><p>not supported yet</p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Hive 0.11 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">decimal</code></p></td><td align="center" valign="top"><p><code class="literal">string</code></p></td></tr></tbody></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>While Elasticsearch understands Hive types up to version 0.11, it is backwards compatible with Hive 0.9</p></td></tr></table></div><h3><a id="_writing_data_to_elasticsearch_3"></a>Writing data to Elasticsearch</h3><p>With elasticsearch-hadoop, Elasticsearch becomes just an external <a class="ulink" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual`DDL#LanguageManualDDL-CreateTable" target="_top">table</a> in which data can be loaded or read from:</p><pre class="programlisting prettyprint noescape lang-sql">CREATE EXTERNAL TABLE artists (
    id      BIGINT,
    name    STRING,
    links   STRUCT&lt;url:STRING, picture:STRING&gt;)
STORED BY 'org.elasticsearch.hadoop.hive.ESStorageHandler'<a id="CO9-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>
TBLPROPERTIES('es.resource' = 'radio/artists/'<a id="CO9-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>);

-- insert data to Elasticsearch from another table called 'source'
INSERT OVERWRITE TABLE artists
    SELECT NULL, s.name, named_struct('url', s.url, 'picture', s.picture) FROM source s;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch Hive <code class="literal">StorageHandler</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource (index and type) associated with the given storage
</p></td></tr></table></div><h3><a id="_reading_data_from_elasticsearch_3"></a>Reading data from Elasticsearch</h3><p>Reading from Elasticsearch is strikingly similar:</p><pre class="programlisting prettyprint noescape lang-sql">CREATE EXTERNAL TABLE artists (
    id      BIGINT,
    name    STRING,
    links   STRUCT&lt;url:STRING, picture:STRING&gt;)
STORED BY 'org.elasticsearch.hadoop.hive.ESStorageHandler'<a id="CO10-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>
TBLPROPERTIES('es.resource' = 'radio/artists/_search?q=me*'<a id="CO10-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>);

-- stream data from Elasticsearch
SELECT * FROM artists;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
same Elasticsearch Hive <code class="literal">StorageHandler</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource (in case of reading, a query) associated with the given storage
</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="cascading.html">
              « 
              Cascading support</a>
           
        </span><span class="next">
           
          <a href="pig.html">Apache Pig support
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
