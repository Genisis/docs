<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Apache Pig support</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop" /><link rel="up" href="_reference.html" title="Reference" /><link rel="prev" href="hive.html" title="Apache Hive integration" /><link rel="next" href="mapping.html" title="Mapping and Types" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop</a></span> &gt; <span class="breadcrumb-link"><a href="_reference.html">Reference</a></span> &gt; <span class="breadcrumb-node">Apache Pig support</span></div><div class="navheader"><span class="prev"><a href="hive.html">
              « 
              Apache Hive integration</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="pig"></a>Apache Pig support</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="architecture.html">Architecture</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="runtime-configuration.html">Hadoop runtime options</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt></dl></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://pig.apache.org/" target="_top">Apache Pig</a> is a platform for analyzing large data sets that consists of a high-level language for expressing data analysis programs, coupled with infrastructure for evaluating these programs.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Pig website
</span></td></tr></table></div><p>It provides a high-level, powerful, <span class="emphasis"><em>scripting</em></span>-like transformation language which gets compiled into Map/Reduce jobs at runtime by the Pig <span class="emphasis"><em>compiler</em></span>. To simplify working with arbitrary data, Pig associates a <span class="emphasis"><em>schema</em></span> (or type information) with each data set for validation and performance. This in turn, breaks it down into <span class="emphasis"><em>discrete</em></span> data types that can be transformed through various operators or custom functions (or <a class="ulink" href="http://pig.apache.org/docs/r0.11.1/udf.html" target="_top">UDF</a>s). Data can be loaded from and stored to various storages such as the local file-system or HDFS, and with elasticsearch-hadoop into Elasticsearch as well.</p><h3><a id="pig-installation"></a>Installation</h3><p>In order to use elasticsearch-hadoop, its jar needs to be in Pig’s classpath. There are various ways of making that happen though typically the <a class="ulink" href="http://pig.apache.org/docs/r0.11.1/basic.html#register" target="_top">REGISTER</a> command is used:</p><pre class="screen">REGISTER /path/elasticsearch-hadoop.jar;</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>the command expects a proper URI that can be found either on the local file-system or remotely. Typically it’s best to use a distributed file-system (like HDFS or Amazon S3) and use that since the script might be executed
on various machines.</p></td></tr></table></div><p>As an alternative, when using the command-line, one can register additional jars through the <code class="literal">-Dpig.additional.jars</code> option (that accepts an URI as well):</p><pre class="programlisting prettyprint lang-bash">$ pig -Dpig.additional.jars=/path/elasticsearch-hadoop.jar:&lt;other.jars&gt; script.pig</pre><p>or if the jars are on HDFS</p><pre class="programlisting prettyprint lang-bash">$ pig \
-Dpig.additional.jars=hdfs://&lt;cluster-name&gt;:&lt;cluster-port&gt;/&lt;path&gt;/elasticsearch-hadoop.jar:&lt;other.jars&gt; \
script.pig</pre><h3><a id="pig-configuration"></a>Configuration</h3><p>With Pig, one can specify the <a class="link" href="configuration.html" title="Configuration">configuration</a> properties (as an alternative to Hadoop <code class="literal">Configuration</code> object) as a constructor parameter when declaring <code class="literal">ESStorage</code>:</p><pre class="screen">STORE B INTO 'radio/artists'<a id="CO11-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span> USING org.elasticsearch.hadoop.pig.ESStorage
                 ('es.http.timeout = 5m<a id="CO11-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span> ;<a id="CO11-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span>
               es.index.auto.create = false' <a id="CO11-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0" /></span>);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop configuration (target resource)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop option (http timeout)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">;</code> as configuration properties separator
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
another elasticsearch-hadoop configuration (disable automatic index creation)
</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>To avoid having to specify the fully qualified class name (<code class="literal">org.elasticsearch.hadoop.pig.ESStorage</code>), consider using a shortcut through <a class="ulink" href="http://pig.apache.org/docs/r0.11.1/basic.html#define" target="_top"><code class="literal">DEFINE</code></a> command:</p></td></tr></table></div><pre class="screen">DEFINE ESStorage org.elasticsearch.hadoop.pig.ESStorage('es.resource=radio/artists/');"</pre><p>Do note that it is possible (and recommended) to specify the configuration parameters to reduce script duplication. In fact, for the reminder of this section,
the Pig alias will be implied and <code class="literal">ESStorage</code> will be used (instead of the fully qualified class name) for abbreviation.</p><h3><a id="pig-alias"></a>Mapping</h3><p>Out of the box, elasticsearch-hadoop uses the Pig schema to map the data in Elasticsearch, using both the field names and types in the process. There are cases however when the names in Pig cannot
be used with Elasticsearch (invalid characters, existing names with different layout, etc…). For such cases, one can use the <code class="literal">es.mapping.names</code> setting which accepts a comma-separated list of names mapping in the following format: <code class="literal">Pig field name</code> : <code class="literal">{es} field name</code></p><p>For example:</p><pre class="screen">LOAD '...' USING ESStorage('<a id="CO12-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>es.mapping.names=date:@timestamp<a id="CO12-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>, uRL:url<a id="CO12-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span>')</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
name mapping for two fields
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Pig column <code class="literal">date</code> mapped in Elasticsearch to <code class="literal">@timestamp</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Pig column <code class="literal">url</code> mapped in Elasticsearch to <code class="literal">url_123</code>
</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Elasticsearch accepts only lower-case field name and, as such, elasticsearch-hadoop will always convert Pig column names to lower-case. Because Pig is <span class="strong"><strong>case sensitive</strong></span>, elasticsearch-hadoop handles the reverse
field mapping as well. It is recommended to use the default Pig style and use upper-case names only for commands and avoid mixed-case names.</p></td></tr></table></div><h3><a id="pig-type-conversion"></a>Type conversion</h3><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If automatic index creation is used, please review <a class="link" href="_automatic_mapping.html#auto-mapping-type-loss">this</a> section for more information.</p></td></tr></table></div><p>Pig internally uses native java types for most of its types and elasticsearch-hadoop abides to that convention.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top"> Pig type </th><th align="center" valign="top"> Elasticsearch type</th></tr></thead><tbody><tr><td align="center" valign="top"><p><code class="literal">null</code></p></td><td align="center" valign="top"><p><code class="literal">null</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">chararray</code></p></td><td align="center" valign="top"><p><code class="literal">string</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">int</code></p></td><td align="center" valign="top"><p><code class="literal">int</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">long</code></p></td><td align="center" valign="top"><p><code class="literal">long</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">double</code></p></td><td align="center" valign="top"><p><code class="literal">double</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">float</code></p></td><td align="center" valign="top"><p><code class="literal">float</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bytearray</code></p></td><td align="center" valign="top"><p><code class="literal">binary</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">tuple</code></p></td><td align="center" valign="top"><p><code class="literal">map</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bag</code></p></td><td align="center" valign="top"><p><code class="literal">array</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">map</code></p></td><td align="center" valign="top"><p><code class="literal">map</code></p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Pig 0.10 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">boolean</code></p></td><td align="center" valign="top"><p><code class="literal">boolean</code></p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Pig 0.11 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">datetime</code></p></td><td align="center" valign="top"><p><code class="literal">date</code></p></td></tr></tbody></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>While Elasticsearch understands the Pig types up to version 0.11, it is backwards compatible with Pig 0.9</p></td></tr></table></div><h3><a id="_writing_data_to_elasticsearch_4"></a>Writing data to Elasticsearch</h3><p>Elasticsearch is exposed as a native <code class="literal">Storage</code> to Pig so it can be used to store data into it:</p><pre class="screen">-- load data from HDFS into Pig using a schema
A = LOAD 'src/test/resources/artists.dat' USING PigStorage()
                    AS (id:long, name, url:chararray, picture: chararray);
-- transform data
B = FOREACH A GENERATE name, TOTUPLE(url, picture) AS links;
-- save the result to Elasticsearch
STORE B INTO 'radio/artists'<a id="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span> USING ESStorage(<a id="CO13-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource (index and type) associated with the given storage
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
additional configuration parameters can be passed here - in this case the defaults are used
</p></td></tr></table></div><h3><a id="_reading_data_from_elasticsearch_4"></a>Reading data from Elasticsearch</h3><p>As you would expect, loading the data is straight forward:</p><pre class="screen">-- load data from Elasticsearch into Pig
A = LOAD 'radio/artists/_search?q=me*'<a id="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span> USING ESStorage(<a id="CO14-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>);
DUMP A;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource (in case of reading, a query) associated with the given storage
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
additional configuration parameters can be passed here - in this case the defaults are used
</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="hive.html">
              « 
              Apache Hive integration</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
