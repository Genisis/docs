<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Mapping and Types</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop" /><link rel="up" href="reference.html" title="Reference" /><link rel="prev" href="pig.html" title="Apache Pig support" /><link rel="next" href="resources.html" title="Appendix A. Resources" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop</a></span> &gt; <span class="breadcrumb-link"><a href="reference.html">Reference</a></span> &gt; <span class="breadcrumb-node">Mapping and Types</span></div><div class="navheader"><span class="prev"><a href="pig.html">
              « 
              Apache Pig support</a>
           
        </span><span class="next">
           
          <a href="resources.html">Appendix A. Resources
               » 
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping"></a>Mapping and Types</h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="arch.html">Architecture</a></span></dt><dt><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt><span class="chapter"><a href="configuration-runtime.html">Hadoop runtime options</a></span></dt><dt><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt></dl></div><p>As explained in the previous sections, elasticsearch-hadoop integrates closely with the Hadoop ecosystem and perform close introspection of the type information so that the data flow between Elasticsearch and Hadoop is as transparent as possible.
This section takes a closer look at how the type conversion takes place and how data is mapped between the two systems.</p><h3><a id="_converting_data_to_elasticsearch"></a>Converting data to Elasticsearch</h3><p>By design, elasticsearch-hadoop provides no data transformation or mapping layer itself simply because there is no need for them: Hadoop is designed to do ETL and some libraries (like Pig and Hive) provide type information themselves; further more Elasticsearch has rich support for mapping out of the box including automatic detection,  dynamic/schema-less mapping, templates and full manual control.
Need to split strings into token, do data validation or eliminate unneeded data ? there are plenty of ways to do that in Hadoop before reading/writing data from/to Elasticsearch; need control over how data is stored in Elasticsearch ? use Elasticsearch APIs to define the  <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/indices-put-mapping.html" target="_top">mapping</a>, to update <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/indices-update-settings.html" target="_top">settings</a> or add generic <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/mapping-meta.html" target="_top">meta-data</a>.</p><h3><a id="mapping-date"></a>Time/Date mapping</h3><p>When it comes to handling dates, Elasticsearch always uses the <a class="ulink" href="http://en.wikipedia.org/wiki/ISO_8601" target="_top">ISO 8601</a> format for date/time. This is the default date format of Elasticsearch - if a custom one is needed, please <span class="strong"><strong>add</strong></span> it to the default option rather then just replacing it. See the <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/mapping-date-format.html" target="_top">date format</a> section in elasticsearch-hadoop reference documentation for more information.</p><h3><a id="_automatic_mapping"></a>Automatic mapping</h3><p>By default, Elasticsearch provides <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/docs-index_.html" target="_top">automatic index and mapping</a> when data is added under an index that has not been created before. In other words, data can be added into Elasticsearch without the index and the mappings being defined a priori. This is quite convenient since Elasticsearch automatically adapts to the data being fed to it - moreover, if certain entries have extra fields, Elasticsearch schema-less nature allows them to be indexed without any issues.</p><p><a id="auto-mapping-type-loss"></a>It is important to remember that automatic mapping uses the payload values to identify its <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/mapping-core-types.html" target="_top">type</a>, using the <span class="strong"><strong>first document</strong></span> creates the mapping. elasticsearch-hadoop communicates with Elasticsearch through JSON which does not provide any type information, rather only the field names and their values. One can think of it as <span class="emphasis"><em>type erasure</em></span> or information loss; for example JSON does not differentiate integer numeric types - <code class="literal">byte</code>, <code class="literal">short</code>, <code class="literal">int</code>, <code class="literal">long</code> are all placed in the same <code class="literal">integer</code> <span class="emphasis"><em>bucket</em></span>. this can have unexpected side-effects since the type information is <span class="emphasis"><em>guessed</em></span> such as:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
numbers mapped only as <code class="literal">long</code>/<code class="literal">double</code>
</span></dt><dd>
Whenever Elasticsearch encounters a number, it will allocate the largest type for it since it does not know the exact number type of the field. Allocating a small type (such as <code class="literal">byte</code>, <code class="literal">int</code> or <code class="literal">float</code>) can lead to problems if a future document is larger, so Elasticsearch uses a safe default.
</dd><dt><span class="term">
incorrect mapping
</span></dt><dd>
This happens when a string field contains only numbers (say <code class="literal">1234</code>) - Elasticsearch has no information that the number is actually a string and thus it map the field as a number. The same issue tends to occur with dates and strings.
</dd></dl></div><p>Only if the defaults need to be overridden and/or if you experience the problems exposed below, consider using <a class="xref" href="mapping.html#explicit-mapping" title="Explicit mapping">the section called “Explicit mapping”</a>.</p><h4><a id="_disabling_automatic_mapping"></a>Disabling automatic mapping</h4><p>Elasticsearch allows <span class="emphasis"><em>automatic index creation</em></span> as well as <span class="emphasis"><em>dynamic mapping</em></span> (for extra fields present in documents) to be disabled through the <code class="literal">action.auto_create_index</code> and <code class="literal">index.mapper.dynamic</code> settings on the nodes config files. As a safety net, elasticsearch-hadoop provides a dedicated configuration <a class="link" href="configuration.html#configuration-options-index" title="Index">option</a> <code class="literal">es.index.auto.create</code> which allows elasticsearch-hadoop to either create the index or not without having to modify the Elasticsearch cluster options.</p><h3><a id="explicit-mapping"></a>Explicit mapping</h3><p>Explicit or manual mapping should be considered only when the defaults need to be overridden and/or if you experience the problems exposed above.
Refer to Elasticsearch <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/indices-create-index.html" target="_top">create index</a> and <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/indices-put-mapping.html" target="_top">mapping</a> documentation on how to define an index and its types - note that these need to be present <span class="strong"><strong>before</strong></span> data is being uploaded to Elasticsearch (otherwise automatic mapping will be used by Elasticsearch, if enabled).</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>In most cases, <a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/indices-templates.html" target="_top">templates</a> are quite handy as they are automatically applied to new indices created that match the pattern; in other words instead of defining the mapping per index, one can just define the template once and then have it applied to all indices that match its pattern.</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="pig.html">
              « 
              Apache Pig support</a>
           
        </span><span class="next">
           
          <a href="resources.html">Appendix A. Resources
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
