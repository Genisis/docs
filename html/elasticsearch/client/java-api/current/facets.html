<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Facets</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Java API" /><link rel="up" href="index.html" title="Java API" /><link rel="prev" href="delete-by-query.html" title="Delete By Query API" /><link rel="next" href="percolate.html" title="Percolate API" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Java API</a></span> &gt; <span class="breadcrumb-node">Facets</span></div><div class="navheader"><span class="prev"><a href="delete-by-query.html">
              « 
              Delete By Query API</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="facets"></a>Facets</h1></div></div></div><p>Elasticsearch provides a full Java API to play with facets. See the
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets.html" target="_top">Facets guide</a>.</p><p>Use the factory for facet builders (<code class="literal">FacetBuilders</code>) and add each facet
you want to compute when querying and add it to your search request:</p><pre class="programlisting prettyprint lang-java">SearchResponse sr = node.client().prepareSearch()
        .setQuery( /* your query */ )
        .addFacet( /* add a facet */ )
        .execute().actionGet();</pre><p>Note that you can add more than one facet. See
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-search.html" target="_top">Search Java API</a> for details.</p><p>To build facet requests, use <code class="literal">FacetBuilders</code> helpers. Just import them
in your class:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.FacetBuilders.*;</pre><h3><a id="_facets"></a>Facets</h3><h4><a id="_terms_facet"></a>Terms Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-terms-facet.html" target="_top">Terms Facet</a>
with Java API.</p><h5><a id="_prepare_facet_request"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.termsFacet("f")
    .field("brand")
    .size(10);</pre><h5><a id="_use_facet_response"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.terms.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
TermsFacet f = (TermsFacet) sr.facets().facetsAsMap().get("f");

f.getTotalCount();      // Total terms doc count
f.getOtherCount();      // Not shown terms doc count
f.getMissingCount();    // Without term doc count

// For each entry
for (TermsFacet.Entry entry : f) {
    entry.getTerm();    // Term
    entry.getCount();   // Doc count
}</pre><h4><a id="_range_facet"></a>Range Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-range-facet.html" target="_top">Range Facet</a>
with Java API.</p><h5><a id="_prepare_facet_request_2"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.rangeFacet("f")
    .field("price")         // Field to compute on
    .addUnboundedFrom(3)    // from -infinity to 3 (excluded)
    .addRange(3, 6)         // from 3 to 6 (excluded)
    .addUnboundedTo(6);     // from 6 to +infinity</pre><h5><a id="_use_facet_response_2"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.range.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
RangeFacet f = (RangeFacet) sr.facets().facetsAsMap().get("f");

// For each entry
for (RangeFacet.Entry entry : f) {
    entry.getFrom();    // Range from requested
    entry.getTo();      // Range to requested
    entry.getCount();   // Doc count
    entry.getMin();     // Min value
    entry.getMax();     // Max value
    entry.getMean();    // Mean
    entry.getTotal();   // Sum of values
}</pre><h4><a id="_histogram_facet"></a>Histogram Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-histogram-facet.html" target="_top">Histogram
Facet</a> with Java API.</p><h5><a id="_prepare_facet_request_3"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">HistogramFacetBuilder facet = FacetBuilders.histogramFacet("f")
    .field("price")
    .interval(1);</pre><h5><a id="_use_facet_response_3"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.histogram.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
HistogramFacet f = (HistogramFacet) sr.facets().facetsAsMap().get("f");

// For each entry
for (HistogramFacet.Entry entry : f) {
    entry.getKey();     // Key (X-Axis)
    entry.getCount();   // Doc count (Y-Axis)
}</pre><h4><a id="_date_histogram_facet"></a>Date Histogram Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-date-histogram-facet.html" target="_top">Date
Histogram Facet</a> with Java API.</p><h5><a id="_prepare_facet_request_4"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.dateHistogramFacet("f")
    .field("date")      // Your date field
    .interval("year");  // You can also use "quarter", "month", "week", "day",
                        // "hour" and "minute" or notation like "1.5h" or "2w"</pre><h5><a id="_use_facet_response_4"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.datehistogram.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
DateHistogramFacet f = (DateHistogramFacet) sr.facets().facetsAsMap().get("f");

// For each entry
for (DateHistogramFacet.Entry entry : f) {
    entry.getTime();    // Date in ms since epoch (X-Axis)
    entry.getCount();   // Doc count (Y-Axis)
}</pre><h4><a id="_filter_facet_not_facet_filter"></a>Filter Facet (not facet filter)</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-filter-facet.html" target="_top">Filter Facet</a>
with Java API.</p><p>If you are looking on how to apply a filter to a facet, have a look at
<a class="ulink" href="#facet-filter" target="_top">facet filter</a> using Java API.</p><h5><a id="_prepare_facet_request_5"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.filterFacet("f",
    FilterBuilders.termFilter("brand", "heineken"));    // Your Filter here</pre><p>See <a class="link" href="query-dsl-filters.html" title="Query DSL - Filters">Filters</a> to
learn how to build filters using Java.</p><h5><a id="_use_facet_response_5"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.filter.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
FilterFacet f = (FilterFacet) sr.facets().facetsAsMap().get("f");

f.getCount();   // Number of docs that matched</pre><h4><a id="_query_facet"></a>Query Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-query-facet.html" target="_top">Query Facet</a>
with Java API.</p><h5><a id="_prepare_facet_request_6"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.queryFacet("f",
    QueryBuilders.matchQuery("brand", "heineken"));</pre><h5><a id="_use_facet_response_6"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.query.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
QueryFacet f = (QueryFacet) sr.facets().facetsAsMap().get("f");

f.getCount();   // Number of docs that matched</pre><p>See <a class="link" href="query-dsl-queries.html" title="Query DSL - Queries">Queries</a> to
learn how to build queries using Java.</p><h4><a id="_statistical"></a>Statistical</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-statistical-facet.html" target="_top">Statistical
Facet</a> with Java API.</p><h5><a id="_prepare_facet_request_7"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.statisticalFacet("f")
   .field("price");</pre><h5><a id="_use_facet_response_7"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.statistical.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
StatisticalFacet f = (StatisticalFacet) sr.facets().facetsAsMap().get("f");

f.getCount();           // Doc count
f.getMin();             // Min value
f.getMax();             // Max value
f.getMean();            // Mean
f.getTotal();           // Sum of values
f.getStdDeviation();    // Standard Deviation
f.getSumOfSquares();    // Sum of Squares
f.getVariance();        // Variance</pre><h4><a id="_terms_stats_facet"></a>Terms Stats Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-terms-stats-facet.html" target="_top">Terms
Stats Facet</a> with Java API.</p><h5><a id="_prepare_facet_request_8"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.termsStatsFacet("f")
    .keyField("brand")
    .valueField("price");</pre><h5><a id="_use_facet_response_8"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.termsstats.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
TermsStatsFacet f = (TermsStatsFacet) sr.facets().facetsAsMap().get("f");
f.getTotalCount();      // Total terms doc count
f.getOtherCount();      // Not shown terms doc count
f.getMissingCount();    // Without term doc count

// For each entry
for (TermsStatsFacet.Entry entry : f) {
    entry.getTerm();            // Term
    entry.getCount();           // Doc count
    entry.getMin();             // Min value
    entry.getMax();             // Max value
    entry.getMean();            // Mean
    entry.getTotal();           // Sum of values
}</pre><h4><a id="_geo_distance_facet"></a>Geo Distance Facet</h4><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/search-facets-geo-distance-facet.html" target="_top">Geo
Distance Facet</a> with Java API.</p><h5><a id="_prepare_facet_request_9"></a>Prepare facet request</h5><p>Here is an example on how to create the facet request:</p><pre class="programlisting prettyprint lang-java">FacetBuilders.geoDistanceFacet("f")
    .field("pin.location")              // Field containing coordinates we want to compare with
    .point(40, -70)                     // Point from where we start (0)
    .addUnboundedFrom(10)               // 0 to 10 km (excluded)
    .addRange(10, 20)                   // 10 to 20 km (excluded)
    .addRange(20, 100)                  // 20 to 100 km (excluded)
    .addUnboundedTo(100)                // from 100 km to infinity (and beyond ;-) )
    .unit(DistanceUnit.KILOMETERS);     // All distances are in kilometers. Can be MILES</pre><h5><a id="_use_facet_response_9"></a>Use facet response</h5><p>Import Facet definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.facet.geodistance.*;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoDistanceFacet f = (GeoDistanceFacet) sr.facets().facetsAsMap().get("f");

// For each entry
for (GeoDistanceFacet.Entry entry : f) {
    entry.getFrom();            // Distance from requested
    entry.getTo();              // Distance to requested
    entry.getCount();           // Doc count
    entry.getMin();             // Min value
    entry.getMax();             // Max value
    entry.getTotal();           // Sum of values
    entry.getMean();            // Mean
}</pre><h3><a id="_facet_filters_not_filter_facet"></a>Facet filters (not Filter Facet)</h3><p>By default, facets are applied on the query resultset whatever filters
exists or are.</p><p>If you need to compute facets with the same filters or even with other
filters, you can add the filter to any facet using
<code class="literal">AbstractFacetBuilder#facetFilter(FilterBuilder)</code> method:</p><pre class="programlisting prettyprint lang-java">FacetBuilders
    .termsFacet("f").field("brand") // Your facet
    .facetFilter( // Your filter here
        FilterBuilders.termFilter("colour", "pale")
    );</pre><p>For example, you can reuse the same filter you created for your query:</p><pre class="programlisting prettyprint lang-java">// A common filter
FilterBuilder filter = FilterBuilders.termFilter("colour", "pale");

TermsFacetBuilder facet = FacetBuilders.termsFacet("f")
    .field("brand")
    .facetFilter(filter);                           // We apply it to the facet

SearchResponse sr = node.client().prepareSearch()
    .setQuery(QueryBuilders.matchAllQuery())
    .setFilter(filter)                              // We apply it to the query
    .addFacet(facet)
    .execute().actionGet();</pre><p>See documentation on how to build
<a class="link" href="query-dsl-filters.html" title="Query DSL - Filters">Filters</a>.</p><h3><a id="_scope"></a>Scope</h3><p>By default, facets are computed within the query resultset. But, you can
compute facets from all documents in the index whatever the query is,
using <code class="literal">global</code> parameter:</p><pre class="programlisting prettyprint lang-java">TermsFacetBuilder facet = FacetBuilders.termsFacet("f")
    .field("brand")
    .global(true);</pre></div><div class="navfooter"><span class="prev"><a href="delete-by-query.html">
              « 
              Delete By Query API</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
