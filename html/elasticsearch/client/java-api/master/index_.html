<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Index API</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Java API" /><link rel="up" href="index.html" title="Java API" /><link rel="prev" href="client.html" title="Client" /><link rel="next" href="get.html" title="Get API" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Java API</a></span> &gt; <span class="breadcrumb-node">Index API</span></div><div class="navheader"><span class="prev"><a href="client.html">
              « 
              Client</a>
           
        </span><span class="next">
           
          <a href="get.html">Get API
               » 
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index_"></a>Index API</h1></div></div></div><p>The index API allows one to index a typed JSON document into a specific
index and make it searchable.</p><h3><a id="_generate_json_document"></a>Generate JSON document</h3><p>There are different way of generating JSON document:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Manually (aka do it yourself) using native <code class="literal">byte[]</code> or as a <code class="literal">String</code>
</li><li class="listitem">
Using <code class="literal">Map</code> that will be automatically converted to its JSON
equivalent
</li><li class="listitem">
Using a third party library to serialize your beans such as
<a class="ulink" href="http://wiki.fasterxml.com/JacksonHome" target="_top">Jackson</a>
</li><li class="listitem">
Using built-in helpers XContentFactory.jsonBuilder()
</li></ul></div><p>Internally, each type is converted to <code class="literal">byte[]</code> (so a String is converted
to a <code class="literal">byte[]</code>). Therefore, if the object is in this form already, then
use it. The <code class="literal">jsonBuilder</code> is highly optimized JSON generator that
directly constructs a <code class="literal">byte[]</code>.</p><h4><a id="_do_it_yourself"></a>Do It Yourself</h4><p>Nothing really difficult here but note that you will have to encode
dates regarding to the
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/mapping-date-format.html" target="_top">Date Format</a>.</p><pre class="programlisting prettyprint lang-java">String json = "{" +
        "\"user\":\"kimchy\"," +
        "\"postDate\":\"2013-01-30\"," +
        "\"message\":\"trying out Elastic Search\"," +
    "}";</pre><h4><a id="_using_map"></a>Using Map</h4><p>Map is a key:values pair collection. It represents very well a JSON
structure:</p><pre class="programlisting prettyprint lang-java">Map&lt;String, Object&gt; json = new HashMap&lt;String, Object&gt;();
json.put("user","kimchy");
json.put("postDate",new Date());
json.put("message","trying out Elastic Search");</pre><h4><a id="_serialize_your_beans"></a>Serialize your beans</h4><p>Elasticsearch already use Jackson but shade it under
<code class="literal">org.elasticsearch.common.jackson</code> package.
 So, you can add your own Jackson version in your <code class="literal">pom.xml</code> file or in
your classpath. See <a class="ulink" href="http://wiki.fasterxml.com/JacksonDownload" target="_top">Jackson
Download Page</a>.</p><p>For example:</p><pre class="programlisting prettyprint lang-java">&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
    &lt;version&gt;2.1.3&lt;/version&gt;
&lt;/dependency&gt;</pre><p>Then, you can start serializing your beans to JSON:</p><pre class="programlisting prettyprint lang-java">import com.fasterxml.jackson.databind.*;

// instance a json mapper
ObjectMapper mapper = new ObjectMapper(); // create once, reuse

// generate json
String json = mapper.writeValueAsString(yourbeaninstance);</pre><h4><a id="_use_elasticsearch_helpers"></a>Use Elasticsearch helpers</h4><p>Elasticsearch provides built-in helpers to generate JSON content.</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.common.xcontent.XContentFactory.*;

XContentBuilder builder = jsonBuilder()
    .startObject()
        .field("user", "kimchy")
        .field("postDate", new Date())
        .field("message", "trying out Elastic Search")
    .endObject()</pre><p>Note that you can also add arrays with <code class="literal">startArray(String)</code> and
<code class="literal">endArray()</code> methods. By the way, <code class="literal">field</code> method
 accept many object types. You can pass directly numbers, dates and even
other XContentBuilder objects.</p><p>If you need to see the generated JSON content, you can use the
@string()@method.</p><pre class="programlisting prettyprint lang-java">String json = builder.string();</pre><h3><a id="_index_document"></a>Index document</h3><p>The following example indexes a JSON document into an index called
twitter, under a type called tweet, with id valued 1:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.common.xcontent.XContentFactory.*;

IndexResponse response = client.prepareIndex("twitter", "tweet", "1")
        .setSource(jsonBuilder()
                    .startObject()
                        .field("user", "kimchy")
                        .field("postDate", new Date())
                        .field("message", "trying out Elastic Search")
                    .endObject()
                  )
        .execute()
        .actionGet();</pre><p>Note that you can also index your documents as JSON String and that you
don’t have to give an ID:</p><pre class="programlisting prettyprint lang-java">String json = "{" +
        "\"user\":\"kimchy\"," +
        "\"postDate\":\"2013-01-30\"," +
        "\"message\":\"trying out Elastic Search\"," +
    "}";

IndexResponse response = client.prepareIndex("twitter", "tweet")
        .setSource(json)
        .execute()
        .actionGet();</pre><p><code class="literal">IndexResponse</code> object will give you report:</p><pre class="programlisting prettyprint lang-java">// Index name
String _index = response.index();
// Type name
String _type = response.type();
// Document ID (generated or not)
String _id = response.id();
// Version (if it's the first time you index this document, you will get: 1)
long _version = response.version();</pre><p>If you use percolation while indexing, <code class="literal">IndexResponse</code> object will give
you percolator that have matched:</p><pre class="programlisting prettyprint lang-java">IndexResponse response = client.prepareIndex("twitter", "tweet", "1")
        .setSource(json)
        .setPercolate("*")
        .execute()
        .actionGet();

List&lt;String&gt; matches = response.matches();</pre><p>For more information on the index operation, check out the REST
<a class="ulink" href="http://www.elasticsearch.org/guide/elasticsearch/reference/current/docs-index_.html" target="_top">index</a> docs.</p><h3><a id="_operation_threading"></a>Operation Threading</h3><p>The index API allows to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p><p>The options are to execute the operation on a different thread, or to
execute it on the calling thread (note that the API is still async). By
default, <code class="literal">operationThreaded</code> is set to <code class="literal">true</code> which means the operation
is executed on a different thread.</p></div><div class="navfooter"><span class="prev"><a href="client.html">
              « 
              Client</a>
           
        </span><span class="next">
           
          <a href="get.html">Get API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
