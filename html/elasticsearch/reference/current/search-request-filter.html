<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Filter</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="search-request-body.html" title="Request Body Search" /><link rel="prev" href="search-request-script-fields.html" title="Script Fields" /><link rel="next" href="search-request-highlighting.html" title="Highlighting" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> &gt; <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> &gt; <span class="breadcrumb-node">Filter</span></div><div class="navheader"><span class="prev"><a href="search-request-script-fields.html">
              « 
              Script Fields</a>
           
        </span><span class="next">
           
          <a href="search-request-highlighting.html">Highlighting
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-filter"></a>Filter</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-query.html">Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-from-size.html">From / Size</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-sort.html">Sort</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-fields.html">Fields</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-script-fields.html">Script Fields</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-filter.html">Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-highlighting.html">Highlighting</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-rescore.html">Rescoring</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-search-type.html">Search Type</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-scroll.html">Scroll</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-preference.html">Preference</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-explain.html">Explain</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-version.html">Version</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-index-boost.html">Index Boost</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-min-score.html">min_score</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-named-filters.html">Named Filters</a></span></dt></dl></div><p>When doing things like facet navigation, sometimes only the hits are
needed to be filtered by the chosen facet, and all the facets should
continue to be calculated based on the original query. The <code class="literal">filter</code>
element within the search request can be used to accomplish it.</p><p>Note, this is different compared to creating a <code class="literal">filtered</code> query with the
filter, since this will cause the facets to only process the filtered
results.</p><p>For example, lets create two tweets, with two different tags:</p><pre class="programlisting prettyprint noescape lang-js">curl -XPUT 'localhost:9200/twitter/tweet/1' -d '
{
    "message" : "something blue",
    "tag" : "blue"
}
'

curl -XPUT 'localhost:9200/twitter/tweet/2' -d '
{
    "message" : "something green",
    "tag" : "green"
}
'

curl -XPOST 'localhost:9200/_refresh'</pre><p>We can now search for something, and have a terms facet.</p><pre class="programlisting prettyprint noescape lang-js">curl -XPOST 'localhost:9200/twitter/_search?pretty=true' -d '
{
    "query" : {
        "term" : { "message" : "something" }
    },
    "facets" : {
        "tag" : {
            "terms" : { "field" : "tag" }
        }
    }
}
'</pre><p>We get two hits, and the relevant facets with a count of 1 for both
<code class="literal">green</code> and <code class="literal">blue</code>. Now, lets say the <code class="literal">green</code> facet is chosen, we can
simply add a filter for it:</p><pre class="programlisting prettyprint noescape lang-js">curl -XPOST 'localhost:9200/twitter/_search?pretty=true' -d '
{
    "query" : {
        "term" : { "message" : "something" }
    },
    "filter" : {
        "term" : { "tag" : "green" }
    },
    "facets" : {
        "tag" : {
            "terms" : { "field" : "tag" }
        }
    }
}
'</pre><p>And now, we get only 1 hit back, but the facets remain the same.</p><p>Note, if additional filters is required on specific facets, they can be
added as a <code class="literal">facet_filter</code> to the relevant facets.</p></div><div class="navfooter"><span class="prev"><a href="search-request-script-fields.html">
              « 
              Script Fields</a>
           
        </span><span class="next">
           
          <a href="search-request-highlighting.html">Highlighting
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
