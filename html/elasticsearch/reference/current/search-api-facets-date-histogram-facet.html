<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Date Histogram Facet</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="search-api-facets.html" title="Facets" /><link rel="prev" href="search-api-facets-histogram-facet.html" title="Histogram Facets" /><link rel="next" href="search-api-facets-filter-facet.html" title="Filter Facets" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="search-api.html">Search APIs</a></span> &gt; <span class="breadcrumb-link"><a href="search-api-facets.html">Facets</a></span> &gt; <span class="breadcrumb-node">Date Histogram Facet</span></div><div class="navheader"><span class="prev"><a href="search-api-facets-histogram-facet.html">
              « 
              Histogram Facets</a>
           
        </span><span class="next">
           
          <a href="search-api-facets-filter-facet.html">Filter Facets
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-api-facets-date-histogram-facet"></a>Date Histogram Facet</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-terms-facet.html">Terms Facet</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-range-facet.html">Range Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-histogram-facet.html">Histogram Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-date-histogram-facet.html">Date Histogram Facet</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-filter-facet.html">Filter Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-query-facet.html">Query Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-statistical-facet.html">Statistical Facet</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-terms-stats-facet.html">Terms Stats Facet</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-api-facets-geo-distance-facet.html">Geo Distance Facets</a></span></dt></dl></div><p>A specific histogram facet that can work with <code class="literal">date</code> field types
enhancing it over the regular
<a class="link" href="search-api-facets-histogram-facet.html" title="Histogram Facets">histogram facet</a>. Here is a quick example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "field" : "field_name",
                "interval" : "day"
            }
        }
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_interval"></a>Interval</h3></div></div></div><p>The <code class="literal">interval</code> allows to set the interval at which buckets will be
created for each hit. It allows for the constant values of <code class="literal">year</code>,
<code class="literal">quarter</code>, <code class="literal">month</code>, <code class="literal">week</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code>.</p><p>It also support time setting like <code class="literal">1.5h</code> (up to <code class="literal">w</code> for weeks).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_time_zone"></a>Time Zone</h3></div></div></div><p>By default, times are stored as UTC milliseconds since the epoch. Thus,
all computation and "bucketing" / "rounding" is done on UTC. It is
possible to provide a time zone (both pre rounding, and post rounding)
value, which will cause all computations to take the relevant zone into
account. The time returned for each bucket/entry is milliseconds since
the epoch of the provided time zone.</p><p>The parameters are <code class="literal">pre_zone</code> (pre rounding based on interval) and
<code class="literal">post_zone</code> (post rounding based on interval). The <code class="literal">time_zone</code> parameter
simply sets the <code class="literal">pre_zone</code> parameter. By default, those are set to
<code class="literal">UTC</code>.</p><p>The zone value accepts either a numeric value for the hours offset, for
example: <code class="literal">"time_zone" : -2</code>. It also accepts a format of hours and
minutes, like <code class="literal">"time_zone" : "-02:30"</code>. Another option is to provide a
time zone accepted as one of the values listed
<a class="ulink" href="http://joda-time.sourceforge.net/timezones.html" target="_top">here</a>.</p><p>Lets take an example. For <code class="literal">2012-04-01T04:15:30Z</code>, with a <code class="literal">pre_zone</code> of
<code class="literal">-08:00</code>. For <code class="literal">day</code> interval, the actual time by applying the time zone
and rounding falls under <code class="literal">2012-03-31</code>, so the returned value will be (in
millis) of <code class="literal">2012-03-31T00:00:00Z</code> (UTC). For <code class="literal">hour</code> interval, applying
the time zone results in <code class="literal">2012-03-31T20:15:30</code>, rounding it results in
<code class="literal">2012-03-31T20:00:00</code>, but, we want to return it in UTC (<code class="literal">post_zone</code> is
not set), so we convert it back to UTC: <code class="literal">2012-04-01T04:00:00Z</code>. Note, we
are consistent in the results, returning the rounded value in UTC.</p><p><code class="literal">post_zone</code> simply takes the result, and adds the relevant offset.</p><p>Sometimes, we want to apply the same conversion to UTC we did above for
<code class="literal">hour</code> also for <code class="literal">day</code> (and up) intervals. We can set
<code class="literal">pre_zone_adjust_large_interval</code> to <code class="literal">true</code>, which will apply the same
conversion done for <code class="literal">hour</code> interval in the example, to <code class="literal">day</code> and above
intervals (it can be set regardless of the interval, but only kick in
when using <code class="literal">day</code> and higher intervals).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_factor"></a>Factor</h3></div></div></div><p>The date histogram works on numeric values (since time is stored in
milliseconds since the epoch in UTC). But, sometimes, systems will store
a different resolution (like seconds since UTC) in a numeric field. The
<code class="literal">factor</code> parameter can be used to change the value in the field to
milliseconds to actual do the relevant rounding, and then be applied
again to get to the original unit. For example, when storing in a
numeric field seconds resolution, the <code class="literal">factor</code> can be set to <code class="literal">1000</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_post_offset"></a>Pre / Post Offset</h3></div></div></div><p>Specific offsets can be provided for pre rounding and post rounding. The
<code class="literal">pre_offset</code> for pre rounding, and <code class="literal">post_offset</code> for post rounding. The
format is the date time format (<code class="literal">1h</code>, <code class="literal">1d</code>, …).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_field"></a>Value Field</h3></div></div></div><p>The date_histogram facet allows to use a different key (of type date)
which controls the bucketing, with a different value field which will
then return the total and mean for that field values of the hits within
the relevant bucket. For example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_field" : "price",
                "interval" : "day"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_value_field"></a>Script Value Field</h3></div></div></div><p>A script can be used to compute the value that will then be used to
compute the total and mean for a bucket. For example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_script" : "doc['price'].value * 2",
                "interval" : "day"
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-api-facets-histogram-facet.html">
              « 
              Histogram Facets</a>
           
        </span><span class="next">
           
          <a href="search-api-facets-filter-facet.html">Filter Facets
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
