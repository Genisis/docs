<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Query String Query</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="query-dsl-queries.html" title="Queries" /><link rel="prev" href="query-dsl-prefix-query.html" title="Prefix Query" /><link rel="next" href="query-dsl-range-query.html" title="Range Query" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> &gt; <span class="breadcrumb-node">Query String Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-prefix-query.html">
              « 
              Prefix Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-range-query.html">Range Query
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-query-string-query"></a>Query String Query</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-match-query.html">Match Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-multi-match-query.html">Multi Match Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-bool-query.html">Bool Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-boosting-query.html">Boosting Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-common-terms-query.html">Common Terms Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-custom-filters-score-query.html">Custom Filters Score Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-ids-query.html">Ids Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-custom-score-query.html">Custom Score Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-custom-boost-factor-query.html">Custom Boost Factor Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-constant-score-query.html">Constant Score Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-dis-max-query.html">Dis Max Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-field-query.html">Field Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-filtered-query.html">Filtered Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-flt-query.html">Fuzzy Like This Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-flt-field-query.html">Fuzzy Like This Field Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-fuzzy-query.html">Fuzzy Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-shape-query.html">GeoShape Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-has-child-query.html">Has Child Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-has-parent-query.html">Has Parent Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-indices-query.html">Indices Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-match-all-query.html">Match All Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-mlt-query.html">More Like This Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-mlt-field-query.html">More Like This Field Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-nested-query.html">Nested Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-prefix-query.html">Prefix Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-query-string-query.html">Query String Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-range-query.html">Range Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-regexp-query.html">Regexp Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-first-query.html">Span First Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-multi-term-query.html">Span Multi Term Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-near-query.html">Span Near Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-not-query.html">Span Not Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-or-query.html">Span Or Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-span-term-query.html">Span Term Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-term-query.html">Term Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-terms-query.html">Terms Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-top-children-query.html">Top Children Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-wildcard-query.html">Wildcard Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-text-query.html">Text Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-minimum-should-match.html">Minimum Should Match</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-multi-term-rewrite.html">Multi Term Query Rewrite</a></span></dt></dl></div><p>A query that uses a query parser in order to parse its content. Here is
an example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query_string" : {
        "default_field" : "content",
        "query" : "this AND that OR thus"
    }
}</pre><p>The <code class="literal">query_string</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">query</code></p></td><td align="left" valign="top"><p>The actual query to be parsed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_field</code></p></td><td align="left" valign="top"><p>The default field for query terms if no prefix field
is specified. Defaults to the <code class="literal">index.query.default_field</code> index
settings, which in turn defaults to <code class="literal">_all</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td align="left" valign="top"><p>The default operator used if no explicit operator
is specified. For example, with a default operator of <code class="literal">OR</code>, the query
<code class="literal">capital of Hungary</code> is translated to <code class="literal">capital OR of OR Hungary</code>, and
with default operator of <code class="literal">AND</code>, the same query is translated to
<code class="literal">capital AND of AND Hungary</code>. The default value is <code class="literal">OR</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer name used to analyze the query string.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">allow_leading_wildcard</code></p></td><td align="left" valign="top"><p>When set, <code class="literal">*</code> or <code class="literal">?</code> are allowed as the first
character. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td align="left" valign="top"><p>Whether terms of wildcard, prefix, fuzzy,
and range queries are to be automatically lower-cased or not (since they
are not analyzed). Default it <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">enable_position_increments</code></p></td><td align="left" valign="top"><p>Set to <code class="literal">true</code> to enable position
increments in result queries. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzzy_max_expansions</code></p></td><td align="left" valign="top"><p>Controls the number of terms fuzzy queries will
expand to. Defaults to <code class="literal">50</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzzy_min_sim</code></p></td><td align="left" valign="top"><p>Set the minimum similarity for fuzzy queries. Defaults
to <code class="literal">0.5</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">fuzzy_prefix_length</code></p></td><td align="left" valign="top"><p>Set the prefix length for fuzzy queries. Default
is <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">phrase_slop</code></p></td><td align="left" valign="top"><p>Sets the default slop for phrases. If zero, then exact
phrase matches are required. Default value is <code class="literal">0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">boost</code></p></td><td align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td align="left" valign="top"><p>By default, wildcards terms in a query string are
not analyzed. By setting this value to <code class="literal">true</code>, a best effort will be
made to analyze those as well.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">auto_generate_phrase_queries</code></p></td><td align="left" valign="top"><p>Default to <code class="literal">false</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">minimum_should_match</code></p></td><td align="left" valign="top"><p>A value controlling how many "should" clauses
in the resulting boolean query should match. It can be an absolute value
(<code class="literal">2</code>), a percentage (<code class="literal">30%</code>) or a
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match">combination of both</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lenient</code></p></td><td align="left" valign="top"><p>If set to <code class="literal">true</code> will cause format based failures (like
providing text to a numeric field) to be ignored. (since 0.19.4).</p></td></tr></tbody></table></div><p>When a multi term query is being generated, one can control how it gets
rewritten using the
<a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p><h4><a id="_default_field"></a>Default Field</h4><p>When not explicitly specifying the field to search on in the query
string syntax, the <code class="literal">index.query.default_field</code> will be used to derive
which field to search on. It defaults to <code class="literal">_all</code> field.</p><p>So, if <code class="literal">_all</code> field is disabled, it might make sense to change it to set
a different default field.</p><h4><a id="_multi_field_2"></a>Multi Field</h4><p>The <code class="literal">query_string</code> query can also run against multiple fields. The idea
of running the <code class="literal">query_string</code> query against multiple fields is by
internally creating several queries for the same query string, each with
<code class="literal">default_field</code> that match the fields provided. Since several queries
are generated, combining them can be automatically done either using a
<code class="literal">dis_max</code> query or a simple <code class="literal">bool</code> query. For example (the <code class="literal">name</code> is
boosted by 5 using <code class="literal">^5</code> notation):</p><pre class="programlisting prettyprint noescape lang-js">{
    "query_string" : {
        "fields" : ["content", "name^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><p>Simple wildcard can also be used to search "within" specific inner
elements of the document. For example, if we have a <code class="literal">city</code> object with
several fields (or inner object with fields) in it, we can automatically
search on all "city" fields:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query_string" : {
        "fields" : ["city.*"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><p>Another option is to provide the wildcard fields search in the query
string itself (properly escaping the <code class="literal">*</code> sign), for example:
<code class="literal">city.\*:something</code>. (since 0.19.4).</p><p>When running the <code class="literal">query_string</code> query against multiple fields, the
following additional parameters are allowed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">use_dis_max</code></p></td><td align="left" valign="top"><p>Should the queries be combined using <code class="literal">dis_max</code> (set it
to <code class="literal">true</code>), or a <code class="literal">bool</code> query (set it to <code class="literal">false</code>). Defaults to <code class="literal">true</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tie_breaker</code></p></td><td align="left" valign="top"><p>When using <code class="literal">dis_max</code>, the disjunction max tie breaker.
Defaults to <code class="literal">0</code>.</p></td></tr></tbody></table></div><p>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre><h4><a id="Syntax_Extension"></a>Syntax Extension</h4><p>There are several syntax extensions to the Lucene query language.</p><h5><a id="_missing_exists"></a>missing / exists</h5><p>The <code class="literal">_exists_</code> and <code class="literal">_missing_</code> syntax allows to control docs that have
fields that exists within them (have a value) and missing. The syntax
is: <code class="literal">_exists_:field1</code>, <code class="literal">_missing_:field</code> and can be used anywhere a
query string is used.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-prefix-query.html">
              « 
              Prefix Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-range-query.html">Range Query
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
