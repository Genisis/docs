<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Delete By Query API</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="docs.html" title="Document APIs" /><link rel="prev" href="docs-bulk.html" title="Bulk API" /><link rel="next" href="docs-bulk-udp.html" title="Bulk UDP API" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> &gt; <span class="breadcrumb-node">Delete By Query API</span></div><div class="navheader"><span class="prev"><a href="docs-bulk.html">
              « 
              Bulk API</a>
           
        </span><span class="next">
           
          <a href="docs-bulk-udp.html">Bulk UDP API
               » 
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-delete-by-query"></a>Delete By Query API</h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="docs-index_.html">Index API</a></span></dt><dt><span class="chapter"><a href="docs-get.html">Get API</a></span></dt><dt><span class="chapter"><a href="docs-delete.html">Delete API</a></span></dt><dt><span class="chapter"><a href="docs-update.html">Update API</a></span></dt><dt><span class="chapter"><a href="docs-multi-get.html">Multi Get API</a></span></dt><dt><span class="chapter"><a href="docs-bulk.html">Bulk API</a></span></dt><dt><span class="chapter"><a href="docs-delete-by-query.html">Delete By Query API</a></span></dt><dt><span class="chapter"><a href="docs-bulk-udp.html">Bulk UDP API</a></span></dt></dl></div><p>The delete by query API allows to delete documents from one or more
indices and one or more types based on a query. The query can either be
provided using a simple query string as a parameter, or using the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query?q=user:kimchy'

$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query' -d '{
    "term" : { "user" : "kimchy" }
}
'</pre><p>Both above examples end up doing the same thing, which is delete all
tweets from the twitter index for a certain user. The result of the
commands is:</p><pre class="programlisting prettyprint lang-js">{
    "ok" : true,
    "_indices" : {
        "twitter" : {
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0
            }
        }
    }
}</pre><p>Note, delete by query bypasses versioning support. Also, it is not
recommended to delete "large chunks of the data in an index", many
times, it’s better to simply reindex into a new index.</p><h3><a id="_multiple_indices_and_types"></a>Multiple Indices and Types</h3><p>The delete by query API can be applied to multiple types within an
index, and across multiple indices. For example, we can delete all
documents across all types within the twitter index:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/_query?q=user:kimchy'</pre><p>We can also delete within specific types:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/twitter/tweet,user/_query?q=user:kimchy'</pre><p>We can also delete all tweets with a certain tag across several indices
(for example, when each user has his own index):</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/kimchy,elasticsearch/_query?q=tag:wow'</pre><p>Or even delete across all indices:</p><pre class="programlisting prettyprint lang-js">$ curl -XDELETE 'http://localhost:9200/_all/_query?q=tag:wow'</pre><h3><a id="_request_parameters"></a>Request Parameters</h3><p>When executing a delete by query using the query parameter <code class="literal">q</code>, the
query passed is a query string using Lucene query parser. There are
additional parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>df</p></td><td align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td align="left" valign="top"><p>analyzer</p></td><td align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td align="left" valign="top"><p>default_operator</p></td><td align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr></tbody></table></div><h3><a id="_request_body"></a>Request Body</h3><p>The delete by query can use the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> within its body in order to express the query that should be
executed and delete all documents. The body content can also be passed
as a REST parameter named <code class="literal">source</code>.</p><h3><a id="_distributed_4"></a>Distributed</h3><p>The delete by query API is broadcast across all primary shards, and from
there, replicated across all shards replicas.</p><h3><a id="_routing_5"></a>Routing</h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the delete by query request will be
executed on.</p><h3><a id="_replication_type_2"></a>Replication Type</h3><p>The replication of the operation can be done in an asynchronous manner
to the replicas (the operation will return once it has be executed on
the primary shard). The <code class="literal">replication</code> parameter can be set to <code class="literal">async</code>
(defaults to <code class="literal">sync</code>) in order to enable it.</p><h3><a id="_write_consistency_4"></a>Write Consistency</h3><p>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. The parameter to set it is
<code class="literal">consistency</code>, and it defaults to the node level setting of
<code class="literal">action.write_consistency</code> which in turn defaults to <code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p></div><div class="navfooter"><span class="prev"><a href="docs-bulk.html">
              « 
              Bulk API</a>
           
        </span><span class="next">
           
          <a href="docs-bulk-udp.html">Bulk UDP API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
