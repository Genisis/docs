<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Multi Search API</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="search-api.html" title="Search APIs" /><link rel="prev" href="search-api-suggesters-completion.html" title="Completion Suggester" /><link rel="next" href="search-api-count.html" title="Count API" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="search-api.html">Search APIs</a></span> &gt; <span class="breadcrumb-node">Multi Search API</span></div><div class="navheader"><span class="prev"><a href="search-api-suggesters-completion.html">
              « 
              Completion Suggester</a>
           
        </span><span class="next">
           
          <a href="search-api-count.html">Count API
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-api-multi-search"></a>Multi Search API</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-search.html">Search</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-uri-request.html">URI Request</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-request-body.html">Request Body</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-facets.html">Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-suggesters.html">Suggesters</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-multi-search.html">Multi Search API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-count.html">Count API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-validate.html">Validate API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-explain.html">Explain API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-percolate.html">Percolate API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="search-api-more-like-this.html">More Like This API</a></span></dt></dl></div><p>The multi search API allows to execute several search requests within
the same API. The endpoint for it is <code class="literal">_msearch</code> (available from <code class="literal">0.19</code>
onwards).</p><p>The format of the request is similar to the bulk API format, and the
structure is as follows (the structure is specifically optimized to
reduce parsing if a specific search ends up redirected to another node):</p><pre class="programlisting prettyprint noescape lang-js">header\n
body\n
header\n
body\n</pre><p>The header part includes which index / indices to search on, optional
(mapping) types to search on, the <code class="literal">search_type</code>, <code class="literal">preference</code>, and
<code class="literal">routing</code>. The body includes the typical search body request (including
the <code class="literal">query</code>, <code class="literal">facets</code>, <code class="literal">from</code>, <code class="literal">size</code>, and so on). Here is an example:</p><pre class="programlisting prettyprint noescape lang-js">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "count"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "count"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/_msearch --data-binary @requests; echo</pre><p>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</p><p>The response returns a <code class="literal">responses</code> array, which includes the search
response for each search request matching its order in the original
multi search request. If there was a complete failure for that specific
search request, an object with <code class="literal">error</code> message will be returned in place
of the actual search response.</p><p>The endpoint allows to also search against an index/indices and
type/types in the URI itself, in which case it will be used as the
default unless explicitly defined otherwise in the header. For example:</p><pre class="programlisting prettyprint noescape lang-js">$ cat requests
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "test2"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/test/_msearch --data-binary @requests; echo</pre><p>The above will execute the search against the <code class="literal">test</code> index for all the
requests that don’t define an index, and the last one will be executed
against the <code class="literal">test2</code> index.</p><p>The <code class="literal">search_type</code> can be set in a similar manner to globally apply to
all search requests.</p></div><div class="navfooter"><span class="prev"><a href="search-api-suggesters-completion.html">
              « 
              Completion Suggester</a>
           
        </span><span class="next">
           
          <a href="search-api-count.html">Count API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
