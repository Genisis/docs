<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cluster Reroute</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="cluster-api.html" title="Cluster APIs" /><link rel="prev" href="cluster-api-state.html" title="Cluster State" /><link rel="next" href="cluster-api-update-settings.html" title="Cluster Update Settings" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="cluster-api.html">Cluster APIs</a></span> &gt; <span class="breadcrumb-node">Cluster Reroute</span></div><div class="navheader"><span class="prev"><a href="cluster-api-state.html">
              « 
              Cluster State</a>
           
        </span><span class="next">
           
          <a href="cluster-api-update-settings.html">Cluster Update Settings
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-api-reroute"></a>Cluster Reroute</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-health.html">Cluster Health</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-state.html">Cluster State</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-reroute.html">Cluster Reroute</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-update-settings.html">Cluster Update Settings</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-nodes-stats.html">Nodes Stats</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-nodes-info.html">Nodes Info</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-nodes-hot-threads.html">Nodes hot_threads</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="cluster-api-nodes-shutdown.html">Nodes Shutdown</a></span></dt></dl></div><p>The reroute command allows to explicitly execute a cluster reroute
allocation command including specific commands. For example, a shard can
be moved from one node to another explicitly, an allocation can be
canceled, or an unassigned shard can be explicitly allocated on a
specific node.</p><p>Here is a short example of how a simple reroute API call:</p><pre class="programlisting prettyprint noescape lang-js">curl -XPOST 'localhost:9200/_cluster/reroute' -d '{
    "commands" : [ {
        "move" :
            {
              "index" : "test", "shard" : 0,
              "from_node" : "node1", "to_node" : "node2"
            }
        },
        {
          "allocate" : {
              "index" : "test", "shard" : 1, "node" : "node3"
          }
        }
    ]
}'</pre><p>An important aspect to remember is the fact that once when an allocation
occurs, the cluster will aim at re-balancing its state back to an even
state. For example, if the allocation includes moving a shard from
<code class="literal">node1</code> to <code class="literal">node2</code>, in an <code class="literal">even</code> state, then another shard will be moved
from <code class="literal">node2</code> to <code class="literal">node1</code> to even things out.</p><p>The cluster can be set to disable allocations, which means that only the
explicitly allocations will be performed. Obviously, only once all
commands has been applied, the cluster will aim to be re-balance its
state.</p><p>Another option is to run the commands in <code class="literal">dry_run</code> (as a URI flag, or in
the request body). This will cause the commands to apply to the current
cluster state, and return the resulting cluster after the commands (and
re-balancing) has been applied.</p><p>The commands supported are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">move</code>
</span></dt><dd>
    Move a started shard from one node to another node. Accepts
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, <code class="literal">from_node</code> for the
    node to move the shard <code class="literal">from</code>, and <code class="literal">to_node</code> for the node to move the
    shard to.
</dd><dt><span class="term">
<code class="literal">cancel</code>
</span></dt><dd>
    Cancel allocation of a shard (or recovery). Accepts <code class="literal">index</code>
    and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> for the node to
    cancel the shard allocation on. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to cancel allocation for a primary
    shard.
</dd><dt><span class="term">
<code class="literal">allocate</code>
</span></dt><dd>
    Allocate an unassigned shard to a node. Accepts the
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> to
    allocate the shard to. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to explicitly allocate a primary
    shard (might result in data loss).
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="cluster-api-state.html">
              « 
              Cluster State</a>
           
        </span><span class="next">
           
          <a href="cluster-api-update-settings.html">Cluster Update Settings
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
