<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Completion Suggester</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="search-suggesters.html" title="Suggesters" /><link rel="prev" href="search-suggesters-phrase.html" title="Phrase Suggester" /><link rel="next" href="search-multi-search.html" title="Multi Search API" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> &gt; <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> &gt; <span class="breadcrumb-node">Completion Suggester</span></div><div class="navheader"><span class="prev"><a href="search-suggesters-phrase.html">
              « 
              Phrase Suggester</a>
           
        </span><span class="next">
           
          <a href="search-multi-search.html">Multi Search API
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-completion"></a>Completion Suggester</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-suggesters-term.html">Term suggester</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-suggesters-phrase.html">Phrase Suggester</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-suggesters-completion.html">Completion Suggester</a></span></dt></dl></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p></td></tr></table></div><p>The <code class="literal">completion</code> suggester is a so-called prefix suggester. It does not
do spell correction like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters but allows
basic <code class="literal">auto-complete</code> functionality.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This feature is marked as experimental. This means, that
the API is not considered stable, and that you might need to reindex
your data after an upgrade in order to get suggestions up and running
again. Please keep this in mind.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_why_another_suggester_why_not_prefix_queries"></a>Why another suggester? Why not prefix queries?</h3></div></div></div><p>The first question which comes to mind when reading about a prefix
suggestion is, why you should use it all, if you have prefix queries
already. The answer is simple: Prefix suggestions are fast.</p><p>The data structures are internally backed by Lucenes
<code class="literal">AnalyzingSuggester</code>, which uses FSTs to execute suggestions. Usually
these data structures are costly to create, stored in-memory and need to
be rebuilt every now and then to reflect changes in your indexed
documents. The <code class="literal">completion</code> suggester circumvents this by storing the
FST as part of your index during index time. This allows for really fast
loads and executions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_mapping"></a>Mapping</h3></div></div></div><p>In order to use this feature, you have to specify a special mapping for
this field, which enables the special storage of the field.</p><pre class="programlisting prettyprint lang-js">curl -X PUT localhost:9200/music
curl -X PUT localhost:9200/music/song/_mapping -d '{
  "song" : {
        "properties" : {
            "name" : { "type" : "string" },
            "suggest" : { "type" : "completion",
                          "index_analyzer" : "simple",
                          "search_analyzer" : "simple",
                          "payloads" : true
            }
        }
    }
}'</pre><p>Mapping supports the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index_analyzer</code>
</span></dt><dd>
    The index analyzer to use, defaults to <code class="literal">simple</code>.
</dd><dt><span class="term">
<code class="literal">search_analyzer</code>
</span></dt><dd>
    The search analyzer to use, defaults to <code class="literal">simple</code>.
    In case you are wondering why we did not opt for the <code class="literal">standard</code>
    analyzer: We try to have easy to understand behaviour here, and if you
    index the field content <code class="literal">At the Drive-in</code>, you will not get any
    suggestions for <code class="literal">a</code>, nor for <code class="literal">d</code> (the first non stopword).
</dd><dt><span class="term">
<code class="literal">payloads</code>
</span></dt><dd>
    Enables the storing of payloads, defaults to <code class="literal">false</code>
</dd></dl></div><p><code class="literal">preserve_separators</code>:
    Preserves the separators, defaults to <code class="literal">true</code>.
    If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
    suggest for <code class="literal">foof</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">preserve_position_increments</code>
</span></dt><dd>
    Enables position increments, defaults
    to <code class="literal">true</code>. If disabled and using stopwords analyzer, you could get a
    field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong"><strong>Note</strong></span>: You
    could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
    <code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
    enrich your data.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_indexing"></a>Indexing</h3></div></div></div><pre class="programlisting prettyprint lang-js">curl -X PUT 'localhost:9200/music/song/1?refresh=true' -d '{
    "name" : "Nevermind",
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "output": "Nirvana - Nevermind",
        "payload" : { "artistId" : 2321 },
        "weight" : 34
    }
}'</pre><p>The following parameters are supported:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">input</code>
</span></dt><dd>
    The input to store, this can be a an array of strings or just
    a string. This field is mandatory.
</dd><dt><span class="term">
<code class="literal">output</code>
</span></dt><dd>
    The string to return, if a suggestion matches. This is very
    useful to normalize outputs (i.e. have them always in the format
    <code class="literal">artist - songname</code>. This is optional.
</dd><dt><span class="term">
<code class="literal">payload</code>
</span></dt><dd>
    An arbitrary JSON object, which is simply returned in the
    suggest option. You could store data like the id of a document, in order
    to load it from elasticsearch without executing another search (which
    might not yield any results, if <code class="literal">input</code> and <code class="literal">output</code> differ strongly).
</dd><dt><span class="term">
<code class="literal">weight</code>
</span></dt><dd>
    A positive integer, which defines a weight and allows you to
    rank your suggestions. This field is optional.
</dd></dl></div><p>[NOTE] Even though you are losing most of the features of the
completion suggest, you can opt in for the shortest form, which even
allows you to use inside of multi_field. But keep in mind, that you will
not be able to use several inputs, an output, payloads or weights.</p><pre class="programlisting prettyprint lang-js">{
  "suggest" : "Nirvana"
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_querying"></a>Querying</h3></div></div></div><p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>.</p><pre class="programlisting prettyprint lang-js">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest"
        }
    }
}'

{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "n",
    "offset" : 0,
    "length" : 4,
    "options" : [ {
      "text" : "Nirvana - Nevermind",
      "score" : 34.0, "payload" : {"artistId":2321}
    } ]
  } ]
}</pre><p>As you can see, the payload is included in the response, if configured
appropriately. If you configured a weight for a suggestion, this weight
is used as <code class="literal">score</code>. Also the <code class="literal">text</code> field uses the <code class="literal">output</code> of your
indexed suggestion, if configured, otherwise the matched part of the
<code class="literal">input</code> field.</p></div></div><div class="navfooter"><span class="prev"><a href="search-suggesters-phrase.html">
              « 
              Phrase Suggester</a>
           
        </span><span class="next">
           
          <a href="search-multi-search.html">Multi Search API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
