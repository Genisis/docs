<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Geo Distance Filter</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="query-dsl-filters.html" title="Filters" /><link rel="prev" href="query-dsl-geo-bounding-box-filter.html" title="Geo Bounding Box Filter" /><link rel="next" href="query-dsl-geo-distance-range-filter.html" title="Geo Distance Range Filter" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> &gt; <span class="breadcrumb-node">Geo Distance Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-bounding-box-filter.html">
              « 
              Geo Bounding Box Filter</a>
           
        </span><span class="next">
           
          <a href="query-dsl-geo-distance-range-filter.html">Geo Distance Range Filter
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-distance-filter"></a>Geo Distance Filter</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-and-filter.html">And Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-bool-filter.html">Bool Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-exists-filter.html">Exists Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-bounding-box-filter.html">Geo Bounding Box Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-distance-filter.html">Geo Distance Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-distance-range-filter.html">Geo Distance Range Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-polygon-filter.html">Geo Polygon Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geo-shape-filter.html">GeoShape Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-geohash-cell-filter.html">Geohash Cell Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-has-child-filter.html">Has Child Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-has-parent-filter.html">Has Parent Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-ids-filter.html">Ids Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-limit-filter.html">Limit Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-match-all-filter.html">Match All Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-missing-filter.html">Missing Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-nested-filter.html">Nested Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-not-filter.html">Not Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-numeric-range-filter.html">Numeric Range Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-or-filter.html">Or Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-prefix-filter.html">Prefix Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-query-filter.html">Query Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-range-filter.html">Range Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-regexp-filter.html">Regexp Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-script-filter.html">Script Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-term-filter.html">Term Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-terms-filter.html">Terms Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="query-dsl-type-filter.html">Type Filter</a></span></dt></dl></div><p>Filters documents that include only hits that exists within a specific
distance from a geo point. Assuming the following indexed json:</p><pre class="programlisting prettyprint noescape lang-js">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre><p>Then the following simple query can be executed with a <code class="literal">geo_distance</code>
filter:</p><pre class="programlisting prettyprint noescape lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "200km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre><h4><a id="_accepted_formats_3"></a>Accepted Formats</h4><p>In much the same way the <code class="literal">geo_point</code> type can accept different
representation of the geo point, the filter can accept it as well:</p><h5><a id="_lat_lon_as_properties_4"></a>Lat Lon As Properties</h5><pre class="programlisting prettyprint noescape lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_array_4"></a>Lat Lon As Array</h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><pre class="programlisting prettyprint noescape lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : [40, -70]
            }
        }
    }
}</pre><h5><a id="_lat_lon_as_string_4"></a>Lat Lon As String</h5><p>Format in <code class="literal">lat,lon</code>.</p><pre class="programlisting prettyprint noescape lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "40,-70"
            }
        }
    }
}</pre><h5><a id="_geohash_4"></a>Geohash</h5><pre class="programlisting prettyprint noescape lang-js">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "drm3btev3e86"
            }
        }
    }
}</pre><h4><a id="_options_3"></a>Options</h4><p>The following are options allowed on the filter:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Option </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">distance</code></p></td><td align="left" valign="top"><p>The distance to include hits in the filter. The distance
can be a numeric value, and then the <code class="literal">unit</code> (either <code class="literal">mi</code>/@miles@ or <code class="literal">km</code>
can be set) controlling the unit. Or a single string with the unit as
well.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">distance_type</code></p></td><td align="left" valign="top"><p>How to compute the distance. Can either be <code class="literal">arc</code>
(better precision) or <code class="literal">plane</code> (faster). Defaults to <code class="literal">arc</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">optimize_bbox</code></p></td><td align="left" valign="top"><p>Will an optimization of using first a bounding box
check will be used. Defaults to <code class="literal">memory</code> which will do in memory checks.
Can also have values of <code class="literal">indexed</code> to use indexed value check (make sure
the <code class="literal">geo_point</code> type index lat lon in this case), or <code class="literal">none</code> which
disables bounding box optimization.</p></td></tr></tbody></table></div><h4><a id="_geo_point_type_2"></a>geo_point Type</h4><p>The filter <span class="strong"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p><h4><a id="_multi_location_per_document_2"></a>Multi Location Per Document</h4><p>The <code class="literal">geo_distance</code> filter can work with multiple locations / points per
document. Once a single location / point matches the filter, the
document will be included in the filter.</p><h4><a id="_caching_5"></a>Caching</h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong"><strong>result</strong></span> of the filter. This is handy when
the same point and distance parameters are used on several (many) other
queries. Note, the process of caching the first execution is higher when
caching (since it needs to satisfy different queries).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-bounding-box-filter.html">
              « 
              Geo Bounding Box Filter</a>
           
        </span><span class="next">
           
          <a href="query-dsl-geo-distance-range-filter.html">Geo Distance Range Filter
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
