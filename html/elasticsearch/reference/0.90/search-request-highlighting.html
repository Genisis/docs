<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Highlighting</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="search-request-body.html" title="Request Body Search" /><link rel="prev" href="search-request-filter.html" title="Filter" /><link rel="next" href="search-request-rescore.html" title="Rescoring" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> &gt; <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> &gt; <span class="breadcrumb-node">Highlighting</span></div><div class="navheader"><span class="prev"><a href="search-request-filter.html">
              « 
              Filter</a>
           
        </span><span class="next">
           
          <a href="search-request-rescore.html">Rescoring
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-highlighting"></a>Highlighting</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-query.html">Query</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-from-size.html">From / Size</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-sort.html">Sort</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-fields.html">Fields</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-script-fields.html">Script Fields</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-filter.html">Filter</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-highlighting.html">Highlighting</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-rescore.html">Rescoring</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-search-type.html">Search Type</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-scroll.html">Scroll</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-preference.html">Preference</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-explain.html">Explain</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-version.html">Version</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-index-boost.html">Index Boost</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-min-score.html">min_score</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="section"><a href="search-request-named-filters.html">Named Filters</a></span></dt></dl></div><p>Allows to highlight search results on one or more fields. The
implementation uses either the lucene <code class="literal">fast-vector-highlighter</code> or
<code class="literal">highlighter</code>. The search request body:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {}
        }
    }
}</pre><p>In the above case, the <code class="literal">content</code> field will be highlighted for each
search hit (there will be another element in each search hit, called
<code class="literal">highlight</code>, which includes the highlighted fields and the highlighted
fragments).</p><p>In order to perform highlighting, the actual content of the field is
required. If the field in question is stored (has <code class="literal">store</code> set to <code class="literal">yes</code>
in the mapping), it will be used, otherwise, the actual <code class="literal">_source</code> will
be loaded and the relevant field will be extracted from it.</p><p>If <code class="literal">term_vector</code> information is provided by setting <code class="literal">term_vector</code> to
<code class="literal">with_positions_offsets</code> in the mapping then the fast vector
highlighter will be used instead of the plain highlighter.  The fast vector highlighter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Is faster especially for large fields (&gt; <code class="literal">1MB</code>)
</li><li class="listitem">
Can be customized with <code class="literal">boundary_chars</code>, <code class="literal">boundary_max_scan</code>, and
 <code class="literal">fragment_offset</code> (see below)
</li><li class="listitem">
Requires setting <code class="literal">term_vector</code> to <code class="literal">with_positions_offsets</code> which
  increases the size of the index
</li></ul></div><p>Here is an example of setting the <code class="literal">content</code> field to allow for
highlighting using the fast vector highlighter on it (this will cause
the index to be bigger):</p><pre class="programlisting prettyprint noescape lang-js">{
    "type_name" : {
        "content" : {"term_vector" : "with_positions_offsets"}
    }
}</pre><p>Since <code class="literal">0.20.2</code> the field name support wildcard notation, for example,
using <code class="literal">comment_*</code> which will cause all fields that match the expression
to be highlighted.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlighting_tags"></a>Highlighting Tags</h3></div></div></div><p>By default, the highlighting will wrap highlighted text in <code class="literal">&lt;em&gt;</code> and
<code class="literal">&lt;/em&gt;</code>. This can be controlled by setting <code class="literal">pre_tags</code> and <code class="literal">post_tags</code>,
for example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],
        "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</pre><p>There can be a single tag or more, and the "importance" is ordered.
There are also built in "tag" schemas, with currently a single schema
called <code class="literal">styled</code> with <code class="literal">pre_tags</code> of:</p><pre class="programlisting prettyprint noescape lang-js">&lt;em class="hlt1"&gt;, &lt;em class="hlt2"&gt;, &lt;em class="hlt3"&gt;,
&lt;em class="hlt4"&gt;, &lt;em class="hlt5"&gt;, &lt;em class="hlt6"&gt;,
&lt;em class="hlt7"&gt;, &lt;em class="hlt8"&gt;, &lt;em class="hlt9"&gt;,
&lt;em class="hlt10"&gt;</pre><p>And post tag of <code class="literal">&lt;/em&gt;</code>. If you think of more nice to have built in tag
schemas, just send an email to the mailing list or open an issue. Here
is an example of switching tag schemas:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "tags_schema" : "styled",
        "fields" : {
            "content" : {}
        }
    }
}</pre><p>An <code class="literal">encoder</code> parameter can be used to define how highlighted text will
be encoded. It can be either <code class="literal">default</code> (no encoding) or <code class="literal">html</code> (will
escape html, if you use html highlighting tags).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlighted_fragments"></a>Highlighted Fragments</h3></div></div></div><p>Each field highlighted can control the size of the highlighted fragment
in characters (defaults to <code class="literal">100</code>), and the maximum number of fragments
to return (defaults to <code class="literal">5</code>). For example:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre><p>On top of this it is possible to specify that highlighted fragments are
order by score:</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre><p>Note the score of text fragment in this case is calculated by Lucene
highlighting framework. For implementation details you can check
<code class="literal">ScoreOrderFragmentsBuilder.java</code> class.</p><p>If the <code class="literal">number_of_fragments</code> value is set to 0 then no fragments are
produced, instead the whole content of the field is returned, and of
course it is highlighted. This can be very handy if short texts (like
document title or address) need to be highlighted but no fragmentation
is required. Note that <code class="literal">fragment_size</code> is ignored in this case.</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "_all" : {},
            "bio.title" : {"number_of_fragments" : 0}
        }
    }
}</pre><p>When using <code class="literal">fast-vector-highlighter</code> one can use <code class="literal">fragment_offset</code>
parameter to control the margin to start highlighting from.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_global_settings"></a>Global Settings</h3></div></div></div><p>Highlighting settings can be set on a global level and then overridden
at the field level.</p><pre class="programlisting prettyprint noescape lang-js">{
    "query" : {...},
    "highlight" : {
        "number_of_fragments" : 3,
        "fragment_size" : 150,
        "tag_schema" : "styled",
        "fields" : {
            "_all" : { "pre_tags" : ["&lt;em&gt;"], "post_tags" : ["&lt;/em&gt;"] },
            "bio.title" : { "number_of_fragments" : 0 },
            "bio.author" : { "number_of_fragments" : 0 },
            "bio.content" : { "number_of_fragments" : 5, "order" : "score" }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_require_field_match"></a>Require Field Match</h3></div></div></div><p><code class="literal">require_field_match</code> can be set to <code class="literal">true</code> which will cause a field to
be highlighted only if a query matched that field. <code class="literal">false</code> means that
terms are highlighted on all requested fields regardless if the query
matches specifically on them.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_boundary_characters"></a>Boundary Characters</h3></div></div></div><p>When highlighting a field that is mapped with term vectors,
<code class="literal">boundary_chars</code> can be configured to define what constitutes a boundary
for highlighting. It’s a single string with each boundary character
defined in it. It defaults to <code class="literal">.,!? \t\n</code>.</p><p>The <code class="literal">boundary_max_scan</code> allows to control how far to look for boundary
characters, and defaults to <code class="literal">20</code>.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-filter.html">
              « 
              Filter</a>
           
        </span><span class="next">
           
          <a href="search-request-rescore.html">Rescoring
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
