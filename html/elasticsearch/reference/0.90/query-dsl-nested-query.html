<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Nested Query</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="query-dsl-queries.html" title="Queries" /><link rel="prev" href="query-dsl-mlt-field-query.html" title="More Like This Field Query" /><link rel="next" href="query-dsl-prefix-query.html" title="Prefix Query" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> &gt; <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> &gt; <span class="breadcrumb-node">Nested Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-mlt-field-query.html">
              « 
              More Like This Field Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-prefix-query.html">Prefix Query
               » 
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-query"></a>Nested Query</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="query-dsl-match-query.html">Match Query</a></span></dt><dt><span class="section"><a href="query-dsl-multi-match-query.html">Multi Match Query</a></span></dt><dt><span class="section"><a href="query-dsl-bool-query.html">Bool Query</a></span></dt><dt><span class="section"><a href="query-dsl-boosting-query.html">Boosting Query</a></span></dt><dt><span class="section"><a href="query-dsl-common-terms-query.html">Common Terms Query</a></span></dt><dt><span class="section"><a href="query-dsl-custom-filters-score-query.html">Custom Filters Score Query</a></span></dt><dt><span class="section"><a href="query-dsl-custom-score-query.html">Custom Score Query</a></span></dt><dt><span class="section"><a href="query-dsl-custom-boost-factor-query.html">Custom Boost Factor Query</a></span></dt><dt><span class="section"><a href="query-dsl-constant-score-query.html">Constant Score Query</a></span></dt><dt><span class="section"><a href="query-dsl-dis-max-query.html">Dis Max Query</a></span></dt><dt><span class="section"><a href="query-dsl-field-query.html">Field Query</a></span></dt><dt><span class="section"><a href="query-dsl-filtered-query.html">Filtered Query</a></span></dt><dt><span class="section"><a href="query-dsl-flt-query.html">Fuzzy Like This Query</a></span></dt><dt><span class="section"><a href="query-dsl-flt-field-query.html">Fuzzy Like This Field Query</a></span></dt><dt><span class="section"><a href="query-dsl-function-score-query.html">Function Score Query</a></span></dt><dt><span class="section"><a href="query-dsl-fuzzy-query.html">Fuzzy Query</a></span></dt><dt><span class="section"><a href="query-dsl-geo-shape-query.html">GeoShape Query</a></span></dt><dt><span class="section"><a href="query-dsl-has-child-query.html">Has Child Query</a></span></dt><dt><span class="section"><a href="query-dsl-has-parent-query.html">Has Parent Query</a></span></dt><dt><span class="section"><a href="query-dsl-ids-query.html">Ids Query</a></span></dt><dt><span class="section"><a href="query-dsl-indices-query.html">Indices Query</a></span></dt><dt><span class="section"><a href="query-dsl-match-all-query.html">Match All Query</a></span></dt><dt><span class="section"><a href="query-dsl-mlt-query.html">More Like This Query</a></span></dt><dt><span class="section"><a href="query-dsl-mlt-field-query.html">More Like This Field Query</a></span></dt><dt><span class="section"><a href="query-dsl-nested-query.html">Nested Query</a></span></dt><dt><span class="section"><a href="query-dsl-prefix-query.html">Prefix Query</a></span></dt><dt><span class="section"><a href="query-dsl-query-string-query.html">Query String Query</a></span></dt><dt><span class="section"><a href="query-dsl-range-query.html">Range Query</a></span></dt><dt><span class="section"><a href="query-dsl-regexp-query.html">Regexp Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-first-query.html">Span First Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-multi-term-query.html">Span Multi Term Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-near-query.html">Span Near Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-not-query.html">Span Not Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-or-query.html">Span Or Query</a></span></dt><dt><span class="section"><a href="query-dsl-span-term-query.html">Span Term Query</a></span></dt><dt><span class="section"><a href="query-dsl-term-query.html">Term Query</a></span></dt><dt><span class="section"><a href="query-dsl-terms-query.html">Terms Query</a></span></dt><dt><span class="section"><a href="query-dsl-top-children-query.html">Top Children Query</a></span></dt><dt><span class="section"><a href="query-dsl-wildcard-query.html">Wildcard Query</a></span></dt><dt><span class="section"><a href="query-dsl-text-query.html">Text Query</a></span></dt><dt><span class="section"><a href="query-dsl-minimum-should-match.html">Minimum Should Match</a></span></dt><dt><span class="section"><a href="query-dsl-multi-term-rewrite.html">Multi Term Query Rewrite</a></span></dt></dl></div><p>Nested query allows to query nested objects / docs (see
<a class="link" href="mapping-nested-type.html" title="Nested Type">nested mapping</a>). The
query is executed against the nested objects / docs as if they were
indexed as separate docs (they are, internally) and resulting in the
root parent doc (or parent nested mapping). Here is a sample mapping we
will work with:</p><pre class="programlisting prettyprint lang-js">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre><p>And here is a sample nested query usage:</p><pre class="programlisting prettyprint lang-js">{
    "nested" : {
        "path" : "obj1",
        "score_mode" : "avg",
        "query" : {
            "bool" : {
                "must" : [
                    {
                        "match" : {"obj1.name" : "blue"}
                    },
                    {
                        "range" : {"obj1.count" : {"gt" : 5}}
                    }
                ]
            }
        }
    }
}</pre><p>The query <code class="literal">path</code> points to the nested object path, and the <code class="literal">query</code> (or
<code class="literal">filter</code>) includes the query that will run on the nested docs matching
the direct path, and joining with the root parent docs.</p><p>The <code class="literal">score_mode</code> allows to set how inner children matching affects
scoring of parent. It defaults to <code class="literal">avg</code>, but can be <code class="literal">total</code>, <code class="literal">max</code> and
<code class="literal">none</code>.</p><p>Multi level nesting is automatically supported, and detected, resulting
in an inner nested query to automatically match the relevant nesting
level (and not root) if it exists within another nested query.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-mlt-field-query.html">
              « 
              More Like This Field Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-prefix-query.html">Prefix Query
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
