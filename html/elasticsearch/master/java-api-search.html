<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Search Java API</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference" /><link rel="up" href="java-api.html" title="Java API" /><link rel="prev" href="java-api-bulk.html" title="Bulk Java API" /><link rel="next" href="java-api-count.html" title="Count Java API" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link xmlns="" rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link xmlns="" rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1376314515" type="text/css" media="all" /><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/modernizr-2.6.1.min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/vendor/selectivizr-min.js?ver=1"></script><script xmlns="" type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/plugins.min.js?ver=1375472072"></script><link xmlns="" rel="stylesheet" type="text/css" href="styles.css" /></head><body class="single single-guide"><div class="global_wrapper"><div id="index" class="page_content"><div class="container"><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="java-api.html">Java API</a></span> &gt; <span class="breadcrumb-node">Search Java API</span></div><div class="navheader"><span class="prev"><a href="java-api-bulk.html">
              « 
              Bulk Java API</a>
           
        </span><span class="next">
           
          <a href="java-api-count.html">Count Java API
               » 
            </a></span></div><div xmlns="http://www.w3.org/1999/xhtml" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="java-api-search"></a>Search Java API</h2></div></div></div><div xmlns="" class="toc"><dl><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-client.html">Java Client</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-index_.html">Index Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-get.html">Get Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-delete.html">Delete Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-bulk.html">Bulk Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-search.html">Search Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-count.html">Count Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-delete-by-query.html">Delete By Query Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-facets.html">Java Facets</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-percolate.html">Percolate Java API</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-query-dsl-queries.html">Java Query DSL - Queries</a></span></dt><dt xmlns="http://www.w3.org/1999/xhtml"><span class="chapter"><a href="java-api-query-dsl-filters.html">Java Query DSL - Filters</a></span></dt></dl></div><p>The search API allows to execute a search query and get back search hits
that match the query. It can be executed across one or more indices and
across one or more types. The query can either be provided using the
<a class="link" href="java-api-query-dsl-queries.html" title="Java Query DSL - Queries">query Java API</a> or
the <a class="link" href="java-api-query-dsl-filters.html" title="Java Query DSL - Filters">filter Java API</a>. The body of the search request is built using the
<code class="literal">SearchSourceBuilder</code>. Here is an example:</p><pre class="programlisting prettyprint noescape lang-java">import org.elasticsearch.action.search.SearchResponse;
import org.elasticsearch.action.search.SearchType;
import org.elasticsearch.index.query.FilterBuilders.*;
import org.elasticsearch.index.query.QueryBuilders.*;</pre><pre class="programlisting prettyprint noescape lang-java">SearchResponse response = client.prepareSearch("index1", "index2")
        .setTypes("type1", "type2")
        .setSearchType(SearchType.DFS_QUERY_THEN_FETCH)
        .setQuery(QueryBuilders.termQuery("multi", "test"))             // Query
        .setFilter(FilterBuilders.rangeFilter("age").from(12).to(18))   // Filter
        .setFrom(0).setSize(60).setExplain(true)
        .execute()
        .actionGet();</pre><p>Note that all parameters are optional. Here is the smallest search call
you can write:</p><pre class="programlisting prettyprint noescape lang-java">// MatchAll on the whole cluster with all default options
SearchResponse response = client.prepareSearch().execute().actionGet();</pre><p>For more information on the search operation, check out the REST
<a class="link" href="search-api-search.html" title="Search">search</a> docs.</p><h3><a id="_using_scrolls_in_java"></a>Using scrolls in Java</h3><p>Read the <a class="link" href="search-api-search-scroll.html" title="Scroll">scroll documentation</a> first!</p><pre class="programlisting prettyprint noescape lang-java">import static org.elasticsearch.index.query.FilterBuilders.*;
import static org.elasticsearch.index.query.QueryBuilders.*;

QueryBuilder qb = termQuery("multi", "test");

SearchResponse scrollResp = client.prepareSearch(test)
        .setSearchType(SearchType.SCAN)
        .setScroll(new TimeValue(60000))
        .setQuery(qb)
        .setSize(100).execute().actionGet(); //100 hits per shard will be returned for each scroll
//Scroll until no hits are returned
while (true) {
    scrollResp = client.prepareSearchScroll(scrollResp.getScrollId()).setScroll(new TimeValue(600000)).execute().actionGet();
    for (SearchHit hit : scrollResp.getHits()) {
        //Handle the hit...
    }
    //Break condition: No hits are returned
    if (scrollResp.hits().hits().length == 0) {
        break;
    }
}</pre><h3><a id="_operation_threading_4"></a>Operation Threading</h3><p>The search API allows to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p><p>There are three threading modes.The <code class="literal">NO_THREADS</code> mode means that the
search operation will be executed on the calling thread. The
<code class="literal">SINGLE_THREAD</code> mode means that the search operation will be executed on
a single different thread for all local shards. The <code class="literal">THREAD_PER_SHARD</code>
mode means that the search operation will be executed on a different
thread for each local shard.</p><p>The default mode is <code class="literal">SINGLE_THREAD</code>.</p><h3><a id="_multisearch_api"></a>MultiSearch API</h3><p>See <a class="link" href="search-api-multi-search.html" title="Multi Search API">MultiSearch API Query</a>
documentation</p><pre class="programlisting prettyprint noescape lang-java">SearchRequestBuilder srb1 = node.client()
    .prepareSearch().setQuery(QueryBuilders.queryString("elasticsearch")).setSize(1);
SearchRequestBuilder srb2 = node.client()
    .prepareSearch().setQuery(QueryBuilders.matchQuery("name", "kimchy")).setSize(1);

MultiSearchResponse sr = node.client().prepareMultiSearch()
        .add(srb1)
        .add(srb2)
        .execute().actionGet();

// You will get all individual responses from MultiSearchResponse#responses()
long nbHits = 0;
for (MultiSearchResponse.Item item : sr.responses()) {
    SearchResponse response = item.response();
    nbHits += response.hits().totalHits();
}</pre><h3><a id="_using_facets"></a>Using Facets</h3><p>The following code shows how to add two facets within your search:</p><pre class="programlisting prettyprint noescape lang-java">SearchResponse sr = node.client().prepareSearch()
    .setQuery(QueryBuilders.matchAllQuery())
    .addFacet(FacetBuilders.termsFacet("f1").field("field"))
    .addFacet(FacetBuilders.dateHistogramFacet("f2").field("birth").interval("year"))
    .execute().actionGet();

// Get your facet results
TermsFacet f1 = (TermsFacet) sr.facets().facetsAsMap().get("f1");
DateHistogramFacet f2 = (DateHistogramFacet) sr.facets().facetsAsMap().get("f2");</pre><p>See <a class="link" href="java-api-facets.html" title="Java Facets">Facets Java API</a>
documentation for details.</p></div><div class="navfooter"><span class="prev"><a href="java-api-bulk.html">
              « 
              Bulk Java API</a>
           
        </span><span class="next">
           
          <a href="java-api-count.html">Count Java API
               » 
            </a></span></div></article></section></div></div></div><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script></body></html>
