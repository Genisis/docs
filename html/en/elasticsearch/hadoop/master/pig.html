<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Apache Pig support</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [master]" /><link rel="up" href="reference.html" title="Reference" /><link rel="prev" href="hive.html" title="Apache Hive integration" /><link rel="next" href="spark.html" title="Apache Spark support" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1395693666" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/style.css" type="text/css" media="all" /><script src="//cdn.optimizely.com/js/281975433.js"></script><script src="//fast.wistia.com/static/iframe-api-v1.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css?3" /></head><body class="single single-guide"><img src="http://ad.retargeter.com/seg?add=1235131&amp;t=2" width="1" height="1" style="position:absolute; visibility:hidden;" /><script type="text/javascript">
        if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-12395217-2']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    }</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><nav role="navigation" id="mobile-nav-container" class="off-canvas-nav"><ul id="mobile-nav" class="menu"><li id="menu-item-75892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-75895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75895"><a href="/overview/">Overview</a></li><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/elasticsearch/">Elasticsearch</a></li><li id="menu-item-75894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75894"><a href="/overview/marvel/">Marvel</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li><li id="menu-item-75893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75893"><a href="/overview/elkdownloads/">ELK Downloads</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-76342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container" class="main-nav"><ul id="top-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a class="btn btn-primary" href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger" aria-hidden="true"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Reference </a></span> » <span class="breadcrumb-node">Apache Pig support</span></div><div class="navheader"><span class="prev"><a href="hive.html">
              « 
              Apache Hive integration</a>
           
        </span><span class="next">
           
          <a href="spark.html">Apache Spark support
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="pig"></a>Apache Pig support<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="arch.html">Architecture</a></span></dt><dt><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt><span class="chapter"><a href="configuration-runtime.html">Hadoop runtime options</a></span></dt><dt><span class="chapter"><a href="logging.html">Logging</a></span></dt><dt><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt><span class="chapter"><a href="spark.html">Apache Spark support</a></span></dt><dt><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt><dt><span class="chapter"><a href="metrics.html">Hadoop Metrics</a></span></dt><dt><span class="chapter"><a href="troubleshooting.html">Troubleshooting</a></span></dt></dl></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://pig.apache.org/" target="_top">Apache Pig</a> is a platform for analyzing large data sets that consists of a high-level language for expressing data analysis programs, coupled with infrastructure for evaluating these programs.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Pig website
</span></td></tr></table></div><p>It provides a high-level, powerful, <span class="emphasis"><em>scripting</em></span>-like transformation language which gets compiled into Map/Reduce jobs at runtime by the Pig <span class="emphasis"><em>compiler</em></span>. To simplify working with arbitrary data, Pig associates a <span class="emphasis"><em>schema</em></span> (or type information) with each data set for validation and performance. This in turn, breaks it down into <span class="emphasis"><em>discrete</em></span> data types that can be transformed through various operators or custom functions (or <a class="ulink" href="http://pig.apache.org/docs/r0.12.1/udf.html" target="_top">UDF</a>s). Data can be loaded from and stored to various storages such as the local file-system or HDFS, and with elasticsearch-hadoop into Elasticsearch as well.</p><h3><a id="pig-installation"></a>Installation<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In order to use elasticsearch-hadoop, its jar needs to be in Pig’s classpath. There are various ways of making that happen though typically the <a class="ulink" href="http://pig.apache.org/docs/r0.12.1/basic.html#register" target="_top">REGISTER</a> command is used:</p><pre class="programlisting prettyprint lang-sql">REGISTER /path/elasticsearch-hadoop.jar;</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>the command expects a proper URI that can be found either on the local file-system or remotely. Typically it’s best to use a distributed file-system (like HDFS or Amazon S3) and use that since the script might be executed
on various machines.</p></div></div><p>As an alternative, when using the command-line, one can register additional jars through the <code class="literal">-Dpig.additional.jars</code> option (that accepts an URI as well):</p><pre class="programlisting prettyprint lang-bash">$ pig -Dpig.additional.jars=/path/elasticsearch-hadoop.jar:&lt;other.jars&gt; script.pig</pre><p>or if the jars are on HDFS</p><pre class="programlisting prettyprint lang-bash">$ pig \
-Dpig.additional.jars=hdfs://&lt;cluster-name&gt;:&lt;cluster-port&gt;/&lt;path&gt;/elasticsearch-hadoop.jar:&lt;other.jars&gt; script.pig</pre><h3><a id="pig-configuration"></a>Configuration<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>With Pig, one can specify the <a class="link" href="configuration.html" title="Configuration">configuration</a> properties (as an alternative to Hadoop <code class="literal">Configuration</code> object) as a constructor parameter when declaring <code class="literal">EsStorage</code>:</p><pre class="programlisting prettyprint lang-sql">STORE B INTO 'radio/artists'<a id="CO33-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span> USING org.elasticsearch.hadoop.pig.EsStorage
             ('es.http.timeout = 5m<a id="CO33-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>',
              'es.index.auto.create = false' <a id="CO33-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop configuration (target resource)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop option (http timeout)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
another elasticsearch-hadoop configuration (disable automatic index creation)
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>To avoid having to specify the fully qualified class name (<code class="literal">org.elasticsearch.hadoop.pig.EsStorage</code>), consider using a shortcut through <a class="ulink" href="http://pig.apache.org/docs/r0.11.1/basic.html#define" target="_top"><code class="literal">DEFINE</code></a> command:</p></div></div><pre class="programlisting prettyprint lang-sql">DEFINE EsStorage org.elasticsearch.hadoop.pig.EsStorage();</pre><p>Do note that it is possible (and recommended) to specify the configuration parameters to reduce script duplication, such as <code class="literal">es.query</code> or <code class="literal">es.mapping.names</code>:</p><pre class="programlisting prettyprint lang-sql">DEFINE EsStorage org.elasticsearch.hadoop.pig.EsStorage('my.cfg.param=value');</pre><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Pig definitions are replaced as are; even though the syntax allows <span class="emphasis"><em>parametrization</em></span>, Pig will silently ignore any parameters outside the <code class="literal">DEFINE</code> declaration.</p></div></div><h4><a id="tuple-names"></a>Tuple field names<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Among the <a class="ulink" href="http://pig.apache.org/docs/r0.12.1/basic.html#data-types" target="_top">various types</a> available in Pig, <code class="literal">tuple</code>s are used the most. Tuples are defined as “ordered sets of fields” (e.g. <code class="literal">(19,2)</code>) however structurally they are shaped
as ordered <span class="emphasis"><em>maps</em></span> since each field has a name, which may be defined or not (e.g. <code class="literal">(field:19, another:2)</code>).
Obeying the rule of <a class="ulink" href="http://en.wikipedia.org/wiki/Principle_of_least_astonishment" target="_top">least surprise</a>, elasticsearch-hadoop by default will <span class="emphasis"><em>disregard</em></span> a tuple field names, both when writing and reading.</p><p>To change this behavior (which in effect means treating tuples as maps instead of sets or arrays), use the boolean property <code class="literal">es.mapping.pig.tuple.use.field.names</code> (by default <code class="literal">false</code>) and set it to <code class="literal">true</code>.</p><p>The table below illustrates the difference between the two settings:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="center" valign="top"> Tuple schema </th><th align="center" valign="top"> Tuple value </th><th align="center" valign="top"> Resulting JSON representation</th></tr></thead><tbody><tr><td colspan="3" align="center" valign="top"><p><span class="strong"><strong><code class="literal">es.mapping.pig.tuple.use.field.names</code> <span class="strong"><strong><code class="literal">false</code></strong></span> (default)</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">(foo: (nr:int, name:chararray))</code></p></td><td align="center" valign="top"><p><code class="literal">(1,"kimchy")</code></p></td><td align="center" valign="top"><p><code class="literal">{"foo":[1, "kimchy"]}</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">(bar: (int, chararray))</code></p></td><td align="center" valign="top"><p><code class="literal">(1,"kimchy")</code></p></td><td align="center" valign="top"><p><code class="literal">{"bar":[1, "kimchy"]}</code></p></td></tr><tr><td colspan="3" align="center" valign="top"><p><span class="strong"><strong><code class="literal">es.mapping.pig.tuple.use.field.names</code> <span class="strong"><strong><code class="literal">true</code></strong></span></strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">(foo: (nr:int, name:chararray))</code></p></td><td align="center" valign="top"><p><code class="literal">(1,"kimchy")</code></p></td><td align="center" valign="top"><p><code class="literal">{"foo":[{"nr":1, "name":"kimchy"]}</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">(bar: (int, chararray))</code></p></td><td align="center" valign="top"><p><code class="literal">(1,"kimchy")</code></p></td><td align="center" valign="top"><p><code class="literal">{"bar":["val_0":1, "val_1":"name"]}</code></p></td></tr></tbody></table></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>When using tuples, it is <span class="emphasis"><em>highly</em></span> recommended to create the index mapping before-hand as it is quite common for tuples to contain mixed types (numbers, strings, other tuples, etc…) which, when mapped as an array (the default) can cause parsing errors (as the automatic mapping can infer the fields to be numbers instead of strings, etc…). In fact, the example above falls in this category since the tuple contains both a number (<code class="literal">1</code>) and a string (<code class="literal">"kimchy"</code>), which will the auto-detection to map both <code class="literal">foo</code> and <code class="literal">bar</code> as a number and thus causing an exception when encountering <code class="literal">"kimchy"</code>. Please refer to <a class="link" href="mapping.html#auto-mapping-type-loss">this</a> for more information.
Additionally consider <code class="literal">breaking</code>/<code class="literal">flatten</code>ing the tuple into primitive/data atoms before sending the data off to Elasticsearch.</p></div></div><h3><a id="pig-alias"></a>Mapping<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Out of the box, elasticsearch-hadoop uses the Pig schema to map the data in Elasticsearch, using both the field names and types in the process. There are cases however when the names in Pig cannot
be used with Elasticsearch (invalid characters, existing names with different layout, etc…). For such cases, one can use the <code class="literal">es.mapping.names</code> setting which accepts a comma-separated list of names mapping in the following format: <code class="literal">Pig field name</code> : <code class="literal">{es} field name</code></p><p>For example:</p><pre class="programlisting prettyprint lang-sql">STORE B INTO  '...' USING org.elasticsearch.hadoop.pig.EsStorage(
        '<a id="CO34-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>es.mapping.names=date:@timestamp<a id="CO34-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>, uRL:url<a id="CO34-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>')</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
name mapping for two fields
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Pig column <code class="literal">date</code> mapped in Elasticsearch to <code class="literal">@timestamp</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Pig column <code class="literal">url</code> mapped in Elasticsearch to <code class="literal">url_123</code>
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Elasticsearch accepts only lower-case field name and, as such, elasticsearch-hadoop will always convert Pig column names to lower-case. Because Pig is <span class="strong"><strong>case sensitive</strong></span>, elasticsearch-hadoop handles the reverse
field mapping as well. It is recommended to use the default Pig style and use upper-case names only for commands and avoid mixed-case names.</p></div></div><h3><a id="_writing_data_to_elasticsearch_3"></a>Writing data to Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Elasticsearch is exposed as a native <code class="literal">Storage</code> to Pig so it can be used to store data into it:</p><pre class="programlisting prettyprint lang-sql">-- load data from HDFS into Pig using a schema
A = LOAD 'src/test/resources/artists.dat' USING PigStorage()
                    AS (id:long, name, url:chararray, picture: chararray);
-- transform data
B = FOREACH A GENERATE name, TOTUPLE(url, picture) AS links;
-- save the result to Elasticsearch
STORE B INTO 'radio/artists'<a id="CO35-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span> USING org.elasticsearch.hadoop.pig.EsStorage(<a id="CO35-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource (index and type) associated with the given storage
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
additional configuration parameters can be passed here - in this case the defaults are used
</p></td></tr></table></div><h4><a id="_writing_existing_json_to_elasticsearch_2"></a>Writing existing JSON to Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When the job output data is already in JSON, elasticsearch-hadoop allows direct indexing <span class="emphasis"><em>without</em></span> applying any transformation; the data is taken as is and sent directly to Elasticsearch. In such cases, one needs to indicate the json input by setting
the <code class="literal">es.input.json</code> parameter. As such, in this case elasticsearch-hadoop expects to receive a tuple with a single field (representing the JSON document); the library will recognize common <span class="emphasis"><em>textual</em></span> types such as <code class="literal">chararray</code> or <code class="literal">bytearray</code> otherwise it just calls <code class="literal">toString</code> to get a hold of the JSON content.</p><div class="table"><a id="id-1.3.10.39"></a><p class="title"><strong>Table 4. Pig types to use for JSON representation</strong></p><div class="table-contents"><table summary="Pig types to use for JSON representation" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top"> <code class="literal">Pig type</code> </th><th align="center" valign="top"> Comment</th></tr></thead><tbody><tr><td align="center" valign="top"><p><code class="literal">bytearray</code></p></td><td align="center" valign="top"><p>use this when the JSON data is represented as a <code class="literal">byte[]</code> or similar</p></td></tr><tr><td align="center" valign="top"><p><code class="literal">chararray</code></p></td><td align="center" valign="top"><p>use this if the JSON data is represented as a <code class="literal">String</code></p></td></tr><tr><td align="center" valign="top"><p><span class="emphasis"><em>anything else</em></span></p></td><td align="center" valign="top"><p>make sure the <code class="literal">toString()</code> returns the desired JSON document</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Make sure the data is properly encoded, in <code class="literal">UTF-8</code>. The field content is considered the final form of the document sent to Elasticsearch.</p></div></div><pre class="programlisting prettyprint lang-sql">A = LOAD '/resources/artists.json' USING PigStorage() AS (json:chararray<a id="CO36-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>);"
STORE B INTO 'radio/artists'
    USING org.elasticsearch.hadoop.pig.EsStorage('es.input.json=true'<a id="CO36-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>...);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Load the (JSON) data as a single field (<code class="literal">json</code>)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Indicate the input is of type JSON.
</p></td></tr></table></div><h4><a id="_writing_to_dynamic_multi_resources_3"></a>Writing to dynamic/multi-resources<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>One can index the data to a different resource, depending on the <span class="emphasis"><em>row</em></span> being read, by using patterns. Reusing the aforementioned <a class="link" href="configuration.html#cfg-multi-writes" title="Dynamic/multi resource writesedit">media example</a>, one could configure it as follows:</p><pre class="programlisting prettyprint lang-sql">A = LOAD 'src/test/resources/media.dat' USING PigStorage()
            AS (name:chararray, type:chararray <a id="CO37-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>, year: chararray);
STORE B INTO 'my-collection/{type}'<a id="CO37-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span> USING org.elasticsearch.hadoop.pig.EsStorage();</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Tuple field used by the resource pattern. Any of the declared fields can be used.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Resource pattern using field <code class="literal">type</code>
</p></td></tr></table></div><p>For each tuple about to be written, elasticsearch-hadoop will extract the <code class="literal">type</code> field and use its value to determine the target resource.</p><p>The functionality is also available when dealing with raw JSON - in this case, the value will be extracted from the JSON document itself. Assuming the JSON source contains documents with the following structure:</p><pre class="programlisting prettyprint lang-js">{
    "media_type":"game",<a id="CO38-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "title":"Final Fantasy VI",
    "year":"1994"
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
field within the JSON document that will be used by the pattern
</p></td></tr></table></div><p>the table declaration can be as follows:</p><pre class="programlisting prettyprint lang-sql">A = LOAD '/resources/media.json' USING PigStorage() AS (json:chararray<a id="CO39-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>);"
STORE B INTO 'my-collection/{media_type}'<a id="CO39-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    USING org.elasticsearch.hadoop.pig.EsStorage('es.input.json=true');</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Schema declaration for the tuple. Since JSON input is used, the schema is simply a holder to the raw data
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Resource pattern relying on fields <span class="emphasis"><em>within</em></span> the JSON document and <span class="emphasis"><em>not</em></span> on the table schema
</p></td></tr></table></div><h3><a id="_reading_data_from_elasticsearch_4"></a>Reading data from Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>As you would expect, loading the data is straight forward:</p><pre class="programlisting prettyprint lang-sql">-- execute Elasticsearch query and load data into Pig
A = LOAD 'radio/artists'<a id="CO40-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    USING org.elasticsearch.hadoop.pig.EsStorage('es.query=?me*'<a id="CO40-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>);
DUMP A;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO40-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Elasticsearch resource
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO40-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
search query to execute
</p></td></tr></table></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Due to a <a class="ulink" href="https://issues.apache.org/jira/browse/PIG-3646" target="_top">bug</a> in Pig, <code class="literal">LoadFunc+tions are not aware of any schema associated with them. This means +EsStorage</code> is forced to fully the documents
from Elasticsearch before passing the data to Pig for projection. In practice, this has little impact as long as a document top-level fields are used; for nested fields consider extracting the values
yourself in Pig.</p></div></div><h3><a id="pig-type-conversion"></a>Type conversion<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/pig.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If automatic index creation is used, please review <a class="link" href="mapping.html#auto-mapping-type-loss">this</a> section for more information.</p></div></div><p>Pig internally uses native java types for most of its types and elasticsearch-hadoop abides to that convention.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top"> Pig type </th><th align="center" valign="top"> Elasticsearch type</th></tr></thead><tbody><tr><td align="center" valign="top"><p><code class="literal">null</code></p></td><td align="center" valign="top"><p><code class="literal">null</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">chararray</code></p></td><td align="center" valign="top"><p><code class="literal">string</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">int</code></p></td><td align="center" valign="top"><p><code class="literal">int</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">long</code></p></td><td align="center" valign="top"><p><code class="literal">long</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">double</code></p></td><td align="center" valign="top"><p><code class="literal">double</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">float</code></p></td><td align="center" valign="top"><p><code class="literal">float</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bytearray</code></p></td><td align="center" valign="top"><p><code class="literal">binary</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">tuple</code></p></td><td align="center" valign="top"><p><code class="literal">array</code> or <code class="literal">map</code> (depending on <a class="link" href="pig.html#tuple-names" title="Tuple field namesedit">this</a> settings)</p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bag</code></p></td><td align="center" valign="top"><p><code class="literal">array</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">map</code></p></td><td align="center" valign="top"><p><code class="literal">map</code></p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Pig 0.10 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">boolean</code></p></td><td align="center" valign="top"><p><code class="literal">boolean</code></p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Pig 0.11 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">datetime</code></p></td><td align="center" valign="top"><p><code class="literal">date</code></p></td></tr><tr><td colspan="2" align="center" valign="top"><p><span class="strong"><strong>Available in Pig 0.12 or higher</strong></span></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">biginteger</code></p></td><td align="center" valign="top"><p><code class="literal">not supported</code></p></td></tr><tr><td align="center" valign="top"><p><code class="literal">bigdecimal</code></p></td><td align="center" valign="top"><p><code class="literal">not supported</code></p></td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>While Elasticsearch understands the Pig types up to version 0.12.1, it is backwards compatible with Pig 0.9</p></div></div></div><div class="navfooter"><span class="prev"><a href="hive.html">
              « 
              Apache Hive integration</a>
           
        </span><span class="next">
           
          <a href="spark.html">Apache Spark support
               »
            </a></span></div></article></section></div></div></div><footer><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74980" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74980"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_chrome gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/empty-template/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">enter you email<span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><script type="text/javascript">//<![CDATA[
            jQuery(function(){
                jQuery('#gform_submit_button_4').click( function() {
                    if(window["gf_submitting_4"]){
                        return false;
                    }
                    if( !jQuery("#gform_4")[0].checkValidity || jQuery("#gform_4")[0].checkValidity()){
                        window["gf_submitting_4"]=true;
                    }
                });
            });
            //]]></script><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
                    function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);window['gf_submitting_4'] = false;}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);window['gf_submitting_4'] = false;}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
                    //]]></script></div><div class="legal"><p>© 2014 All Rights Reserved - Elasticsearch </p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript">if(window.aiModifyParent) {aiModifyParent();}</script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201413"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/global.min.js?ver=1395082598"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/froogaloop.min.js?ver=1"></script><script type="text/javascript">
if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    document.write(unescape("%3Cscript src='" + document.location.protocol +
    "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
}
</script><script>
if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    Munchkin.init('813-MAM-392');

    // crazyegg
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0014/4686.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
}
</script></body></html>
