<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Scripted Metric Aggregation</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference [master]" /><link rel="up" href="search-aggregations.html" title="Aggregations" /><link rel="prev" href="search-aggregations-metrics-top-hits-aggregation.html" title="Top hits Aggregation" /><link rel="next" href="search-aggregations-bucket-global-aggregation.html" title="Global Aggregation" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1395693666" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/style.css" type="text/css" media="all" /><script src="//cdn.optimizely.com/js/281975433.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css?3" /></head><body class="single single-guide"><!--Google Tag Manager--><script> dataLayer = []; </script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5FTL28" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>
    if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5FTL28');}
</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><nav role="navigation" id="mobile-nav-container" class="off-canvas-nav"><ul id="mobile-nav" class="menu"><li id="menu-item-75892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-75895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75895"><a href="/overview/">Overview</a></li><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/elasticsearch/">Elasticsearch</a></li><li id="menu-item-75894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75894"><a href="/overview/marvel/">Marvel</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li><li id="menu-item-75893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75893"><a href="/overview/elkdownloads/">ELK Downloads</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-76342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container" class="main-nav"><ul id="top-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a class="btn btn-primary" href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger" aria-hidden="true"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs </a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Scripted Metric Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-top-hits-aggregation.html">
              « 
              Top hits Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-scripted-metric-aggregation"></a>Scripted Metric Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="search-aggregations-metrics-min-aggregation.html">Min Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-max-aggregation.html">Max Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-avg-aggregation.html">Avg Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-stats-aggregation.html">Stats Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-extendedstats-aggregation.html">Extended Stats Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-percentile-aggregation.html">Percentiles Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-percentile-rank-aggregation.html">Percentile Ranks Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-geobounds-aggregation.html">Geo Bounds Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-top-hits-aggregation.html">Top hits Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-scripted-metric-aggregation.html">Scripted Metric Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-filter-aggregation.html">Filter Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-filters-aggregation.html">Filters Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-missing-aggregation.html">Missing Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-nested-aggregation.html">Nested Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-reverse-nested-aggregation.html">Reverse nested Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-children-aggregation.html">Children Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-terms-aggregation.html">Terms Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-significantterms-aggregation.html">Significant Terms Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-iprange-aggregation.html">IPv4 Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-histogram-aggregation.html">Histogram Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-datehistogram-aggregation.html">Date Histogram Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-geodistance-aggregation.html">Geo Distance Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation</a></span></dt></dl></div><p>A metric aggregation that executes using scripts to provide a metric output.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h4>Experimental!</h4><p>This feature is marked as experimental, and may be subject to change in the
future.  If you use this feature, please let us know your experience with it!</p></div></div><p>Example:</p><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match_all" : {}
    },
    "aggs": {
        "profit": {
            "scripted_metric": {
                "init_script" : "_agg['transactions'] = []",
                "map_script" : "if (doc['type'].value == \"sale\") { _agg.transactions.add(doc['amount'].value) } else { _agg.transactions.add(-1 * doc['amount'].value) }", <a id="CO23-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                "combine_script" : "profit = 0; for (t in _agg.transactions) { profit += t }; return profit",
                "reduce_script" : "profit = 0; for (a in _aggs) { profit += a }; return profit"
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">map_script</code> is the only required  parameter
</p></td></tr></table></div><p>The above aggregation demonstrates how one would use the script aggregation compute the total profit from sale and cost transactions.</p><p>The response for the above aggregation:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_scope_of_scripts"></a>Scope of scripts<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The scripted metric aggregation uses scripts at 4 stages of its execution:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
init_script
</span></dt><dd><p class="simpara">
Executed prior to any collection of documents. Allows the aggregation to set up any initial state.
</p><p class="simpara">In the above example, the <code class="literal">init_script</code> creates an array <code class="literal">transactions</code> in the <code class="literal">_agg</code> object.</p></dd><dt><span class="term">
map_script
</span></dt><dd><p class="simpara">
Executed once per document collected. This is the only required script. If no combine_script is specified, the resulting state
                    needs to be stored in an object named <code class="literal">_agg</code>.
</p><p class="simpara">In the above example, the <code class="literal">map_script</code> checks the value of the type field. If the value if <span class="emphasis"><em>sale</em></span> the value of the amount field
is added to the transactions array. If the value of the type field is not <span class="emphasis"><em>sale</em></span> the negated value of the amount field is added
to transactions.</p></dd><dt><span class="term">
combine_script
</span></dt><dd><p class="simpara">
Executed once on each shard after document collection is complete. Allows the aggregation to consolidate the state returned from
                    each shard. If a combine_script is not provided the combine phase will return the aggregation variable.
</p><p class="simpara">In the above example, the <code class="literal">combine_script</code> iterates through all the stored transactions, summing the values in the <code class="literal">profit</code> variable
and finally returns <code class="literal">profit</code>.</p></dd><dt><span class="term">
reduce_script
</span></dt><dd><p class="simpara">
Executed once on the coordinating node after all shards have returned their results. The script is provided with access to a
                    variable <code class="literal">_aggs</code> which is an array of the result of the combine_script on each shard. If a reduce_script is not provided
                    the reduce phase will return the <code class="literal">_aggs</code> variable.
</p><p class="simpara">In the above example, the <code class="literal">reduce_script</code> iterates through the <code class="literal">profit</code> returned by each shard summing the values before returning the
final combined profit which will be returned in the response of the aggregation.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_worked_example"></a>Worked Example<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Imagine a situation where you index the following documents into and index with 2 shards:</p><pre class="programlisting prettyprint lang-js">$ curl -XPUT 'http://localhost:9200/transactions/stock/1' -d '{
{
    "type": "sale"
    "amount": 80
}

$ curl -XPUT 'http://localhost:9200/transactions/stock/2' -d '{
{
    "type": "cost"
    "amount": 10
}

$ curl -XPUT 'http://localhost:9200/transactions/stock/3' -d '{
{
    "type": "cost"
    "amount": 30
}

$ curl -XPUT 'http://localhost:9200/transactions/stock/4' -d '{
{
    "type": "sale"
    "amount": 130
}</pre><p>Lets say that documents 1 and 3 end up on shard A and documents 2 and 4 end up on shard B. The following is a breakdown of what the aggregation result is
at each stage of the example above.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_before_init_script"></a>Before init_script<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>No params object was specified so the default params object is used:</p><pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {}
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_init_script"></a>After init_script<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This is run once on each shard before any document collection is performed, and so we will have a copy on each shard:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd><pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</pre></dd><dt><span class="term">
Shard B
</span></dt><dd><pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_map_script"></a>After map_script<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Each shard collects its documents and runs the map_script on each document that is collected:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd><pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {
        "transactions" : [ 80, -30 ]
    }
}</pre></dd><dt><span class="term">
Shard B
</span></dt><dd><pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {
        "transactions" : [ -10, 130 ]
    }
}</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_combine_script"></a>After combine_script<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The combine_script is executed on each shard after document collection is complete and reduces all the transactions down to a single profit figure for each
shard (by summing the values in the transactions array) which is passed back to the coordinating node:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd>
50
</dd><dt><span class="term">
Shard B
</span></dt><dd>
120
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_reduce_script"></a>After reduce_script<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The reduce_script receives an <code class="literal">_aggs</code> array containing the result of the combine script for each shard:</p><pre class="programlisting prettyprint lang-js">"_aggs" : [
    50,
    120
]</pre><p>It reduces the responses for the shards down to a final overall profit figure (by summing the values) and returns this as the result of the aggregation to
produce the response:</p><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_other_parameters"></a>Other Parameters<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
params
</p>
</td><td valign="top">
<p>
Optional. An object whose contents will be passed as variables to the  <code class="literal">init_script</code>, <code class="literal">map_script</code> and <code class="literal">combine_script</code>. This can be
                   useful to allow the user to control the behavior of the aggregation and for storing state between the scripts. If this is not specified,
                   the default is the equivalent of providing:
</p>
<pre class="programlisting prettyprint lang-js">"params" : {
    "_agg" : {}
}</pre>
</td></tr><tr><td valign="top">
<p>
reduce_params
</p>
</td><td valign="top">
<p>
Optional. An object whose contents will be passed as variables to the <code class="literal">reduce_script</code>. This can be useful to allow the user to control
                   the behavior of the reduce phase. If this is not specified the variable will be undefined in the reduce_script execution.
</p>
</td></tr><tr><td valign="top">
<p>
lang
</p>
</td><td valign="top">
<p>
Optional. The script language used for the scripts. If this is not specified the default scripting language is used.
</p>
</td></tr><tr><td valign="top">
<p>
init_script_file
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">init_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td valign="top">
<p>
init_script_id
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">init_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td valign="top">
<p>
map_script_file
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">map_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td valign="top">
<p>
map_script_id
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">map_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td valign="top">
<p>
combine_script_file
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">combine_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td valign="top">
<p>
combine_script_id
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">combine_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td valign="top">
<p>
reduce_script_file
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">reduce_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td valign="top">
<p>
reduce_script_id
</p>
</td><td valign="top">
<p>
Optional. Can be used in place of the <code class="literal">reduce_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-top-hits-aggregation.html">
              « 
              Top hits Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation
               »
            </a></span></div></article></section></div></div></div><footer><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74980" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74980"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_chrome gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/empty-template/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">enter you email<span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><script type="text/javascript">//<![CDATA[
            jQuery(function(){
                jQuery('#gform_submit_button_4').click( function() {
                    if(window["gf_submitting_4"]){
                        return false;
                    }
                    if( !jQuery("#gform_4")[0].checkValidity || jQuery("#gform_4")[0].checkValidity()){
                        window["gf_submitting_4"]=true;
                    }
                });
            });
            //]]></script><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
                    function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);window['gf_submitting_4'] = false;}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);window['gf_submitting_4'] = false;}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
                    //]]></script></div><div class="legal"><p>© 2014 All Rights Reserved - Elasticsearch </p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript">if(window.aiModifyParent) {aiModifyParent();}</script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201413"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/global.min.js?ver=1395082599"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/froogaloop.min.js?ver=1"></script></body></html>
