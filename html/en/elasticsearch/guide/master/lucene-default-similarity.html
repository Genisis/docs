<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lucene’s default similarity algorithm</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch" /><link rel="up" href="controlling-relevance.html" title="Controlling relevance" /><link rel="prev" href="controlling-relevance.html" title="Controlling relevance" /><link rel="next" href="non-prose.html" title="Not just prose (TODO)" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1395693666" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/style.css" type="text/css" media="all" /><script src="//cdn.optimizely.com/js/281975433.js"></script><script src="//fast.wistia.com/static/iframe-api-v1.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css?3" /></head><body class="single single-guide"><img src="http://ad.retargeter.com/seg?add=1235131&amp;t=2" width="1" height="1" style="position:absolute; visibility:hidden;" /><script type="text/javascript">
        if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-12395217-2']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    }</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><nav role="navigation" id="mobile-nav-container" class="off-canvas-nav"><ul id="mobile-nav" class="menu"><li id="menu-item-75892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-75895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75895"><a href="/overview/">Overview</a></li><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/elasticsearch/">Elasticsearch</a></li><li id="menu-item-75894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75894"><a href="/overview/marvel/">Marvel</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li><li id="menu-item-75893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75893"><a href="/overview/elkdownloads/">ELK Downloads</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-76342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container" class="main-nav"><ul id="top-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a class="btn btn-primary" href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger" aria-hidden="true"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">Search in depth </a></span> » <span class="breadcrumb-link"><a href="controlling-relevance.html">Controlling relevance</a></span> » <span class="breadcrumb-node">Lucene’s default similarity algorithm</span></div><div class="navheader"><span class="prev"><a href="controlling-relevance.html">
              « 
              Controlling relevance</a>
           
        </span><span class="next">
           
          <a href="non-prose.html">Not just prose (TODO)
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="lucene-default-similarity"></a>Lucene’s default similarity algorithm<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="structured-search.html">Structured search</a></span></dt><dt><span class="chapter"><a href="full-text-search.html">Full text search</a></span></dt><dt><span class="chapter"><a href="multi-field-search.html">Multi-field search</a></span></dt><dt><span class="chapter"><a href="proximity-matching.html">Proximity matching</a></span></dt><dt><span class="chapter"><a href="partial-matching.html">Partial matching</a></span></dt><dt><span class="chapter"><a href="controlling-relevance.html">Controlling relevance</a></span></dt><dt><span class="chapter"><a href="non-prose.html">Not just prose (TODO)</a></span></dt></dl></div><p>Lucene (and thus Elasticsearch) uses the
<a class="ulink" href="http://en.wikipedia.org/wiki/Standard_Boolean_model" target="_top">Boolean model</a>
to find matching documents, and a formula called the <span class="emphasis"><em>Practical Scoring
Function</em></span> to calculate relevance.  This formula borrows concepts from
<a class="ulink" href="http://en.wikipedia.org/wiki/Tfidf" target="_top">Term Frequency/Inverse Document Frequency</a> and the
<a class="ulink" href="http://en.wikipedia.org/wiki/Vector_space_model" target="_top">Vector space model</a>
but adds more modern features like a coordination factor, field length
normalization and term or query clause boosting.</p><div class="sidebar"><div class="titlepage"></div><p>Don’t be alarmed!  These concepts are not as complicated as the names make
them appear. We will work our way through each of them step-by-step.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="boolean-model"></a>Boolean model<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Boolean model simply applies the <code class="literal">AND</code>, <code class="literal">OR</code> and <code class="literal">NOT</code> conditions
expressed in the query to find all of the documents that match. A query for:</p><pre class="literallayout">full AND text AND search AND (elasticsearch OR lucene)</pre><p>will only include documents that contain all of the terms <code class="literal">full</code>, <code class="literal">text</code>, and
<code class="literal">search</code>, and either <code class="literal">elasticsearch</code> or <code class="literal">lucene</code>.</p><p>This process is simple and fast.  It is used to exclude any documents which
cannot possibly match the query.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="tfidf"></a>Term frequency/Inverse document frequency<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Once we have a list of matching documents, they need to be ranked by
relevance. Not all documents will contain all of the terms, and some terms are
more important than other terms. The relevance score of the whole document
depends on the <span class="emphasis"><em>weight</em></span> of each of the matching terms in that document.</p><p>The weight of each term is determined by three factors, which we have already
introduced in <a class="xref" href="relevance-intro.html" title="What is relevance?">What is relevance?</a>. The formulae are included for interest’s
sake, but you are not required to remember them:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a id="tf"></a> Term-frequency
</span></dt><dd><p class="simpara">How often does the term appear in this document? The more often, the
<span class="strong"><strong>higher</strong></span> the weight.  A field containing five mentions of the same term is
more likely to be relevant than a field containing just one mention.
The term frequency is calculated as:</p><pre class="literallayout">tf(t in d) = √frequency</pre></dd><dt><span class="term">
<a id="idf"></a> Inverse document frequency
</span></dt><dd><p class="simpara">How often does the term appear in all documents in the collection?  The more
often, the <span class="strong"><strong>lower</strong></span> the weight. Common terms like <code class="literal">and</code> or <code class="literal">the</code> contribute
little to relevance as they appear in most documents, while uncommon terms
like <code class="literal">elastic</code> or <code class="literal">hippopotamus</code> help us to zoom in on the most interesting
documents. The inverse document frequency is calculated as follows:</p><pre class="literallayout">idf(t) = 1 + log ( numDocs / (docFreq + 1))</pre></dd><dt><span class="term">
<a id="field-norm"></a> Field length norm
</span></dt><dd><p class="simpara">How long is the field?  The shorter the field, the <span class="strong"><strong>higher</strong></span> the weight. A term
appearing in a short <code class="literal">title</code> field carries more weight than the same term
appearing in a long <code class="literal">content</code> field. The field length norm is calculated as:</p><pre class="literallayout">norm(d) = √numTerms</pre></dd></dl></div><p>These three factors are calculated and stored at index time.  Together, they
are used to calculate the <span class="emphasis"><em>weight</em></span> of a term in a particular document.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="vector-space-model"></a>Vector space model<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Vector Space Model represents both the document and the query as
<span class="emphasis"><em>vectors</em></span>. A vector is really just a one-dimensional array containing numbers,
like:</p><pre class="literallayout">[1,2,5,22,3,8]</pre><p>In the Vector Space Model, the numbers in the vector represent the <span class="emphasis"><em>weight</em></span> of
each term.</p><div class="sidebar"><div class="titlepage"></div><p>By default, Lucene uses <a class="link" href="lucene-default-similarity.html#tfidf" title="Term frequency/Inverse document frequency">Term Frequency-Inverse Document Frequency</a>
(TF/IDF) to calculate these term weights, but there are other formulae that
could be used instead. TF/IDF is the default because it is a  simple,
efficient algorithm which produces high quality search results, and has stood
the test of time.</p></div><p>Imagine that we have a query for “happy hippopotamus”.  A common word like
<code class="literal">happy</code> will have a low weight, while an uncommon term like <code class="literal">hippopotamus</code>
will have a high weight. Let’s assume that <code class="literal">happy</code> has a weight of 2 and
<code class="literal">hippopotamus</code> has a weight of 5.  We can plot this simple two-dimensional
vector (<code class="literal">[2,5]</code>) as a line on a graph starting at point (0,0) and extending to
point (2,5).</p><div class="informalfigure"><a id="img-vector-query"></a><div class="mediaobject"><img src="images/170_01_query.png" alt="The query vector plotted on a graph" /></div></div><p>Now, imagine we have three documents:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
“I am <span class="strong"><strong>happy</strong></span> in summer”
</li><li class="listitem">
“After Christmas I’m a <span class="strong"><strong>hippopotamus</strong></span>”
</li><li class="listitem">
“The <span class="strong"><strong>happy hippopotamus</strong></span> helped Harry”
</li></ol></div><p>We can create a similar vector for each document, consisting of the weight of
each of the terms in the query — <code class="literal">happy</code> and <code class="literal">hippopotamus</code> — and we plot
them on the same graph:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document 1: <code class="literal">(happy,____________)</code> — <code class="literal">[2,0]</code>
</li><li class="listitem">
Document 2: <code class="literal">( ___ ,hippopotamus)</code> — <code class="literal">[0,5]</code>
</li><li class="listitem">
Document 3: <code class="literal">(happy,hippopotamus)</code> — <code class="literal">[2,5]</code>
</li></ul></div><div class="informalfigure"><a id="img-vector-docs"></a><div class="mediaobject"><img src="images/170_02_docs.png" alt="The query and document vectors plotted on a graph" /></div></div><p>The nice thing about vectors is that they can be compared. By measuring the
angle between the query vector and the document vector, it is possible to
assign a relevance score to each document. The angle between document 1 and
the query is large, so it is of low relevance.  Document 2 is closer to the
query, meaning that it is reasonably relevant, and document 3 is a perfect
match.</p><div class="sidebar"><div class="titlepage"></div><p>In practice, only two-dimensional vectors (queries with two terms) can  be
plotted easily on a graph. Fortunately, <span class="emphasis"><em>linear algebra</em></span> — the branch of
mathematics which deals with vectors — provides us with tools to compare the
angle between multi-dimensional vectors, which means that we can apply the
same principles explained above to queries which consist of many terms.</p><p>You can read more about how to compare two vectors using <span class="emphasis"><em>Cosine Similarity</em></span>
at <a class="ulink" href="http://en.wikipedia.org/wiki/Cosine_similarity" target="_top">http://en.wikipedia.org/wiki/Cosine_similarity</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="practical-scoring-function"></a>Lucene’s Practical Scoring Function<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Lucene takes the Boolean Model, TF/IDF, and the Vector Space Model and
combines them in a single efficient formula called the <span class="emphasis"><em>Practical Scoring
Function</em></span>. This formula looks intimidating, but don’t be put off — most of
the components you already know.  It introduces a few new elements which we
discuss below.</p><pre class="literallayout">score(q,d)  =               <a id="CO96-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            coord(q,d)          <a id="CO96-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
          · queryNorm(q)        <a id="CO96-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
          · ∑ (                 <a id="CO96-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
                tf(t in d)         <a id="CO96-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
              · idf(t)²            <a id="CO96-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
              · t.getBoost()       <a id="CO96-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
              · norm(t,d)          <a id="CO96-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
            ) (t in q)          <a id="CO96-9"></a><span><img src="images/icons/callouts/9.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">score(q,d)</code> is the relevance score of document <code class="literal">d</code> for query <code class="literal">q</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">coord(q,d)</code> is the <a class="link" href="lucene-default-similarity.html#coord" title="Coordination factor"><span class="emphasis"><em>coordination</em></span> factor</a>. [NEW]
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">queryNorm(q)</code> is the <a class="link" href="lucene-default-similarity.html#query-norm" title="Query normalization factor"><span class="emphasis"><em>query normalization</em></span> factor</a>. [NEW]
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> <a href="#CO96-9"><span><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The sum of the weights for each term <code class="literal">t</code> in the query <code class="literal">q</code> for document <code class="literal">d</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">tf(t in d)</code> is the <a class="link" href="lucene-default-similarity.html#tf">term frequency</a> for term <code class="literal">t</code> in document <code class="literal">d</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">idf(t)</code> is the <a class="link" href="lucene-default-similarity.html#idf">inverse document frequency</a> for term <code class="literal">t</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">t.getBoost()</code> is the <a class="link" href="lucene-default-similarity.html#get-boost" title="Query time boosting"><span class="emphasis"><em>boost</em></span></a>  that has been applied to
    the query. [NEW]
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO96-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">norm(t,d)</code> is the <a class="link" href="lucene-default-similarity.html#field-norm">field length norm</a>, combined with the
    <a class="link" href="lucene-default-similarity.html#index-boost" title="Index time boosting">index-time field-level boost</a>, if any. [NEW]
</p></td></tr></table></div><p>You should recognise <code class="literal">score</code>, <code class="literal">tf</code>, and <code class="literal">idf</code>. The <code class="literal">coord</code>, <code class="literal">queryNorm</code>,
<code class="literal">t.getBoost</code> and <code class="literal">norm</code> are new, and are explained below:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="coord"></a>Coordination factor<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The coordination factor is used to reward documents which contain more of the
query terms. Imagine that we have a query for <code class="literal">quick brown fox</code>, and that the
weight for each term is 1.5.  Without the coordination factor, the score would
just be the sum of the weights of the terms in a document. For instance:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document with <code class="literal">fox</code> → score: 1.5
</li><li class="listitem">
Document with <code class="literal">quick fox</code> → score: 3.0
</li><li class="listitem">
Document with <code class="literal">quick brown fox</code> → score: 4.5
</li></ul></div><p>The coordination factor multiplies the score by the number of matching terms
in the document, and divides it by the total number of terms in the query.
With the coordination factor, the scores would be as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document with <code class="literal">fox</code> → score: <code class="literal">1.5 * 1 / 3</code> = 0.5
</li><li class="listitem">
Document with <code class="literal">quick fox</code> → score: <code class="literal">3.0 * 2 / 3</code> = 2.0
</li><li class="listitem">
Document with <code class="literal">quick brown fox</code> → score: <code class="literal">4.5 * 3 / 3</code> = 4.5
</li></ul></div><p>The coordination factor results in the document that contains all 3 terms
being much more relevant than the document that contains just 2 of them.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="query-norm"></a>Query normalization factor<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The query normalization factor is an attempt to “normalize” a query so that
the results from one query may be compared with the results of another. This
factor is calculated at the beginning of the query. The actual calculation
depends on the queries involved but a typical implementation would be:</p><pre class="literallayout">queryNorm = 1 / √sumOfSquaredWeights</pre><p>The same query normalization factor is applied to every result and, for all
intents and purposes, can be ignored.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="get-boost"></a>Query time boosting<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In <a class="xref" href="multi-query-strings.html#prioritising-clauses" title="Prioritising clauses">Prioritising clauses</a> we explained how you could use the <code class="literal">boost</code>
parameter to give one query clause more importance than another.  For
instance:</p><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "match": {
            "title": {
              "query": "quick brown fox",
              "boost": 2 <a id="CO97-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }}},
        { "match": {
            "body": "quick brown fox"
        }}
      ]
    }
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO97-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> query clause is twice as important as the <code class="literal">body</code> query
    clause, because it has been boosted by a factor of 2.
</p></td></tr></table></div><p>These <code class="literal">boost</code> values are not applied at the level that they appear in the
query DSL.  Instead, any boost values are combined and passsed down to the
individual terms.  The <code class="literal">t.getBoost()</code> method returns any <code class="literal">boost</code> value applied
to the term itself or to any of the queries higher up the chain.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="index-boost"></a>Index time boosting<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/170_Relevance/20_Lucene_default_similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is possible to boost a field at index time instead of search time.  In
order to store this boost value in the index without using up more space, this
field-level index-time boost is combined with the field length norm that we
discussed in <a class="xref" href="lucene-default-similarity.html#field-norm">[field-norm]</a> and stored in the index as a single byte. This is the
value returned by <code class="literal">norm(t,d)</code> in the equation above.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>We strongly recommend against using field-level index-time boosts for a few
reasons:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Combining the boost with the field length norm and storing it in a single
    bytes means that the field length norm loses precision. The result is that
    Elasticsearch is unable to distinguish between a field containing 3 words
    and a field containing 5 words.
</li><li class="listitem">
To change an index-time boost, you have to reindex all of your documents.
    A query-time boost, on the other hand, can be changed with every query.
</li><li class="listitem">
If a field with index-time boost has multiple values, the boost is
    multiplied with itself for every value, dramatically increasing
    the weight for that field.
</li></ol></div><p>Query-time field boosting is a much simpler, cleaner, more flexible option.</p></div></div><p>With the above, you understand all of the factors that can affect the
relevance score.  The next step is learning to control them, which we will
deal with in the rest of this chapter.</p></div></div></div><div class="navfooter"><span class="prev"><a href="controlling-relevance.html">
              « 
              Controlling relevance</a>
           
        </span><span class="next">
           
          <a href="non-prose.html">Not just prose (TODO)
               »
            </a></span></div></article></section></div></div></div><footer><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74980" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74980"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_chrome gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/empty-template/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">enter you email<span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><script type="text/javascript">//<![CDATA[
            jQuery(function(){
                jQuery('#gform_submit_button_4').click( function() {
                    if(window["gf_submitting_4"]){
                        return false;
                    }
                    if( !jQuery("#gform_4")[0].checkValidity || jQuery("#gform_4")[0].checkValidity()){
                        window["gf_submitting_4"]=true;
                    }
                });
            });
            //]]></script><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
                    function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);window['gf_submitting_4'] = false;}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);window['gf_submitting_4'] = false;}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
                    //]]></script></div><div class="legal"><p>© 2014 All Rights Reserved - Elasticsearch </p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript">if(window.aiModifyParent) {aiModifyParent();}</script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201413"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/global.min.js?ver=1395082598"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/froogaloop.min.js?ver=1"></script><script type="text/javascript">
if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    document.write(unescape("%3Cscript src='" + document.location.protocol +
    "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
}
</script><script>
if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    Munchkin.init('813-MAM-392');

    // crazyegg
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0014/4686.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
}
</script></body></html>
