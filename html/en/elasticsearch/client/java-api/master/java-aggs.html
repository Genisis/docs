<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Aggregations</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Java API [master]" /><link rel="up" href="index.html" title="Java API [master]" /><link rel="prev" href="java-facets.html" title="Facets" /><link rel="next" href="percolate.html" title="Percolate API" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1395693666" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/style.css" type="text/css" media="all" /><script src="//cdn.optimizely.com/js/281975433.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css?3" /></head><body class="single single-guide"><!--Google Tag Manager--><script> dataLayer = []; </script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5FTL28" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>
    if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5FTL28');}
</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><nav role="navigation" id="mobile-nav-container" class="off-canvas-nav"><ul id="mobile-nav" class="menu"><li id="menu-item-75892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-75895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75895"><a href="/overview/">Overview</a></li><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/elasticsearch/">Elasticsearch</a></li><li id="menu-item-75894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75894"><a href="/overview/marvel/">Marvel</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li><li id="menu-item-75893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75893"><a href="/overview/elkdownloads/">ELK Downloads</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-76342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container" class="main-nav"><ul id="top-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a class="btn btn-primary" href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger" aria-hidden="true"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Java API
      [master]
    </a></span> » <span class="breadcrumb-node">Aggregations</span></div><div class="navheader"><span class="prev"><a href="java-facets.html">
              « 
              Facets</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="java-aggs"></a>Aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="toc"><dl><dt><span class="preface"><a href="java-api.html">Preface</a></span></dt><dt><span class="chapter"><a href="_maven_repository.html">Maven Repository</a></span></dt><dt><span class="chapter"><a href="_deploying_in_jboss_eap6_module.html">Deploying in JBoss EAP6 module</a></span></dt><dt><span class="chapter"><a href="client.html">Client</a></span></dt><dt><span class="chapter"><a href="index_.html">Index API</a></span></dt><dt><span class="chapter"><a href="get.html">Get API</a></span></dt><dt><span class="chapter"><a href="delete.html">Delete API</a></span></dt><dt><span class="chapter"><a href="java-update-api.html">Update API</a></span></dt><dt><span class="chapter"><a href="bulk.html">Bulk API</a></span></dt><dt><span class="chapter"><a href="search.html">Search API</a></span></dt><dt><span class="chapter"><a href="count.html">Count API</a></span></dt><dt><span class="chapter"><a href="delete-by-query.html">Delete By Query API</a></span></dt><dt><span class="chapter"><a href="java-facets.html">Facets</a></span></dt><dt><span class="chapter"><a href="java-aggs.html">Aggregations</a></span></dt><dt><span class="chapter"><a href="percolate.html">Percolate API</a></span></dt><dt><span class="chapter"><a href="query-dsl-queries.html">Query DSL - Queries</a></span></dt><dt><span class="chapter"><a href="query-dsl-filters.html">Query DSL - Filters</a></span></dt></dl></div><p>Elasticsearch provides a full Java API to play with aggregations. See the
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_top">Aggregations guide</a>.</p><p>Use the factory for aggregation builders (<code class="literal">AggregationBuilders</code>) and add each aggregation
you want to compute when querying and add it to your search request:</p><pre class="programlisting prettyprint lang-java">SearchResponse sr = node.client().prepareSearch()
        .setQuery( /* your query */ )
        .addAggregation( /* add an aggregation */ )
        .execute().actionGet();</pre><p>Note that you can add more than one aggregation. See
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-search.html" target="_top">Search Java API</a> for details.</p><p>To build aggregation requests, use <code class="literal">AggregationBuilders</code> helpers. Just import them
in your class:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.AggregationBuilders;</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_structuring_aggregations"></a>Structuring aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>As explained in the
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_top">Aggregations guide</a>, you can define
sub aggregations inside an aggregation.</p><p>An aggregation could be a metrics aggregation or a bucket aggregation.</p><p>For example, here is a 3 levels aggregation composed of:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Terms aggregation (bucket)
</li><li class="listitem">
Date Histogram aggregation (bucket)
</li><li class="listitem">
Average aggregation (metric)
</li></ul></div><pre class="programlisting prettyprint lang-java">SearchResponse sr = node.client().prepareSearch()
    .addAggregation(
        AggregationBuilders.terms("by_country").field("country")
        .subAggregation(AggregationBuilders.dateHistogram("by_year")
            .field("dateOfBirth")
            .interval((DateHistogram.Interval.YEAR)
            .subAggregation(AggregationBuilders.avg("avg_children").field("children"))
        )
    )
    .execute().actionGet();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_metrics_aggregations"></a>Metrics aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-min"></a>Min Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-min-aggregation.html" target="_top">Min Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .min("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.min.Min;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Min agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-max"></a>Max Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-max-aggregation.html" target="_top">Max Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_2"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .max("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_2"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.max.Max;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Max agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-sum"></a>Sum Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-sum-aggregation.html" target="_top">Sum Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_3"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .sum("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_3"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.sum.Sum;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Sum agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-avg"></a>Avg Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-avg-aggregation.html" target="_top">Avg Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_4"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .avg("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_4"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.avg.Avg;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Avg agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-stats"></a>Stats Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-stats-aggregation.html" target="_top">Stats Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_5"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .stats("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_5"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.Stats;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-extendedstats"></a>Extended Stats Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-extendedstats-aggregation.html" target="_top">Extended Stats Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_6"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .extendedStats("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_6"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.extended.ExtendedStats;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();
double stdDeviation = agg.getStdDeviation();
double sumOfSquares = agg.getSumOfSquares();
double variance = agg.getVariance();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-valuecount"></a>Value Count Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-valuecount-aggregation.html" target="_top">Value Count Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_7"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .count("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_7"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.valuecount.ValueCount;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ValueCount agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-percentile"></a>Percentile Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-aggregation.html" target="_top">Percentile Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_8"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height");</pre><p>You can provide your own percentiles instead of using defaults:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height")
                .percentiles(1.0, 5.0, 10.0, 20.0, 30.0, 75.0, 95.0, 99.0);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_8"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.Percentiles;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Percentiles agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">percent [1.0], value [0.814338896154595]
percent [5.0], value [0.8761912455821302]
percent [25.0], value [1.173346540141847]
percent [50.0], value [1.5432023318692198]
percent [75.0], value [1.923915462033674]
percent [95.0], value [2.2273644908535335]
percent [99.0], value [2.284989339108279]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-percentile-rank"></a>Percentile Ranks Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-rank-aggregation.html" target="_top">Percentile Ranks Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_9"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentileRanks("agg")
                .field("height")
                .percentiles(1.24, 1.91, 2.22);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_9"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.PercentileRanks;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
PercentileRanks agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">percent [29.664353095090945], value [1.24]
percent [73.9335313461868], value [1.91]
percent [94.40095147327283], value [2.22]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-cardinality"></a>Cardinality Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html" target="_top">Cardinality Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_10"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .cardinality("agg")
                .field("tags");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_10"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.cardinality.Cardinality;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Cardinality agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-geobounds"></a>Cardinality Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-geobounds-aggregation.html" target="_top">Geo Bounds Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_11"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">GeoBoundsBuilder aggregation =
        AggregationBuilders
                .geoBounds("agg")
                .field("address.location")
                .wrapLongitude(true);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_11"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.geobounds.GeoBounds;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoBounds agg = sr.getAggregations().get("agg");
GeoPoint bottomRight = agg.bottomRight();
GeoPoint topLeft = agg.topLeft();
logger.info("bottomRight {}, topLeft {}", bottomRight, topLeft);</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">bottomRight [40.70500764381921, 13.952946866893775], topLeft [53.49603022435221, -4.190029308156676]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-tophits"></a>Top Hits Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-hits-aggregation.html" target="_top">Top Hits Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_12"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
        );</pre><p>You can use most of the options available for standard search such as <code class="literal">from</code>, <code class="literal">size</code>, <code class="literal">sort</code>, <code class="literal">highlight</code>, <code class="literal">explain</code>…</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
                .setExplain(true)
                .setSize(1)
                .setFrom(10)
        );</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_12"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Terms agg = sr.getAggregations().get("agg");

// For each entry
for (Terms.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);

    // We ask for top_hits for each bucket
    TopHits topHits = entry.getAggregations().get("top");
    for (SearchHit hit : topHits.getHits().getHits()) {
        logger.info(" -&gt; id [{}], _source [{}]", hit.getId(), hit.getSourceAsString());
    }
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [male], doc_count [5107]
 -&gt; id [AUnzSZze9k7PKXtq04x2], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzj9k7PKXtq04x4], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzl9k7PKXtq04x5], _source [{"gender":"male",...}]
key [female], doc_count [4893]
 -&gt; id [AUnzSZzM9k7PKXtq04xy], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZzp9k7PKXtq04x8], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZ0W9k7PKXtq04yS], _source [{"gender":"female",...}]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-scripted-metric"></a>Scripted Metric Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-scripted-metric-aggregation.html" target="_top">Scripted Metric Aggregation</a>
with Java API.</p><p>Don’t forget to add Groovy in your classpath if you want to run Groovy scripts in an embedded data node
(for unit tests for example).
For example, with Maven, add this dependency to your <code class="literal">pom.xml</code> file:</p><pre class="programlisting prettyprint lang-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
    &lt;version&gt;2.3.2&lt;/version&gt;
    &lt;classifier&gt;indy&lt;/classifier&gt;
&lt;/dependency&gt;</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_13"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }");</pre><p>You can also specify a <code class="literal">combine</code> script which will be executed on each shard:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }")
                .combineScript("heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum");</pre><p>You can also specify a <code class="literal">reduce</code> script which will be executed on the node which gets the request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }")
                .combineScript("heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum")
                .reduceScript("heights_sum = 0; for (a in _aggs) { heights_sum += a }; return heights_sum");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_13"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ScriptedMetric agg = sr.getAggregations().get("agg");
Object scriptedResult = agg.aggregation();
logger.info("scriptedResult [{}]", scriptedResult);</pre><p>Note that the result depends on the script you built.
For the first example, this will basically produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [ {
"heights" : [ 1.122218480146643, -1.8148918111233887, -1.7626731575142909, ... ]
}, {
"heights" : [ -0.8046067304119863, -2.0785486707864553, -1.9183567430207953, ... ]
}, {
"heights" : [ 2.092635728868694, 1.5697545960886536, 1.8826954461968808, ... ]
}, {
"heights" : [ -2.1863201099468403, 1.6328549117346856, -1.7078288405893842, ... ]
}, {
"heights" : [ 1.6043904836424177, -2.0736538674414025, 0.9898266674373053, ... ]
} ]</pre><p>The second example will produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [-41.279615707402876,
                -60.88007362339038,
                38.823270659734256,
                14.840192739445632,
                11.300902755741326]</pre><p>The last example will produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [Double]
scriptedResult [2.171917696507009]</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_bucket_aggregations"></a>Bucket aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-global"></a>Global Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-global-aggregation.html" target="_top">Global Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_14"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .global("agg")
    .subAggregation(AggregationBuilders.terms("genders").field("gender"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_14"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.global.Global;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Global agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-filter"></a>Filter Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filter-aggregation.html" target="_top">Filter Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_15"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .filter("agg")
    .filter(FilterBuilders.termFilter("gender", "male"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_15"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.filter.Filter;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Filter agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-filters"></a>Filters Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html" target="_top">Filters Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_16"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .filters("agg")
            .filter("men", FilterBuilders.termFilter("gender", "male"))
            .filter("women", FilterBuilders.termFilter("gender", "female"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_16"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.filters.Filters;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Filters agg = sr.getAggregations().get("agg");

// For each entry
for (Filters.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [men], doc_count [4982]
key [women], doc_count [5018]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-missing"></a>Missing Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-missing-aggregation.html" target="_top">Missing Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_17"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders.missing("agg").field("gender");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_17"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.missing.Missing;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Missing agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-nested"></a>Nested Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-nested-aggregation.html" target="_top">Nested Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_18"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .nested("agg")
    .path("resellers");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_18"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-reverse-nested"></a>Reverse Nested Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-reverse-nested-aggregation.html" target="_top">Reverse Nested Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_19"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .nested("agg").path("resellers")
        .subAggregation(
                AggregationBuilders
                        .terms("name").field("resellers.name")
                        .subAggregation(
                                AggregationBuilders
                                        .reverseNested("reseller_to_product")
                        )
        );</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_19"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;
import org.elasticsearch.search.aggregations.bucket.nested.ReverseNested;
import org.elasticsearch.search.aggregations.bucket.terms.Terms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
Terms name = agg.getAggregations().get("name");
for (Terms.Bucket bucket : name.getBuckets()) {
    ReverseNested resellerToProduct = bucket.getAggregations().get("reseller_to_product");
    resellerToProduct.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-children"></a>Children Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-children-aggregation.html" target="_top">Children Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_20"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .children("agg")
        .childType("reseller");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_20"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.children.Children;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Children agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-terms"></a>Terms Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" target="_top">Terms Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_21"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_21"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Terms genders = sr.getAggregations().get("genders");

// For each entry
for (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order"></a>Order<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Ordering the buckets by their <code class="literal">doc_count</code> in an ascending manner:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.count(true))</pre><p>Ordering the buckets alphabetically by their terms in an ascending manner:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.term(true))</pre><p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.aggregation("avg_height", false))
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-significantterms"></a>Significant Terms Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-significantterms-aggregation.html" target="_top">Significant Terms Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_22"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .significantTerms("significant_countries")
                .field("address.country");

// Let say you search for men only
SearchResponse sr = client.prepareSearch()
        .setQuery(QueryBuilders.termQuery("gender", "male"))
        .addAggregation(aggregation)
        .get();</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_22"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.significant.SignificantTerms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
SignificantTerms agg = sr.getAggregations().get("significant_countries");

// For each entry
for (SignificantTerms.Bucket entry : agg.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-range"></a>Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-range-aggregation.html" target="_top">Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_23"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .range("agg")
                .field("height")
                .addUnboundedTo(1.0f)               // from -infinity to 1.0 (excluded)
                .addRange(1.0f, 1.5f)               // from 1.0 to 1.5 (excluded)
                .addUnboundedFrom(1.5f);            // from 1.5 to +infinity</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_23"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.Range;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // Range as key
    Number from = entry.getFrom();          // Bucket from
    Number to = entry.getTo();              // Bucket to
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [*-1.0], from [-Infinity], to [1.0], doc_count [9]
key [1.0-1.5], from [1.0], to [1.5], doc_count [21]
key [1.5-*], from [1.5], to [Infinity], doc_count [20]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-daterange"></a>Date Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-daterange-aggregation.html" target="_top">Date Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_24"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateRange("agg")
                .field("dateOfBirth")
                .format("yyyy")
                .addUnboundedTo("1950")    // from -infinity to 1950 (excluded)
                .addRange("1950", "1960")  // from 1950 to 1960 (excluded)
                .addUnboundedFrom("1960"); // from 1960 to +infinity</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_24"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.date.DateRange;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
DateRange agg = sr.getAggregations().get("agg");

// For each entry
for (DateRange.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // Date range as key
    DateTime fromAsDate = entry.getFromAsDate();    // Date bucket from as a Date
    DateTime toAsDate = entry.getToAsDate();        // Date bucket to as a Date
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsDate, toAsDate, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [*-1950], from [null], to [1950-01-01T00:00:00.000Z], doc_count [8]
key [1950-1960], from [1950-01-01T00:00:00.000Z], to [1960-01-01T00:00:00.000Z], doc_count [5]
key [1960-*], from [1960-01-01T00:00:00.000Z], to [null], doc_count [37]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-iprange"></a>Ip Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-iprange-aggregation.html" target="_top">Ip Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_25"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addUnboundedTo("192.168.1.0")             // from -infinity to 192.168.1.0 (excluded)
                .addRange("192.168.1.0", "192.168.2.0")    // from 192.168.1.0 to 192.168.2.0 (excluded)
                .addUnboundedFrom("192.168.2.0");          // from 192.168.2.0 to +infinity</pre><p>Note that you could also use ip masks as ranges:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addMaskRange("192.168.0.0/32")
                .addMaskRange("192.168.0.0/24")
                .addMaskRange("192.168.0.0/16");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_25"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.ipv4.IPv4Range;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
IPv4Range agg = sr.getAggregations().get("agg");

// For each entry
for (IPv4Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // Ip range as key
    String fromAsString = entry.getFromAsString();  // Ip bucket from as a String
    String toAsString = entry.getToAsString();      // Ip bucket to as a String
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsString, toAsString, docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [*-192.168.1.0], from [null], to [192.168.1.0], doc_count [13]
key [192.168.1.0-192.168.2.0], from [192.168.1.0], to [192.168.2.0], doc_count [14]
key [192.168.2.0-*], from [192.168.2.0], to [null], doc_count [23]</pre><p>And for the second one (using Ip masks):</p><pre class="programlisting prettyprint lang-text">key [192.168.0.0/32], from [192.168.0.0], to [192.168.0.1], doc_count [0]
key [192.168.0.0/24], from [192.168.0.0], to [192.168.1.0], doc_count [13]
key [192.168.0.0/16], from [192.168.0.0], to [192.169.0.0], doc_count [50]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-histogram"></a>Histogram Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-histogram-aggregation.html" target="_top">Histogram Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_26"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .histogram("agg")
                .field("height")
                .interval(1);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_26"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // Key
    long docCount = entry.getDocCount();    // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-datehistogram"></a>Date Histogram Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html" target="_top">Date Histogram Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_27"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .interval(DateHistogram.Interval.YEAR);</pre><p>Or if you want to set an interval of 10 days:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .interval(DateHistogram.Interval.days(10));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_27"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
DateHistogram agg = sr.getAggregations().get("agg");

// For each entry
for (DateHistogram.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                // Key
    DateTime keyAsDate = entry.getKeyAsDate();  // Key as date
    long docCount = entry.getDocCount();        // Doc count

    logger.info("key [{}], date [{}], doc_count [{}]", key, keyAsDate.getYear(), docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [1942-01-01T00:00:00.000Z], date [1942], doc_count [1]
key [1945-01-01T00:00:00.000Z], date [1945], doc_count [1]
key [1946-01-01T00:00:00.000Z], date [1946], doc_count [1]
...
key [2005-01-01T00:00:00.000Z], date [2005], doc_count [1]
key [2007-01-01T00:00:00.000Z], date [2007], doc_count [2]
key [2008-01-01T00:00:00.000Z], date [2008], doc_count [3]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-geodistance"></a>Geo Distance Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geodistance-aggregation.html" target="_top">Geo Distance Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_28"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .geoDistance("agg")
                .field("address.location")
                .point(new GeoPoint(48.84237171118314,2.33320027692004))
                .unit(DistanceUnit.KILOMETERS)
                .addUnboundedTo(3.0)
                .addRange(3.0, 10.0)
                .addRange(10.0, 500.0);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_28"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.geodistance.GeoDistance;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoDistance agg = sr.getAggregations().get("agg");

// For each entry
for (GeoDistance.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // key as String
    Number from = entry.getFrom();          // bucket from value
    Number to = entry.getTo();              // bucket to value
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [*-3.0], from [0.0], to [3.0], doc_count [161]
key [3.0-10.0], from [3.0], to [10.0], doc_count [460]
key [10.0-500.0], from [10.0], to [500.0], doc_count [4925]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-geohashgrid"></a>Geo Hash Grid Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geohashgrid-aggregation.html" target="_top">Geo Hash Grid Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_29"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .geohashGrid("agg")
                .field("address.location")
                .precision(4);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_29"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/master/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.geogrid.GeoHashGrid;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoHashGrid agg = sr.getAggregations().get("agg");

// For each entry
for (GeoHashGrid.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                        // key as String
    GeoPoint keyAsGeoPoint = entry.getKeyAsGeoPoint();  // key as geo point
    long docCount = entry.getDocCount();                // Doc count

    logger.info("key [{}], point {}, doc_count [{}]", key, keyAsGeoPoint, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [gbqu], point [47.197265625, -1.58203125], doc_count [1282]
key [gbvn], point [50.361328125, -4.04296875], doc_count [1248]
key [u1j0], point [50.712890625, 7.20703125], doc_count [1156]
key [u0j2], point [45.087890625, 7.55859375], doc_count [1138]
...</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="java-facets.html">
              « 
              Facets</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               »
            </a></span></div></article></section></div></div></div><footer><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74980" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74980"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_chrome gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/empty-template/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">enter you email<span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><script type="text/javascript">//<![CDATA[
            jQuery(function(){
                jQuery('#gform_submit_button_4').click( function() {
                    if(window["gf_submitting_4"]){
                        return false;
                    }
                    if( !jQuery("#gform_4")[0].checkValidity || jQuery("#gform_4")[0].checkValidity()){
                        window["gf_submitting_4"]=true;
                    }
                });
            });
            //]]></script><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
                    function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);window['gf_submitting_4'] = false;}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);window['gf_submitting_4'] = false;}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
                    //]]></script></div><div class="legal"><p>© 2014 All Rights Reserved - Elasticsearch </p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript">if(window.aiModifyParent) {aiModifyParent();}</script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201413"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/global.min.js?ver=1395082599"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/froogaloop.min.js?ver=1"></script></body></html>
