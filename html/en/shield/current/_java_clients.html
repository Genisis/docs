<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Java clients</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Shield - Elasticsearch Security Plugin" /><link rel="up" href="clients.html" title="Integrating Shield with clients" /><link rel="prev" href="clients.html" title="Integrating Shield with clients" /><link rel="next" href="_http_rest_clients.html" title="HTTP/REST Clients" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link rel="shortcut icon" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/favicon.ico" /><link rel="stylesheet" id="prettify-gc-syntax-highlighter-css" href="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.5.2" type="text/css" media="all" /><link rel="stylesheet" id="appStyles-css" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/css/main.css?ver=1395693666" type="text/css" media="all" /><script type="text/javascript" src="http://www.elasticsearch.org/wp-includes/js/jquery/jquery.js?ver=1.8.3"></script><link rel="stylesheet" href="http://www.elasticsearch.org/content/themes/elasticsearch-org/style.css" type="text/css" media="all" /><script src="//cdn.optimizely.com/js/281975433.js"></script><script type="text/javascript">
      jQuery(function() {
        jQuery('div.navheader+div').css('minHeight',jQuery('div.toc').height()+'px');
        jQuery('article.guide_content a[id]').each(function() { this.href='#'+this.id });
      });
    </script><link rel="stylesheet" type="text/css" href="styles.css?3" /></head><body class="single single-guide"><!--Google Tag Manager--><script> dataLayer = []; </script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5FTL28" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>
    if(jQuery('body').data('cookie') != "eu" || jQuery.cookie('allowCookies')){
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5FTL28');}
</script><!--[if lt IE 8]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
      <![endif]--><header><nav role="navigation" id="mobile-nav-container" class="off-canvas-nav"><ul id="mobile-nav" class="menu"><li id="menu-item-75892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a><ul class="sub-menu"><li id="menu-item-75895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75895"><a href="/overview/">Overview</a></li><li id="menu-item-68760" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68760"><a href="/overview/elasticsearch/">Elasticsearch</a></li><li id="menu-item-75894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75894"><a href="/overview/marvel/">Marvel</a></li><li id="menu-item-68758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68758"><a href="/overview/kibana/">Kibana</a></li><li id="menu-item-68756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68756"><a href="/overview/kibana/installation/">Kibana Installation</a></li><li id="menu-item-68757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68757"><a href="/overview/kibana/support/">Kibana Support</a></li><li id="menu-item-68759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68759"><a href="/overview/logstash/">Logstash</a></li><li id="menu-item-74019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74019"><a href="/overview/hadoop/">Hadoop</a></li><li id="menu-item-75893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75893"><a href="/overview/elkdownloads/">ELK Downloads</a></li></ul></li><li id="menu-item-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-55"><a href="/resources/">Resources</a><ul class="sub-menu"><li id="menu-item-76342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li id="menu-item-4843" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></li><li id="menu-item-657" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li id="menu-item-68802" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="container"><div id="header-inner"><h1 id="header-logo"><a class="faux" href="http://www.elasticsearch.org">Elasticsearch</a></h1><nav role="navigation" id="main-nav-container" class="main-nav"><ul id="top-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-75892"><a href="/overview/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-53 current_page_item menu-item-55"><a href="/resources/">Resources</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-657"><a href="/community/">Community</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-68802"><a href="/case-studies/">Case Studies</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="/blog/">Blog</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" href="http://elasticsearch.com">Company</a></li></ul><ul class="add-on"><li><a class="btn btn-primary" href="/overview/elkdownloads/">Download</a></li></ul></nav><div class="slide-trigger navigation" id="nav-trigger" aria-hidden="true"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div><hr /><ul id="sub_nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-76342"><a href="/guide/">Guide</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4843"><a href="/videos/">Videos</a></li></ul></div></div></header><div class="global_wrapper"><div class="page_content"><div class="container"><section id="search_container" class="active"><form id="blog_search" role="search" action="/" method="get"><div class="blog_search_wrapper"><input id="s" name="s" class="search_term" type="text" placeholder="search" autocomplete="off" tabindex="1" /><input type="submit" class="search_submit" value=" " /><ul id="results"></ul></div></form></section><section class="full_width guide"><article class="guide_content"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Shield - Elasticsearch Security Plugin</a></span> » <span class="breadcrumb-link"><a href="clients.html">Integrating Shield with clients</a></span> » <span class="breadcrumb-node">Java clients</span></div><div class="navheader"><span class="prev"><a href="clients.html">
              « 
              Integrating Shield with clients</a>
           
        </span><span class="next">
           
          <a href="_http_rest_clients.html">HTTP/REST Clients
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_java_clients"></a>Java clients</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="_java_clients.html">Java clients</a></span></dt><dt><span class="section"><a href="_http_rest_clients.html">HTTP/REST Clients</a></span></dt><dt><span class="section"><a href="logstash.html">Shield with Logstash</a></span></dt><dt><span class="section"><a href="marvel.html">Shield with Marvel</a></span></dt><dt><span class="section"><a href="kibana.html">Kibana</a></span></dt><dt><span class="section"><a href="_shield_with_kibana_3.html">Shield with Kibana 3</a></span></dt><dt><span class="section"><a href="_shield_with_kibana_4.html">Shield with Kibana 4</a></span></dt><dt><span class="section"><a href="hadoop.html">Shield with Elasticsearch for Apache Hadoop</a></span></dt></dl></div><p>Elasticsearch supports two types of Java clients: <span class="emphasis"><em>Node Client</em></span> and <span class="emphasis"><em>Transport Client</em></span>.</p><p>The <span class="emphasis"><em>Node Client</em></span> is a cluster node that joins the cluster and receives all the cluster events, in the same manner as
any other cluster node. Node clients cannot be allocated shards, and therefore cannot hold data. Node clients are not
eligible for election as a master node in the cluster. For more information about node clients, see the
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/client/java-api/current/client.html#node-client" target="_top">following section</a>.</p><p>Unlike the <span class="emphasis"><em>Node Client</em></span>, the <span class="emphasis"><em>Transport Client</em></span> is not a node in the cluster. Yet it uses the same transport protocol
the cluster nodes use for inter-node communication and is therefore considered to be very efficient as it bypasses the
process of un/marshalling of request from/to JSON which you typically have in REST based clients (read more about
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/client/java-api/current/client.html#transport-client" target="_top"><span class="emphasis"><em>Transport Client</em></span></a>).</p><p>Shield supports both clients. This section provides configuration instructions for these clients.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_node_client"></a>Node Client</h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>While <span class="emphasis"><em>Node Clients</em></span> may work with Shield, since these are actual nodes in the cluster, they require access
         to a breadth of cluster management internal APIs. Additionally, just like all other nodes in the cluster,
         <span class="emphasis"><em>Node Clients</em></span> require the license plugin to be installed and access to Shield configuration files that contain
         sensitive data. For this reason, <span class="emphasis"><em>Node Clients</em></span> should be considered as unsafe clients. If you choose to use
         these clients, make sure you treat them in the same way you treat any other node in your cluster. Your
         application should sit next to the cluster within the same security zone.</p></div></div><p>There are several steps for setting up this client:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Set the appropriate dependencies for you project
</li><li class="listitem">
Duplicate <a class="link" href="reference.html#ref-shield-files" title="Files used by Shield">configuration files</a> for authentication
</li><li class="listitem">
Configure the authentication token
</li><li class="listitem">
(Optional) If SSL/TLS is enabled, set up the keystore, then create and import the appropriate certificates.
</li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_java_project_dependencies"></a>Java project dependencies</h4></div></div></div><p>If you plan on using the Node Client, you first need to make sure the Shield jar files (<code class="literal">elasticsearch-shield-1.0.0.jar</code>, <code class="literal">commons-codec-1.10.jar</code>)
and the License jar file (<code class="literal">elasticsearch-license-1.0.0.jar</code>) are in the classpath. You can either download the
distributions, extract the jar files manually and include them in your classpath, or you can pull them out of the Elasticsearch Maven repository. The
following snippet shows the configuration you will need to include in your project’s <code class="literal">pom.xml</code> file:</p><pre class="programlisting prettyprint lang-xml">&lt;project ...&gt;

   &lt;repositories&gt;
      &lt;!-- add the elasticsearch repo --&gt;
      &lt;repository&gt;
         &lt;id&gt;elasticsearch-releases&lt;/id&gt;
         &lt;url&gt;http://maven.elasticsearch.org/releases&lt;/url&gt;
         &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;/releases&gt;
         &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
         &lt;/snapshots&gt;
      &lt;/repository&gt;
      ...
   &lt;/repositories&gt;
   ...

   &lt;dependencies&gt;
      &lt;!-- add the shield jar as a dependency --&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
         &lt;artifactId&gt;elasticsearch-shield&lt;/artifactId&gt;
         &lt;version&gt;1.0.0&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;!-- add the shield jar as a dependency --&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
         &lt;artifactId&gt;elasticsearch-license-plugin&lt;/artifactId&gt;
         &lt;version&gt;1.0.0&lt;/version&gt;
      &lt;/dependency&gt;
      ...
   &lt;/dependencies&gt;
   ...

 &lt;/project&gt;</pre><p>It is also possible to manually download the <a class="ulink" href="http://maven.elasticsearch.org/releases/org/elasticsearch/elasticsearch-shield/1.0.0/elasticsearch-shield-1.0.0.jar" target="_top">Shield jar</a>
and the <a class="ulink" href="http://maven.elasticsearch.org/releases/org/elasticsearch/elasticsearch-license-plugin/1.0.0/elasticsearch-license-plugin-1.0.0.jar" target="_top">License jar</a>
files from our Maven repository.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_duplicate_shield_configuration_files"></a>Duplicate Shield Configuration Files</h4></div></div></div><p>The <span class="emphasis"><em>Node Client</em></span> will authenticate requests before sending the requests to the cluster. To do this, copy the <code class="literal">users</code>,
<code class="literal">users_roles</code>, <code class="literal">roles.yml</code>, and <code class="literal">system_key</code> files from the <a class="link" href="reference.html#ref-shield-files" title="Files used by Shield">Shield configuration files</a> to a place
accessible to the node client. These files should be stored on the filesystem in a folder with restricted access as they
contain sesnitive data. This can be configured with the following settings:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">shield.authc.realms.esusers.files.users</code>
</li><li class="listitem">
<code class="literal">shield.authc.realms.esusers.files.users_roles</code>
</li><li class="listitem">
<code class="literal">shield.authz.store.files.roles</code>
</li><li class="listitem">
<code class="literal">shield.system_key.file</code>
</li></ul></div><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.node.NodeBuilder.*;
...
Node node = nodeBuilder().client(true).settings(ImmutableSettings.builder()
    .put("cluster.name", "myClusterName")
    .put("discovery.zen.ping.multicast.enabled", false)
    .putArray("discovery.zen.ping.unicast.hosts", "localhost:9300", "localhost:9301")
    .put("shield.authc.realms.esusers.type", "esusers")
    .put("shield.authc.realms.esusers.files.users", "/Users/es/config/shield/users")
    .put("shield.authc.realms.esusers.files.users_roles", "/Users/es/config/shield/users_roles")
    .put("shield.authz.store.files.roles", "/Users/es/config/shield/roles.yml")
    .put("shield.system_key.file", "/Users/es/config/shield/system_key"))
    ...
    .node();</pre><p>Additionally, if you are using LDAP or Active Directory authentication then you will need to specify that configuration
in the settings when configuring the node or provide a <code class="literal">elasticsearch.yml</code> in the classpath with the appropriate settings.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuring_authentication_token"></a>Configuring Authentication Token</h4></div></div></div><p>The authentication token can be configured in two ways - globally or per-request. When setting it up globally, the
values of the username and password are configured in the client’s settings:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.node.NodeBuilder.*;
import static org.elasticsearch.shield.authc.support.UsernamePasswordToken.basicAuthHeaderValue;
...

Node node = nodeBuilder().client(true).settings(ImmutableSettings.builder()
    ...
    .put("shield.user", "test_user:changeme"))
    ...
    .node();
Client client = node.client();</pre><p>Once the client is created as above, the <code class="literal">shield.user</code> setting is translated to a request header in the standard HTTP
basic authentication form <code class="literal">Authentication base64("test_user:changeme")</code> which will be sent with every request executed.</p><p>To skip the global configuration of the token, manually set the authentication token header on every request:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.node.NodeBuilder.*;
import static org.elasticsearch.shield.authc.support.UsernamePasswordToken.basicAuthHeaderValue;
...

String token = basicAuthHeaderValue("test_user", new SecuredString("changeme".toCharArray()));
Node node = nodeBuilder().client(true).settings(ImmutableSettings.builder()
    ...
    .node();
Client client = node.client();

client.prepareSearch().putHeader("Authorization", token).get();</pre><p>The example above executes a search request and manually adds the authentication token as a header on it.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_setting_up_ssl"></a>Setting up SSL</h4></div></div></div><p>Authenticating to the cluster requires proof that a node client is trusted as part of the cluster. This is done through
standard PKI and SSL. A client node creates a private key and an associated certificate. The cluster Certificate
Authority signs the certificate. A Client node authenticates during the SSL connection setup by presenting the signed
certificate, and proving ownership of the private key. All of these setup steps are described in
<a class="link" href="private-key.html" title="Generate a node private key and certificate">Securing Nodes</a>.</p><p>In addition, the node client acts like a node, authenticating locally any request made. Copies of the files <code class="literal">users</code>,
<code class="literal">users_roles</code>, <code class="literal">roles.yml</code> , and <code class="literal">system_key</code> need to be made available to the node client.</p><p>After following the steps in <a class="link" href="private-key.html" title="Generate a node private key and certificate">Securing Nodes</a>, configuration for a node client with Shield might look
like this:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.node.NodeBuilder.*;
...
Node node = nodeBuilder().client(true).settings(ImmutableSettings.builder()
    .put("cluster.name", "myClusterName")
    .put("discovery.zen.ping.multicast.enabled", false)
    .putArray("discovery.zen.ping.unicast.hosts", "localhost:9300", "localhost:9301")
    .put("shield.ssl.keystore.path", "/Users/es/node_client/node_client.jks")
    .put("shield.ssl.keystore.password", "password")
    .put("shield.transport.ssl", "true")
    .put("shield.authc.realms.esusers.type", "esusers")
    .put("shield.authc.realms.esusers.files.users", "/Users/es/config/shield/users")
    .put("shield.authc.realms.esusers.files.users_roles", "/Users/es/config/shield/users_roles")
    .put("shield.authz.store.files.roles", "/Users/es/config/shield/roles.yml")
    .put("shield.system_key.file", "/Users/es/config/shield/system_key"))
    ...
    .node();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="transport-client"></a>Transport Client</h3></div></div></div><p>If you plan on using the Transport Client over SSL/TLS you first need to make sure the Shield jar files
(<code class="literal">elasticsearch-shield-1.0.0.jar</code>, <code class="literal">commons-codec-1.10.jar</code>) are in the classpath. You can either download the
Shield distribution, extract the jar files manually and include them in your classpath, or you can pull them out of the Elasticsearch Maven repository. The following snippet shows
the configuration you will need to include in your project’s <code class="literal">pom.xml</code> file:</p><pre class="programlisting prettyprint lang-xml">&lt;project ...&gt;

   &lt;repositories&gt;
      &lt;!-- add the elasticsearch repo --&gt;
      &lt;repository&gt;
         &lt;id&gt;elasticsearch-releases&lt;/id&gt;
         &lt;url&gt;http://maven.elasticsearch.org/releases&lt;/url&gt;
         &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;/releases&gt;
         &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
         &lt;/snapshots&gt;
      &lt;/repository&gt;
      ...
   &lt;/repositories&gt;
   ...

   &lt;dependencies&gt;
      &lt;!-- add the shield jar as a dependency --&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
         &lt;artifactId&gt;elasticsearch-shield&lt;/artifactId&gt;
         &lt;version&gt;1.0.0&lt;/version&gt;
      &lt;/dependency&gt;
      ...
   &lt;/dependencies&gt;
   ...

 &lt;/project&gt;</pre><p>It is also possible to manually download the <a class="ulink" href="http://maven.elasticsearch.org/releases/org/elasticsearch/elasticsearch-shield/1.0.0/elasticsearch-shield-1.0.0.jar" target="_top">Shield jar</a>
file from our Maven repository.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Even if you are not planning on using the client over SSL/TLS, it is still worth having the Shield jar file in
        the classpath as it provides various helpful utilities, such as the <code class="literal">UsernamePasswordToken</code> class for generating
        basic-auth tokens and the <code class="literal">ShieldClient</code> that <a class="link" href="_java_clients.html#shield-client" title="Shield Client">exposes an API</a> to clear realm caches.</p></div></div><p>Before setting up the client itself, you need to make sure you have a user with sufficient privileges to start
the transport client.  The transport client uses Elasticsearch’s node info API to fetch information about the
nodes in the cluster.  For this reason, the authenticated user of the transport client must have the
<code class="literal">cluster:monitor/nodes/info</code> cluster permission.  Furthermore, if the client is configured to use sniffing, the
<code class="literal">cluster:monitor/state</code> cluster permission is required.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p><code class="literal">roles.yml</code> ships with a predefined <code class="literal">transport_client</code> role. By default it is configured to only grant the
        <code class="literal">cluster:monitor/nodes/info</code> cluster permission. You can use this role and assign it to any user
        that will be attached to a transport client.</p></div></div><p>Setting up the transport client is similar to the Node client except authentication files do not need to be configured.
Without SSL, it is as easy as setting up the authentication token on the request, similarly to how they’re set up with
the <span class="emphasis"><em>Node Client</em></span>:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.client.transport.TransportClient;
...

TransportClient client = new TransportClient(ImmutableSettings.builder()
    .put("cluster.name", "myClusterName")
    .put("shield.user", "test_user:changeme")
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9300))
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9301));</pre><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Configuring a Transport Client without SSL will send passwords in plaintext.</p></div></div><p>When using SSL for transport client communication, a few more settings are required. By default, Shield requires client
authentication for secured transport communication. This means that every client would need to have a certificate signed
by a trusted CA. The client authentication can be disabled through the use of a <a class="link" href="separating-node-client-traffic.html" title="Separating node to node and client traffic">client specific transport profile</a>.</p><p>Configuration required for SSL when using client authentication:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.client.transport.TransportClient;
...

TransportClient client = new TransportClient(ImmutableSettings.builder()
    .put("cluster.name", "myClusterName")
    .put("shield.user", "test_user:changeme")
    .put("shield.ssl.keystore.path", "/path/to/client.jks")
    .put("shield.ssl.keystore.password", "password")
    .put("shield.transport.ssl", "true"))
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9300))
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9301));</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">client.jks</code> keystore needs to contain the client’s signed CA certificate and the CA certificate.</p></div></div><p>Configuration required for SSL without client authentication:</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.client.transport.TransportClient;
...

TransportClient client = new TransportClient(ImmutableSettings.builder()
        .put("cluster.name", "myClusterName")
        .put("shield.user", "test_user:changeme")
        .put("shield.ssl.truststore.path", "/path/to/truststore.jks")
        .put("shield.ssl.truststore.password", "password")
        .put("shield.transport.ssl", "true"))
        .addTransportAddress(new InetSocketTransportAddress("localhost", 9300))
        .addTransportAddress(new InetSocketTransportAddress("localhost", 9301));</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The ‘truststore.jks` truststore needs to contain the certificate of the CA that has signed the Elasticsearch nodes’
certificates. If you are using a public CA that is already trusted by the Java runtime, then you can omit
<code class="literal">shield.ssl.truststore.path</code> and <code class="literal">shield.ssl.truststore.password</code>.</p></div></div><p>In the above code snippets, we set up a <span class="emphasis"><em>Transport Client</em></span> and configured the authentication token globally. Meaning,
that every request executed with this client will include this token in its headers.</p><p>The global configuration of the token must be set to some user with the privileges in the default transport_client
role, as described earlier. The authentication token may also be set on each request. This is useful when an
application uses multiple users to access Elasticsearch via the same client. The following example directly sets
the authentication token on the request when executing a search. This holds for each request executed by the client.</p><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.client.transport.TransportClient;
import static org.elasticsearch.shield.authc.support.UsernamePasswordToken.basicAuthHeaderValue;
...

String token = basicAuthHeaderValue("test_user", new SecuredString("changeme".toCharArray()));
TransportClient client = new TransportClient(ImmutableSettings.builder()
    ...
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9300))
    .addTransportAddress(new InetSocketTransportAddress("localhost", 9301));

client.prepareSearch().putHeader("Authorization", token).get();</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Unlike the <span class="emphasis"><em>Node Client</em></span>, the <span class="emphasis"><em>Transport Client</em></span> is not acting as a node in the cluster, and therefore
        <span class="strong"><strong>does not</strong></span> require the license plugin to be installed.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="shield-client"></a>Shield Client</h3></div></div></div><p>Shield exposes its own API to the user which is accessible by the <code class="literal">ShieldClient</code> class. The purpose of this API
 is to manage all Shield related aspects. While at the moment it only exposes an operation for clearing up the
 realm caches, the plan is to extend this API in the future.</p><p><code class="literal">ShieldClient</code> is a wrapper around the existing clients (any client class implementing <code class="literal">org.elasticsearch.client.Client</code>.</p><pre class="literallayout">The following example shows how one can clear up Shield's realm caches using the `ShieldClient`:</pre><pre class="programlisting prettyprint lang-java">import static org.elasticsearch.node.NodeBuilder.*;
...

Client client = ... // create the client (either transport or node)

ShieldClient shieldClient = new ShieldClient(client);
ClearRealmCacheResponse response = shieldClient.authc().prepareClearRealmCache()
    .realms("ldap1", "ad1")
    .usernames("rdeniro")
    .get();</pre><p>In the example above, we clear the caches of two realms - <code class="literal">ldap1</code> and <code class="literal">ad1</code> - for the <code class="literal">rdeniro</code> user.</p></div></div><div class="navfooter"><span class="prev"><a href="clients.html">
              « 
              Integrating Shield with clients</a>
           
        </span><span class="next">
           
          <a href="_http_rest_clients.html">HTTP/REST Clients
               »
            </a></span></div></article></section></div></div></div><footer><div id="footer_container" class="full_wrapper"><div class="container"><nav role="navigation"><ul id="footer_nav" class="menu"><li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a target="_blank" href="http://elasticsearch.com">Company</a></li><li id="menu-item-74980" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-74980"><a href="/resources/">Resources</a></li><li id="menu-item-3106" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3106"><a href="/terms-of-use/">Terms</a></li><li id="menu-item-3107" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3107"><a href="/privacy-and-cookie-policy/">Privacy</a></li><li id="menu-item-3105" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3105"><a href="/contact/">Contact</a></li><li id="menu-item-39" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39"><a href="/blog/">Blog</a></li></ul></nav><div id="social"><a href="https://twitter.com/elasticsearch" class="social_icons" target="_blank"><i class="twitter"></i></a><a href="https://www.facebook.com/elasticsearch" class="social_icons" target="_blank"><i class="facebook"></i></a></div><div id="footer_form"><label class="form_label">Sign up for updates!</label><div class="gf_browser_chrome gform_wrapper" id="gform_wrapper_4"><a id="gf_4" name="gf_4" class="gform_anchor"></a><form method="post" enctype="multipart/form-data" target="gform_ajax_frame_4" id="gform_4" action="/empty-template/#gf_4"><div class="gform_body"><ul id="gform_fields_4" class="gform_fields top_label description_below"><li id="field_4_6" class="gfield               gfield_contains_required"><label class="gfield_label" for="input_4_6">enter you email<span class="gfield_required">*</span></label><div class="ginput_container"><input name="input_6" id="input_4_6" type="email" value="" class="medium" tabindex="50" /></div></li><li id="field_4_2" class="gfield     gform_hidden"><input name="input_2" id="input_4_2" type="hidden" class="gform_hidden" value="813-MAM-392" /></li><li id="field_4_3" class="gfield     gform_hidden"><input name="input_3" id="input_4_3" type="hidden" class="gform_hidden" value="WEB.org" /></li><li id="field_4_4" class="gfield     gform_hidden"><input name="input_4" id="input_4_4" type="hidden" class="gform_hidden" value="WEB.org - Footer - Updates" /></li></ul></div><script type="text/javascript">//<![CDATA[
            jQuery(function(){
                jQuery('#gform_submit_button_4').click( function() {
                    if(window["gf_submitting_4"]){
                        return false;
                    }
                    if( !jQuery("#gform_4")[0].checkValidity || jQuery("#gform_4")[0].checkValidity()){
                        window["gf_submitting_4"]=true;
                    }
                });
            });
            //]]></script><div class="gform_footer top_label"><input type="submit" id="gform_submit_button_4" class="button gform_button" value="Submit" tabindex="51" /><input type="hidden" name="gform_ajax" value="form_id=4&amp;title=&amp;description=" /><input type="hidden" class="gform_hidden" name="is_submit_4" value="1" /><input type="hidden" class="gform_hidden" name="gform_submit" value="4" /><input type="hidden" class="gform_hidden" name="gform_unique_id" value="" /><input type="hidden" class="gform_hidden" name="state_4" value="WyJhOjA6e30iLCJmMjE2MmM2ZjUxYmQ4M2Q3ZmMzNzVlNmY2ODYyZTI2NCJd" /><input type="hidden" class="gform_hidden" name="gform_target_page_number_4" id="gform_target_page_number_4" value="0" /><input type="hidden" class="gform_hidden" name="gform_source_page_number_4" id="gform_source_page_number_4" value="1" /><input type="hidden" name="gform_field_values" value="" /></div></form></div><iframe style="display:none;width:0px; height:0px;" src="about:blank" name="gform_ajax_frame_4" id="gform_ajax_frame_4"></iframe><script type="text/javascript">//<![CDATA[
                    function gformInitSpinner_4(){jQuery('#gform_4').submit(function(){if(jQuery('#gform_ajax_spinner_4').length == 0){jQuery('#gform_submit_button_4, #gform_wrapper_4 .gform_next_button, #gform_wrapper_4 .gform_image_button').after('<' + 'img id="gform_ajax_spinner_4"  class="gform_ajax_spinner" src="http://www.elasticsearch.org/content/plugins/gravityforms/images/spinner.gif" alt="" />'); }} );}jQuery(document).ready(function($){gformInitSpinner_4();jQuery('#gform_ajax_frame_4').load( function(){var contents = jQuery(this).contents().find('*').html();var is_postback = contents.indexOf('GF_AJAX_POSTBACK') >= 0;if(!is_postback){return;}var form_content = jQuery(this).contents().find('#gform_wrapper_4');var is_redirect = contents.indexOf('gformRedirect(){') >= 0;var is_form = !(form_content.length <= 0 || is_redirect);if(is_form){jQuery('#gform_wrapper_4').html(form_content.html());jQuery(document).scrollTop(jQuery('#gform_wrapper_4').offset().top);if(window['gformInitDatepicker']) {gformInitDatepicker();}if(window['gformInitPriceFields']) {gformInitPriceFields();}var current_page = jQuery('#gform_source_page_number_4').val();gformInitSpinner_4();jQuery(document).trigger('gform_page_loaded', [4, current_page]);window['gf_submitting_4'] = false;}else if(!is_redirect){var confirmation_content = jQuery(this).contents().find('#gforms_confirmation_message').html();if(!confirmation_content){confirmation_content = contents;}setTimeout(function(){jQuery('#gform_wrapper_4').replaceWith('<' + 'div id=\'gforms_confirmation_message\' class=\'gform_confirmation_message_4\'' + '>' + confirmation_content + '<' + '/div' + '>');jQuery(document).scrollTop(jQuery('#gforms_confirmation_message').offset().top);jQuery(document).trigger('gform_confirmation_loaded', [4]);window['gf_submitting_4'] = false;}, 50);}else{jQuery('#gform_4').append(contents);if(window['gformRedirect']) {gformRedirect();}}jQuery(document).trigger('gform_post_render', [4, current_page]);} );} );</script><script type='text/javascript'> jQuery(document).ready(function(){jQuery(document).trigger('gform_post_render', [4, 1]) } );
                    //]]></script></div><div class="legal"><p>© 2014 All Rights Reserved - Elasticsearch </p><p>Apache Lucene and Lucene are trademarks of the Apache Software Foundation</p></div></div></div></footer><section id="cookie"><div class="container"><div class="eu">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="accept" class="cta">Accept cookies</a></div><div class="uk">
                Elasticsearch uses cookies to provide a better user experience to visitors of our website. Read more about our cookie policy <a href="/privacy-and-cookie-policy/">here.</a><a data-action="dismiss" class="cta dismiss">X</a></div></div></section><script type="text/javascript">
      if (window.aiModifyParent) aiModifyParent();
      (function ($, $a, $title, $list) {
        $a = $('[id^="js-api-method-index"]');
        if (!$a.size()) return;
        $('.guide_content').addClass('js-client-docs');
        $list = $a.siblings('.itemizedlist').detach();
        $title = $(document.createElement('h2')).text('api methods')
        $a.parent().remove();
        $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
      }(jQuery));
    </script><script type="text/javascript">if(window.aiModifyParent) {aiModifyParent();}</script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.5.2"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.5.2"></script><script type="text/javascript" src="http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201413"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/global.min.js?ver=1395082599"></script><script type="text/javascript" src="http://www.elasticsearch.org/content/themes/elasticsearch-org/js/froogaloop.min.js?ver=1"></script></body></html>
